(()=>{var U=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var D=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var B=D(x=>{"use strict";x.TEMP_CHANNEL_NAME="JinnSelectionChannel";x.INPUTIMAGE="INPUTIMAGE";x.INPUTIMAGEMASK="INPUTIMAGEMASK";x.INPUTREGIONMASK="INPUTREGIONMASK";x.OUTPUTIMAGE="OUTPUTIMAGE";x.OUTPUTTEXT="OUTPUTTEXT";x.SEED="SEED";x.PROMPTTEXT="PROMPTTEXT";x.TEXTFIELD="TEXTFIELD";x.SLIDER="SLIDER";x.FIELDENUM="FIELDENUM";x.TEXT="TEXT";x.SETAILAYERCLOSE="close";x.SETAILAYERDEL="del";x.SETAILAYEROMIT="omit";x.DEFAULT_COMFYUI_URL="http://127.0.0.1:8188";x.OUTPUT_ZOOM="OUTPUT_ZOOM";x.OUTPUT_NOZOOM="OUTPUT_NOZOOM";x.OUTPUT_LESSZOOM="OUTPUT_LESSZOOM";x.OUTPUT_LESSREAL="OUTPUT_LESSREAL";x.OUTPUT_MOREZOOM="OUTPUT_MOREZOOM";x.OUTPUT_MOREREAL="OUTPUT_MOREREAL";x.PROMPTMODE_COMMON="COMMON";x.PROMPTMODE_BATCH="BATCH";x.PROMPTMODE_LIVE="LIVE";x.MINETYPES={".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".bmp":"image/bmp",".gif":"image/gif",".webp":"image/webp"};x.VALID_IMAGE_EXTENSIONS=[".jpg",".jpeg",".png",".gif",".bmp",".webp"];x.BATCH_TASK_FILE_NAME="task.json";x.BATCH_OUTPUT_FILE_NAME="output.json";x.LIVE_ACTIVE_PS_TOOLS=["Pencil","Brush Tool","Color Replacement Tool","Mixer Brush","Eraser","Background Eraser","Magic Eraser","Dodge Tool","Burn Tool","Sponge Tool"]});var te=D((ul,tn)=>{var{storage:vt}=U("uxp"),N=vt.localFileSystem,dl=B();async function or(){return N.getTemporaryFolder()}async function rr(){return N.getDataFolder()}async function ar(e){return N.createSessionToken(e)}async function ir(e){return N.getFileForSaving(e)}async function sr(){return N.getFolder()}async function lr(){let e=await N.getFileForOpening();if(e)return e}async function cr(e){return N.getEntryWithUrl(e)}async function dr(e){return N.getFileForOpening(e)}async function ur(e,t){try{let o=await(await N.getEntryWithUrl(`file:${e}`)).getEntries(),r=[];for(let a of o)if(a.isFile){let i=a.name.slice(a.name.lastIndexOf(".")).toLowerCase();t.includes(i)&&r.push(a.name)}return r}catch(n){throw console.error(n),new Error(`\u83B7\u53D6\u6587\u4EF6\u5939\u5185\u56FE\u7247\u65F6\u51FA\u9519:${e}`)}}async function fr(e,t){try{let o=await(await N.getEntryWithUrl(`file:${e}`)).getEntries(),r=[];for(let a of o){let i=a.name.slice(a.name.lastIndexOf(".")).toLowerCase();if(a.isFile&&t.includes(i))return!0}return!1}catch{return!1}}async function mr(e){let t;try{t=await N.getEntryWithUrl(e)}catch{try{await N.createEntryWithUrl(e,{type:"folder"})}catch(o){throw console.log(o),new Error(`\u521B\u5EFA\u76EE\u5F55\u5931\u8D25${e}`)}}try{if(t=await N.getEntryWithUrl(e),t.isFolder)return t;throw new Error(`\u76EE\u5F55\u4E0D\u6B63\u786E${e}`)}catch{throw new Error(`\u76EE\u5F55\u4E0D\u6B63\u786E${e}`)}}async function pr(e){try{return!!(await N.getEntryWithUrl(e)).isFile}catch{return!1}}function gr(e,...t){let n=e.includes("/")?"/":"\\",o=e;(o.endsWith("/")||o.endsWith("\\"))&&(o=o.slice(0,-1));for(let r of t)(r.startsWith("/")||r.startsWith("\\"))&&(r=r.slice(1)),o+=`${n}${r}`;return o}async function wr(e){return e.read({format:vt.formats.binary})}async function yr(e,t){return e.write(t,{format:vt.formats.binary})}async function hr(e){let t=await N.getEntryWithUrl(e),n=await t.read(),o=JSON.parse(n);return[t,o]}async function Er(e,t){let n=await N.createEntryWithUrl(e,{overwrite:!0});return en(n,t),n}async function en(e,t){await e.write(JSON.stringify(t,null,2))}async function vr(e,t){await e.write(t)}tn.exports={getTemporaryFolder:or,getDataFolder:rr,createSessionToken:ar,getFileForSaving:ir,getFileForOpening:dr,getFolder:sr,getEntryWithUrl:cr,getImageFilePath:lr,getImageFileNamesFromFolder:ur,getFolderWithCreate:mr,fileExists:pr,joinPath:gr,hasImageFile:fr,readArrayBuffer:wr,writeArrayBuffer:yr,writeJsonFile:en,readJsonFile:hr,createJsonFile:Er,writeTEXTFile:vr}});var X=D((ml,sn)=>{"use strict";var fl=B(),C=null;function on(){let e=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),t=Math.round(new Date().getMilliseconds());return`${e}.${t}`}function br(e,t,n,o){let r=C.querySelector(`[data-node-id="${t}"]`);if(r){r.value=o,r.max=n;return}r=bt("sp-progressbar"),r.style.margin="5 0px",r.setAttribute("data-node-id",t),r.value=o,r.max=n,window.config.showDetailLog,C.appendChild(r),C.scrollTop=C.scrollHeight}var rn=30;function bt(e,t,n=!1){let o=null;return window.config.showDetailLog||C.children.length===0?o=document.createElement(e):C.children.length>0&&(C.children[C.children.length-1].style.display="none",o=document.createElement(e)),o.addEventListener("click",Mr),o.setAttribute("size","s"),o.style.width="100%",o}function _t(e){let t=bt("div");if(window.config.showDetailLog){let n=on();t.textContent=`${n} ${e}`}else t.textContent=e;C.appendChild(t),C.childNodes.length>rn&&C.removeChild(C.firstChild),C.scrollTop=C.scrollHeight}function nn(e){let t=bt("div");if(window.config.showDetailLog){let n=on();t.textContent=`${n} ${e}`}else t.textContent=e;t.style.color="#ff5555",C.appendChild(t),C.childNodes.length>rn&&C.removeChild(C.firstChild),C.scrollTop=C.scrollHeight}var _r=(...e)=>{_t(e.join(" ")),window.config.showDetailLog&&console.log(...e)},xr=(...e)=>{_t(e.join(" ")),window.config.showDetailLog&&console.log(...e)},Ir=(...e)=>{e&&e[0]instanceof Error?nn(e[0].message):nn(e.join(" ")),window.config.showDetailLog&&console.error(...e)},Tr=(e,t,n,o)=>{br(e,t,n,o)};async function Cr(){document.getElementById("logArea").innerHTML=""}async function Ar(){let e=document.getElementById("logArea");try{let t=Array.from(e.childNodes).map(n=>n.textContent).join(`\r
`);navigator.clipboard.write({"text/plain":t})}catch(t){_t(`Copy failed: ${t.message}`)}}function an(e){window.config.showDetailLog=e,window.saveConfig(),window.config.showDetailLog?(C.className="logArea-normal",document.getElementById("logtoolbar").style.display="flex",Array.from(C.children).forEach(t=>{t.style.display="block"}),C.scrollTop=C.scrollHeight):(document.getElementById("logtoolbar").style.display="none",C.className="logArea-single",Array.from(C.children).forEach(t=>{t.style.display="none"}),C.children.length>0&&(C.children[C.children.length-1].style.display="block"))}function Mr(){an(!window.config.showDetailLog)}function Sr(){an(!1)}var Lr;function Pr(){C=document.getElementById("logArea"),Lr=document.getElementById("logtoolbar"),document.getElementById("btnCopyLog").addEventListener("click",Ar),document.addEventListener("wfChangeLogSimpleEvent",Sr)}sn.exports={clearLog:Cr,initPanel:Pr,log:_r,warn:xr,error:Ir,progress:Tr}});var ce=D((hl,dn)=>{"use strict";var q=U("photoshop"),{storage:pl}=U("uxp"),gl=U("photoshop").imaging,wl=X(),yl=B(),ln=te();async function Dr(e,t){let o=await(await ln.getTemporaryFolder()).createFile(t,{overwrite:!0}),r=new Uint8Array(e);return await o.write(r),o}async function Or(e,t,n){e&&await q.core.executeAsModal(async o=>{e.layers.forEach(async r=>{r.name===t&&!cn(r,n)&&r.delete()})})}async function kr(e){e&&await q.core.executeAsModal(async t=>{e.layers.forEach(async n=>{n.delete()})})}function cn(e,t){return e&&t&&e._id===t._id&&e._docId===t._docId}async function Br(e){await xt({_obj:"select",_target:[{_ref:"document",_id:e}]})}function Ur(e){if(e===-1)return q.app.activeDocument;for(let t of q.app.documents)if(t.id===e)return t}async function $r(){try{let e=await q.action.batchPlay([{_obj:"get",_target:[{_property:"selection"},{_ref:"document",_enum:"ordinal",_value:"targetEnum"}]}],{});return e[0].selection&&e[0].selection.bottom?!0:null}catch(e){return console.error(e),null}}function Nr(e){if(Array.isArray(e),e.length,e.length>0&&e[0]&&e[0]._obj==="error")throw new Error(`\u6267\u884C\u51FA\u9519: ${e[0].message||"\u672A\u77E5\u9519\u8BEF"}`)}async function xt(e,t){if(Array.isArray(e)||(e=[e]),!e||e.length===0)throw new Error("\u672A\u63D0\u4F9B\u4EFB\u4F55\u547D\u4EE4");let n=await q.core.executeAsModal(async o=>{let r,a;try{return r=await q.action.batchPlay(e,{synchronousExecution:!0,modalBehavior:"execute"}),Nr(r),r}catch(i){throw console.error(i),r&&console.log(JSON.stringify(r,null,2)),console.log(JSON.stringify(e,null,2)),new Error("\u6267\u884C\u52A8\u4F5C\u51FA\u9519")}finally{}})}async function qr(e="AI\u56FE\u7247",t=512,n=512){let o=await q.core.executeAsModal(async r=>await q.app.documents.add({name:e,width:t,height:n,resolution:72,fill:"black"}));if(!o)throw new Error("\u521B\u5EFA\u65B0\u56FE\u7247\u5931\u8D25");return o}function Fr(){let e=[],t=q.app.documents;return t&&t.length>0&&t.forEach(n=>{e.push({id:n.id,name:n.name})}),e}function Rr(e){let t=e.width,n=e.height;return{width:t,height:n}}function jr(){return q.app.documents.length>0}function Hr(e){for(let t of q.app.documents)if(t.id===e)return!0}function zr(e){for(let t of q.app.documents)if(t.name===e)return t.id;return null}function Wr(e){let t=e.bounds,n=t.left,o=t.top,r=t.right,a=t.bottom,i=r-n,s=a-o,l=(r+n)/2,c=(a+o)/2;return{left:n,top:o,right:r,bottom:a,width:i,height:s,centerX:l,centerY:c}}async function Gr(e){let n={_obj:"open",dontRecord:!0,forceNotify:!0,null:{_kind:"local",_path:await ln.createSessionToken(e)},template:!1};return await xt(n),q.app.activeDocument.id}function Kr(e){q.action.addNotificationListener(["historyStateChanged"],e)}function Vr(e){q.action.removeNotificationListener(["historyStateChanged"],e)}dn.exports={getDocuments:Fr,createDocument:qr,getDocumentSize:Rr,activateDocument:Br,hasDocument:jr,existsDocument:Hr,findDocument:zr,hasSelection:$r,getDocumentByID:Ur,deleteAllLayers:kr,deleteLayerByName:Or,saveTempFile:Dr,executeCommand:xt,layerEqual:cn,getLayerBounds:Wr,addNotificationListenerForHistory:Kr,removeNotificationListenerForHistory:Vr,openImageFile:Gr}});var Pe=D((El,pn)=>{"use strict";async function Xr(e,t){try{let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`\u8BBF\u95EECOMFYUI\u51FA\u9519 ${e}  ${n.status} ${n.statusText}`);let o=await n.json();if("comfy_error"in o)throw new Error(`serverlog=${o.comfy_error}`);return o}catch(n){throw n.message&&n.message==="Network request failed"?new Error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u65E0\u6CD5\u8FDE\u63A5\u5230COMFYUI"):n}}async function Yr(e,t){try{let n=e;if(t){let a=new URLSearchParams(t).toString();n=`${e}${e.includes("?")?"&":"?"}${a}`}let o=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`\u8BBF\u95EECOMFYUI\u51FA\u9519 ${n}  ${o.status} ${o.statusText}`);let r=await o.json();if("comfy_error"in r)throw new Error(`serverlog=${r.comfy_error}`);return r}catch(n){throw n.message&&n.message==="Network request failed"?new Error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u65E0\u6CD5\u8FDE\u63A5\u5230COMFYUI"):n}}function Jr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}function Zr(e){return new Promise(t=>setTimeout(t,e))}async function Qr(e){try{let t=await fetch(e);if(!t.ok)throw new Error(`\u8BBF\u95EECOMFYUI\u51FA\u9519 ${e}  ${t.status} ${t.statusText}`);let n=t.headers.get("Content-Type");if(n&&n.includes("application/json")){let i=await t.json();throw new Error(`serverlog=${i.comfy_error}`)}let o=await t.arrayBuffer();if(o.byteLength<=0)throw new Error("arrayBuffer\u4E3A\u7A7A");let r=t.headers.get("X-Image-Width"),a=t.headers.get("X-Image-Height");return{arrayBuffer:o,width:r,height:a}}catch(t){throw t.message&&t.message==="Network request failed"?new Error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u65E0\u6CD5\u8FDE\u63A5\u5230COMFYUI"):t}}function fn(e,t="userSettings"){wx.setStorage({key:t,data:e,success(n){},fail(n){console.error("\u672C\u5730\u6570\u636E\u4FDD\u5B58\u5931\u8D25",n)}})}function ea(e="userSettings"){try{return wx.getStorageSync(e)}catch(t){console.error("\u52A0\u8F7D\u672C\u5730\u6570\u636E\u5931\u8D25",t)}}function ta(e,t="userSettings"){let n=wx.getStorageSync(t);(n==null||n==="")&&(n=[]),n.length>=10&&n.shift(),n.push(e),fn(n,t)}function na(e){return e==null||e.trim()===""}function oa(e,t){return Math.floor(Math.random()*(t-e+1))+e}var mn=e=>{let t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),r=e.getHours(),a=e.getMinutes(),i=e.getSeconds();return`${[t,n,o].map(un).join("/")} ${[r,a,i].map(un).join(":")}`},un=e=>(e=e.toString(),e[1]?e:`0${e}`),ra=()=>{let e=getCurrentPages();return e[e.length-1].route},aa=()=>mn(new Date);function ia(e){try{let t=e.lastIndexOf(".");if(t===-1)return[e,""];let n=e.substring(0,t),o=e.substring(t).toLowerCase();return[n,o]}catch(t){throw console.error("\u63D0\u53D6\u6587\u4EF6\u540D\u548C\u6269\u5C55\u540D\u5931\u8D25:",t),t}}function sa(){let e=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),t=Math.round(new Date().getMilliseconds()/100);return`${e}`}pn.exports={post:Xr,get:Yr,generateUUID:Jr,downloadImage:Qr,randInt:oa,getLocal:ea,setLocal:fn,appendLocal:ta,formatTime:mn,now:aa,getCurrPageRoute:ra,isEmpty:na,sleep:Zr,extractFileNameAndExtension:ia,getCurrentTime:sa}});var ne=D((bl,wn)=>{"use strict";var vl=ce(),A=Pe(),de=X(),K=B();async function la(e){return await A.get(`${window.config.comfyuiURL}/models/checkpoints`)}async function ca(e){return await A.get(`${e}/system_stats`)}async function da(e){try{return[!0,(await A.get(`${e}/jinn_test`)).role]}catch{return[!1,""]}}async function ua(){return await A.get(`${window.config.comfyuiURL}/jinn_get_wf_api_run`)}async function fa(e){return await A.get(`${window.config.comfyuiURL}/jinn_get_wf_params/${e}`)}async function ma(e){return await A.get(`${window.config.comfyuiURL}/jinn_get_wf_api/${e}`)}async function pa(){return(await A.get(`${window.config.comfyuiURL}/jinn_get_workflows`)).items}async function ga(){return await A.get(`${window.config.comfyuiURL}/jinn_get_workflows_recover`)}async function wa(e,t){let n=await A.post(`${window.config.comfyuiURL}/jinn_workflows_recover`,{wfname:e,wfid:t})}async function ya(e){let t=await A.post(`${window.config.comfyuiURL}/jinn_save_wf_new_run`,e)}async function ha(e){let t=await A.post(`${window.config.comfyuiURL}/jinn_save_wf_edit`,e)}async function Ea(e){let t=await A.post(`${window.config.comfyuiURL}/jinn_save_wf_del`,e)}async function va(e,t){let n=await A.post(`${window.config.comfyuiURL}/jinn_workflows_sort`,{wfname1:e,wfname2:t})}async function ba(e,t,n,o,r){let a=await A.post(`${window.config.comfyuiURL}/jinn_save_wf_params_sort`,{wfname:e,nodeid1:t,field1:n,nodeid2:o,field2:r})}async function _a(){let e={},t=await A.post(`${window.config.comfyuiURL}/jinn_interrupt`,e)}async function xa(e){let t={preview:e},n=await A.post(`${window.config.comfyuiURL}/jinn_set_output_preview`,t)}var nt=class extends Error{constructor(t,n){super(t),this.name=this.constructor.name,this.needinfo=n}};async function Ia(e){let t=await A.post(`${window.config.comfyuiURL}/jinn_registry_user`,{user_id:e})}async function Ta(e,t,n,o,r,a,i,s=null){s!==!1&&de.log("\u6B63\u5728\u8BF7\u6C42COFMYUI.");let l=A.generateUUID(),c={client_id:l,wfname:e,params:t,debug:o},d=await A.post(`${window.config.comfyuiURL}/jinn_prompt_byid`,c);if(d.verify===!1)throw new nt(d.message,d.needinfo);d.verify_message&&(de.error(d.verify_message),alert(d.verify_message));let u=d.prompt_id;if(s!==!1&&de.log("\u6B63\u5728\u8FD0\u884C\u5DE5\u4F5C\u6D41"),await La(l,u,n,i,s),t.output.kind===K.OUTPUTIMAGE)return s!==!1&&de.log("\u6B63\u5728\u4E0B\u8F7D\u56FE\u7247."),Aa(u,t.output.nodeid,t.output.field,r,a,s);if(t.output.kind===K.OUTPUTTEXT)return s!==!1&&de.log("\u6B63\u5728\u83B7\u53D6\u6587\u672C."),Ca(u,t.output.nodeid,t.output.field,r,a,s);throw new Error(`\u672A\u77E5\u8F93\u51FA\u7C7B\u578B${t.output.kind}`)}async function Ca(e,t,n,o,r,a){let i={prompt_id:e,nodeid:t,field:n},s=await A.post(`${window.config.comfyuiURL}/jinn_prompt_result_text_byid`,i);return{kind:K.OUTPUTTEXT,text:s.result}}async function Aa(e,t,n,o,r,a){let i={prompt_id:e,nodeid:t,field:n},s=await A.post(`${window.config.comfyuiURL}/jinn_prompt_result_byid`,i),l=[],c=".jpg";for(let d of s){d.docwidth=r.width,d.docheight=r.height,d.zoom=o,c=d.filename.toLowerCase().endsWith(".png")?".png":".jpg";let u=new URLSearchParams(d),y=`${window.config.comfyuiURL}/jinn_view?${u.toString()}`;a!==!1&&de.warn(y);let h=await A.downloadImage(y);l.push(h)}return[l,c]}async function Ma(e,t){let n=`${window.config.comfyuiURL}/view?filename=${e}&subfolder=${t}&type=temp`;return await A.downloadImage(n)}async function Sa(e){return(await A.get(`${window.config.comfyuiURL}/jinn_get_queue/${e}`)).queue_index}async function La(e,t,n,o,r){return new Promise((a,i)=>{let s=!1,l=m=>{try{h.close()}catch{}i(new Error(m))},c=window.config.comfyuiURL.replace(/^https?:\/\//,""),u=`${window.config.comfyuiURL.toLowerCase().startsWith("http")?"ws":"wss"}://${c}/ws?clientId=${e}`,y=0,h=new WebSocket(u);h.onerror=function(m){l("WebSocket\u51FA\u9519")},h.onclose=function(m){m.wasClean||l("WebSocket\u610F\u5916\u5173\u95ED: "+m.reason)},h.onmessage=async function(m){let f=m.data;if(typeof f=="string"){let g=JSON.parse(f);switch(g.type){case"executing":if(g.data&&g.data.node&&g.data.node in n){let T=n[g.data.node];T&&T._meta&&T._meta.title&&r!==!1&&de.warn(`\u6B63\u5728\u6267\u884C${T._meta.title}(${g.data.node})`)}break;case"executed":try{if(window.config.loadTempImage&&window.config.promptMode===K.PROMPTMODE_COMMON&&g.data&&g.data.output&&g.data.output.images&&g.data.output.images[0].type==="temp"){let T=new CustomEvent("wfLoadTempImageEvent",{detail:{filename:g.data.output.images[0].filename,subfolder:g.data.output.images[0].subfolder}});document.dispatchEvent(T)}}catch{}break;case"execution_error":l("\u7B49\u5F85\u65F6\u51FA\u9519,\u8BF7\u67E5\u770BCOMFYUI\u65E5\u5FD7.");break;case"execution_interrupted":l("\u7528\u6237\u4E2D\u6B62\u751F\u56FE.");break;case"execution_success":s=!0;break;case"status":if(s===!0){h.close(),a(!0);break}if(g.data.status.exec_info.queue_remaining==0){l("\u7531\u4E8E\u79CD\u5B50\u6570\u56FA\u5B9A\u7B49\u7CFB\u7EDF\u7F13\u5B58\u539F\u56E0\uFF0C\u5DE5\u4F5C\u6D41\u672A\u88AB\u6267\u884C.");break}let p=await Sa(t);if(p<0){l(`${t}\u4E0D\u5728\u961F\u5217\u4E2D`);break}else p>0&&de.log(`\u5F53\u524D\u6392\u961F\u7B2C${p+1}\u4F4D`);break;case"progress":let{value:w,max:b,node:I}=g.data,L=n[I]._meta?n[I]._meta.title:n[I].class_type;b>1&&r!==!1&&de.progress(L,I,b,w);break;default:}}}})}async function Pa(e,t,n="psupload"){let o=new FormData;o.append("image",e,t),o.append("subfolder",n),o.append("filename",t);let r=await fetch(`${window.config.comfyuiURL}/jinn_upload_image_live`,{method:"POST",body:o});if(r.ok){let a=await r.json();return{path:`${a.subfolder}/${a.name}`,filename:a.name,subfolder:a.subfolder}}else throw new Error(`\u4E0A\u4F20\u56FE\u7247\u5931\u8D25  ${t},${r.status},${r.statusText}`)}async function Da(e,t,n){let o="psupload",r=new FormData;r.append("image",e,t),r.append("subfolder",o),r.append("filename",t),r.append("minsize",window.config.pszoomMinsize),r.append("maxsize",window.config.pszoomMaxsize),n&&r.append("bounds",`${n.left},${n.top},${n.right},${n.bottom}`);let a=await fetch(`${window.config.comfyuiURL}/jinn_upload_image`,{method:"POST",body:r});if(a.ok){let i=await a.json();return{path:`${i.subfolder}/${i.name}`,filename:i.name,subfolder:i.subfolder}}else throw new Error(`\u4E0A\u4F20\u56FE\u7247\u5931\u8D25  ${t},${a.status},${a.statusText}`)}async function Oa(e,t){let n="psupload",o=new FormData;o.append("image",e,t),o.append("subfolder",n),o.append("filename",t);let r=await fetch(`${window.config.comfyuiURL}/jinn_upload_image`,{method:"POST",body:o});if(r.ok){let a=await r.json();return{path:`${a.subfolder}/${a.name}`,filename:a.name,subfolder:a.subfolder}}else throw new Error(`\u4E0A\u4F20\u56FE\u7247\u5931\u8D25  ${t},${r.status},${r.statusText}`)}async function ka(e,t,n,o){let r="psupload",a=new FormData;a.append("image",e,t),a.append("maskfilename",t),a.append("maskfolder",r),a.append("imagefilename",n.filename),a.append("imagefolder",n.subfolder),a.append("minsize",window.config.pszoomMinsize),a.append("maxsize",window.config.pszoomMaxsize),o&&a.append("bounds",`${o.left},${o.top},${o.right},${o.bottom}`);let i=await fetch(`${window.config.comfyuiURL}/jinn_upload_mask`,{method:"POST",body:a});if(i.ok){let s=await i.json();return`${s.subfolder}/${s.name}`}else throw new Error(`\u4E0A\u4F20\u56FE\u7247\u5931\u8D25  ${t},${i.status},${i.statusText}`)}async function Ba(e){let t={text:e,appid:window.config.transBaiduAppID,appkey:window.config.transBaiduAppKey,from_lang:"zh",to_lang:"en"};return(await A.post(`${window.config.comfyuiURL}/jinn_translate`,t)).result}async function Ua(e){let t={text:e,appid:window.config.transBaiduAppID,appkey:window.config.transBaiduAppKey,from_lang:"en",to_lang:"zh"};return(await A.post(`${window.config.comfyuiURL}/jinn_translate`,t)).result}async function $a(e,t){let n=await gn(e,t);try{return n[0]}catch{return[]}}async function gn(e,t){return await A.get(`${window.config.comfyuiURL}/jinn_get_wf_nodefield_info/${e}/${t}`)}var Na=new Map;async function qa(e,t){let n=`${e},${t}`;try{let o=await gn(e,t),r=o[0],a=o.length>1?o[1]:{},i;if(t.toLowerCase()==="seed"?i=K.SEED:t.toLowerCase()==="image"||a.hasOwnProperty("image_upload")&&a.image_upload===!0||r==="IMAGE"?i=K.INPUTIMAGE:Array.isArray(r)?i=K.FIELDENUM:r==="INT"?a.hasOwnProperty("min")&&a.hasOwnProperty("max")&&t.toLowerCase()==="steps"?(a={min:1,max:20,step:1},i=K.SLIDER):i=K.TEXTFIELD:r==="FLOAT"?a.hasOwnProperty("min")&&a.hasOwnProperty("max")&&a.hasOwnProperty("step")&&(i=K.SLIDER):r==="STRING"&&a.hasOwnProperty("multiline")&&a.multiline===!0&&(i=K.PROMPTTEXT),i)return Na.set(n,i),[i,a]}catch(o){console.error("Error guessing field kind:",o)}return[null,null]}wn.exports={VerifyError:nt,registry_user:Ia,loadTempImage:Ma,prompt:Ta,uploadImage:Da,uploadImageBatch:Oa,uploadMask:ka,load_checkpoints:la,get_wf_params:fa,get_workflows:pa,test_comfyui:ca,test_comfyui_jinn:da,get_wf_api:ma,save_wf_new_run:ya,save_wf_edit:ha,save_wf_del:Ea,get_wf_api_run:ua,get_workflows_recover:ga,workflows_recover:wa,workflows_sort:va,save_wf_params_sort:ba,interrupt:_a,setOutputPreview:xa,translateToZH:Ua,translateToEN:Ba,get_wf_nodefield_enum:$a,guessFieldKind:qa,uploadImageLive:Pa}});var bn=D((Il,vn)=>{"use strict";var ot=U("photoshop"),{storage:_l}=U("uxp"),xl=U("photoshop").imaging,De=X(),Ee=B(),Oe=te(),_=ce();async function Fa(e,t){if(window.config.setAILayer===Ee.SETAILAYERCLOSE)try{let n=_.getDocumentByID(e);if(!n)throw new Error(`\u6CA1\u6709\u627E\u5230\u6307\u5B9A\u7684\u56FE\u7247,docid=${e}`);await ot.core.executeAsModal(async o=>{n.layers.forEach(async r=>{r.name===t&&(r.visible=!1)})})}catch(n){De.error(n)}else if(window.config.setAILayer===Ee.SETAILAYERDEL)try{let n=_.getDocumentByID(e);if(!n)throw new Error(`\u6CA1\u6709\u627E\u5230\u6307\u5B9A\u7684\u56FE\u7247,docid=${e}`);De.log(`\u5220\u9664\u6240\u6709"${t}"\u56FE\u5C42`),await _.deleteLayerByName(n,t,null)}catch(n){De.error(n)}}async function Ra(e,t){let o=await(await Oe.getTemporaryFolder()).createFile(t,{overwrite:!0});De.warn(o.nativePath);let r={compression:6,interlaced:!1,embedColorProfile:!0};if(await e.saveAs.png(o,{compression:3}),Oe.readArrayBuffer(o).byteLength<=0)throw new Error("arrayBuffer\u4E3A\u7A7A");return o}async function ja(e,t,n){let o=_.getDocumentByID(e);if(!o)throw new Error(`\u6CA1\u6709\u627E\u5230\u6307\u5B9A\u7684\u56FE\u7247,docid=${e}`);return await ot.core.executeAsModal(async r=>{try{return await Ra(o,t)}catch(a){throw De.error(a),new Error("\u5904\u7406PS\u56FE\u50CF\u65F6\u51FA\u9519")}})}function yn(e,t){let n=e.channels,o=n.length;for(let r=0;r<o;r++)try{let a=n[r];if(a&&a.name===t)return!0}catch{continue}return!1}async function hn(e){yn(e,Ee.TEMP_CHANNEL_NAME)&&await _.executeCommand([{_obj:"select",_target:[{_name:Ee.TEMP_CHANNEL_NAME,_ref:"channel"}]},{_obj:"delete",_target:[{_enum:"ordinal",_ref:"channel",_value:"targetEnum"}]}]),await _.executeCommand([{_obj:"duplicate",_target:[{_property:"selection",_ref:"channel"}],name:Ee.TEMP_CHANNEL_NAME},{_obj:"set",_target:[{_property:"selection",_ref:"channel"}],to:{_enum:"ordinal",_value:"none"}}])}async function En(e){if(yn(e,"JinnSelectionChannel")){let t=[{_obj:"select",_target:[{_name:Ee.TEMP_CHANNEL_NAME,_ref:"channel"}]},{_obj:"set",_target:[{_property:"selection",_ref:"channel"}],to:{_enum:"ordinal",_ref:"channel",_value:"targetEnum"}},{_obj:"delete",_target:[{_enum:"ordinal",_ref:"channel",_value:"targetEnum"}]}];await _.executeCommand(t)}}function Ha(e,t,n,o,r){let a=_.getDocumentSize(e),i=a.width,s=a.height,l=_.getLayerBounds(t),c=100;if(!(n>=i||o>=s))if(r.lesszoom===Ee.OUTPUT_LESSZOOM){if(!(l.width===i||l.height===s)){let d=l.width/l.height,u=i/s;d>u?c=100*s/l.height:c=100*i/l.width}}else n===l.width||o===l.height||(c=100*n/l.width);return[c,i/2-l.centerX,s/2-l.centerY]}async function za(e,t,n,o,r,a){o=parseInt(o),r=parseInt(r),await _.activateDocument(e);let i=_.getDocumentByID(e),s=await _.hasSelection(e);s&&await hn(i);let l=_.getDocumentSize(i),c=l.width,d=l.height;if((o>c||r>d)&&a.morezoom===Ee.OUTPUT_MOREREAL){let b={_obj:"canvasSize",canvasExtensionColorType:{_enum:"canvasExtensionColorType",_value:"backgroundColor"},width:{_unit:"pixelsUnit",_value:o},height:{_unit:"pixelsUnit",_value:r},horizontal:{_enum:"horizontalLocation",_value:"center"},vertical:{_enum:"verticalLocation",_value:"center"}};await _.executeCommand(b)}let u=i.activeLayers[0],h={_obj:"placeEvent",null:{_path:await Oe.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:0},vertical:{_unit:"pixelsUnit",_value:0}}},m={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await _.executeCommand([h,m]);let f=i.activeLayers[0];if(_.layerEqual(u,f))throw new Error("\u521B\u5EFA\u65B0\u56FE\u5C42\u5931\u8D25");let[g,p,w]=Ha(i,f,o,r,a);if(g!==100||p!==0||w!==0){let b={_obj:"transform",_target:[{_ref:"layer",_enum:"ordinal",_value:"targetEnum"}],freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSCanvas"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:p},vertical:{_unit:"pixelsUnit",_value:w}},width:{_unit:"percentUnit",_value:g},height:{_unit:"percentUnit",_value:g},linked:!0};await _.executeCommand(b)}return s&&await En(i),f}async function Wa(e,t){await _.activateDocument(e);let n=_.getDocumentByID(e),r={_obj:"placeEvent",null:{_path:await Oe.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"}};await _.executeCommand(r)}function Ga(e,t,n,o,r){let a=_.getLayerBounds(t);return[100*(r.right-r.left)/a.width,r.centerX-a.centerX,r.centerY-a.centerY]}async function Ka(e,t,n,o,r,a){await _.activateDocument(e);let i=_.getDocumentByID(e),s=await _.hasSelection(e);s&&await hn(i);let l=i.activeLayers[0],d={_obj:"placeEvent",null:{_path:await Oe.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:0},vertical:{_unit:"pixelsUnit",_value:0}}},u={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await _.executeCommand([d,u]);let y=i.activeLayers[0];if(_.layerEqual(l,y))throw new Error("\u521B\u5EFA\u65B0\u56FE\u5C42\u5931\u8D25");let[h,m,f]=Ga(i,y,parseInt(o),parseInt(r),a);if(h>0){let g={_obj:"transform",_target:[{_ref:"layer",_enum:"ordinal",_value:"targetEnum"}],freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSCanvas"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:m},vertical:{_unit:"pixelsUnit",_value:f}},width:{_unit:"percentUnit",_value:h},height:{_unit:"percentUnit",_value:h}};await _.executeCommand(g)}return s&&await En(i),y}async function Va(e,t){let n=e.selection,o=await e.createLayer({name:"AIMask",opacity:100,mode:"normal"}),r={_obj:"fill",using:{_enum:"fillContents",_value:"white"},opacity:{_unit:"percentUnit",_value:100},mode:{_enum:"blendMode",_value:"normal"}},a={_obj:"inverse"},i={_obj:"fill",using:{_enum:"fillContents",_value:"black"},opacity:{_unit:"percentUnit",_value:100},mode:{_enum:"blendMode",_value:"normal"}},l=await(await Oe.getTemporaryFolder()).createFile(t,{overwrite:!0});return await _.executeCommand([r,a,i]),await e.saveAs.jpg(l,{quality:12}),await o.delete(),await _.executeCommand({_obj:"inverse"}),l}async function Xa(e,t){let n=_.getDocumentByID(e);if(await _.activateDocument(n.id),!await _.hasSelection())throw new Error("\u6CA1\u6709\u627E\u5230\u6709\u6548\u9009\u533A\uFF01");if(!n)throw new Error(`\u6CA1\u6709\u627E\u5230\u6307\u5B9A\u7684\u56FE\u7247,docid=${e}`);return await ot.core.executeAsModal(async o=>{try{return await Va(n,t)}catch(r){throw De.error(r),new Error("\u83B7\u53D6\u9009\u533A\u65F6\u51FA\u9519")}})}async function Ya(e){try{let t=_.getDocumentByID(e);await _.activateDocument(t.id);let n=await ot.action.batchPlay([{_obj:"get",_target:[{_property:"selection"},{_ref:"document",_enum:"ordinal",_value:"targetEnum"}]}],{});if(!(n[0].selection&&n[0].selection.bottom))return null;let o=_.getDocumentSize(t),r=o.width,a=o.height,i={left:n[0].selection.left._value,top:n[0].selection.top._value,right:n[0].selection.right._value,bottom:n[0].selection.bottom._value},s=i.right-i.left,l=i.bottom-i.top,c=.08,d=Math.max(0,i.left-s*c),u=Math.max(0,i.top-l*c),y=Math.min(r,i.right+s*c),h=Math.min(a,i.bottom+l*c),m=y-d,f=h-u;m-=m%8,f-=f%8,y=d+m,h=u+f;let g={left:Math.round(d),top:Math.round(u),right:Math.round(y),bottom:Math.round(h)};return g.centerX=(g.right+g.left)/2,g.centerY=(g.bottom+g.top)/2,g}catch(t){return console.error(t),null}}vn.exports={addLayerImage:za,addLayerImageRegion:Ka,preparePSImage:Fa,createPSImage:ja,createSelectionMask:Xa,getSelectionSmartBounds:Ya,addLayerImageTemp:Wa}});var it=D((Tl,Mn)=>{"use strict";var Ja=Pe(),oe=ne(),Be=ce(),fe=bn(),O=X(),{app:rt}=U("photoshop"),ue=B(),Za=document.getElementById("wfButtonContainer"),Qa=document.getElementById("btnPrompt"),ei=document.getElementById("logContainer"),_n=document.getElementById("btnSettings"),xn=document.getElementById("btnInterrupt"),ti=document.getElementById("wfParamContainer"),ni=document.getElementById("wfPreviewImage"),It=document.getElementById("lSimpleLog"),oi=document.getElementById("wfMainToolbar");function Ct(e){Array.from(Za.children).forEach(t=>{t.disabled=e}),oi.querySelectorAll("*").forEach(t=>{t.disabled=e}),Qa.disabled=e,_n.disabled=e,_n.style.display=e?"none":"flex",xn.disabled=!e,xn.style.display=e?"flex":"none",ti.querySelectorAll("*").forEach(t=>{t.hasAttribute("data-keep-enabled")||(t.disabled=e)}),It.textContent="",e?It.style.display=window.config.promptMode===ue.PROMPTMODE_BATCH?"block":"none":It.style.display="none"}function In(){At=!1,window.showSingle(ei),O.clearLog(),console.clear(),Ct(!0)}function He(){At=!1,Ct(!1)}async function at(e,t,n){O.warn("\u6B63\u5728\u8BFB\u53D6PS\u56FE\u50CF");let o=n===0?"psimage.png":`psimage${n}.png`,r=await fe.createPSImage(t.docid,o,e),a=await oe.uploadImage(r,o);return O.warn(a.path),t.value=a.path,a}async function Tn(e,t,n){O.warn("\u6B63\u5728\u8BFB\u53D6PS\u9009\u533A");let o=t===0?"psmask.jpg":`psmask${t}.jpg`,r=t===0?"psmask.png":`psmask${t}.png`,a=await fe.createSelectionMask(e.docid,o),i=await oe.uploadMask(a,r,n);return O.warn(i),e.value=i,i}async function Cn(e,t,n){O.warn("\u6B63\u5728\u8BFB\u53D6PS\u9009\u533A\u4F5C\u4E3A\u56FE\u50CF\u53CA\u8499\u677F");let o=n===0?"psareaimg.png":`psareaimg${n}.png`,r=await fe.getSelectionSmartBounds(t.docid);if(!r)throw new Error("\u6CA1\u6709\u627E\u5230\u9009\u533A");let a=await fe.createPSImage(t.docid,o,e),i=await oe.uploadImage(a,o,r);O.warn(i.path);let s=n===0?"psareamask.jpg":`psareamask${n}.jpg`,l=n===0?"psareamask.png":`psareamask${n}.png`,c=await fe.createSelectionMask(t.docid,s),d=await oe.uploadMask(c,l,i,r);return O.warn(d),t.value=d,r}function An(e){let t=new Image;t.src=e,ni.src=t.src}async function ri(e,t,n,o){In();let r=null;try{if(!rt.activeDocument){O.error("\u8BF7\u5148\u6253\u5F00\u4E00\u5F20\u56FE\u7247\uFF01"),He();return}let a=t.params.filter(i=>i.kind===ue.INPUTIMAGEMASK);for(let i=0;i<a.length;i++){let s=a[i];s.docid=-1;let l=await at(e,s,i+1);await Tn(s,i,l)}a=t.params.filter(i=>i.kind===ue.INPUTIMAGE);for(let i=0;i<a.length;i++){let s=a[i];s.docid=-1,await at(e,s,i)}a=t.params.filter(i=>i.kind===ue.INPUTREGIONMASK);for(let i=0;i<a.length;i++){let s=a[i];s.docid=-1,r=await Cn(e,s,i)}}catch(a){O.error(a),He();return}try{let a=await oe.prompt(e,t,n,window.config.showDetailLog,{width:100,height:100},An);O.log(a.text),o&&o(a.text)}catch(a){O.error(a),a instanceof oe.VerifyError&&document.dispatchEvent(new CustomEvent("verifyUserEvent",{detail:{error:a}}))}finally{He()}}async function ai(e,t,n){In();let o=null,r=null,a=performance.now();try{rt.activeDocument||await Be.createDocument(),r=t.output.docid===-1?rt.activeDocument.id:t.output.docid,await fe.preparePSImage(r,e);let i=t.params.filter(s=>s.kind===ue.INPUTIMAGEMASK);for(let s=0;s<i.length;s++){let l=i[s],c=await at(e,l,s+1);await Tn(l,s,c)}i=t.params.filter(s=>s.kind===ue.INPUTIMAGE);for(let s=0;s<i.length;s++){let l=i[s];await at(e,l,s)}i=t.params.filter(s=>s.kind===ue.INPUTREGIONMASK);for(let s=0;s<i.length;s++){let l=i[s];o=await Cn(e,l,s)}}catch(i){O.error(i),He();return}try{let i=t.output.lesszoom==ue.OUTPUT_LESSREAL||t.output.morezoom==ue.OUTPUT_MOREREAL,[s,l]=await oe.prompt(e,t,n,window.config.showDetailLog,i,{width:100,height:100},An);O.log("\u6B63\u5728\u5B58\u50A8AI\u56FE\u50CF\u6587\u4EF6");let c=[];for(let m=0;m<s.length;m++){let{arrayBuffer:f,width:g,height:p}=s[m],w=await Be.saveTempFile(f,m===0?`cfimage${l}`:`cfimage${m+1}${l}`);O.warn(w.nativePath,`${g}*${p}`),c.push([w,g,p])}if(O.log("\u6B63\u5728\u6DFB\u52A0\u5230\u56FE\u5C42"),o)for(let[m,f,g]of c)await fe.addLayerImageRegion(r,m,e,f,g,o);else for(let[m,f,g]of c)await fe.addLayerImage(r,m,e,f,g,t.output);let[d,u,y]=c[0],h=((performance.now()-a)/1e3).toFixed(1);O.log(`\u751F\u56FE\u6210\u529F  ${u}*${y} ${h}\u79D2`)}catch(i){O.error(i),i instanceof oe.VerifyError&&document.dispatchEvent(new CustomEvent("verifyUserEvent",{detail:{error:i}}))}finally{He()}}var At=!1;async function ii(){try{At=!0,await oe.interrupt(),O.error("\u5C1D\u8BD5\u4E2D\u6B62\u751F\u56FE...")}catch(e){O.error(e)}}var ke,Tt=!1;async function si(){Tt=!0;try{(!ke||!Be.existsDocument(ke))&&(ke=Be.findDocument("CF-TEMP"),ke||(await Be.createDocument("CF-TEMP",1024,1024),ke=rt.activeDocument.id))}catch{}finally{Tt=!1}}async function li(e){let{filename:t,subfolder:n}=e,{arrayBuffer:o,width:r,height:a}=await oe.loadTempImage(t,n),i=await Be.saveTempFile(o,"cftemp.png");Tt&&await Ja.sleep(300),await si(),await fe.addLayerImageTemp(ke,i)}Mn.exports={prompt:ai,promptOutputText:ri,interruptPrompt:ii,DisabledUI:Ct,loadTempImage:li}});var Dn=D((Ll,Pn)=>{"use strict";var Sn=U("photoshop"),{storage:Cl}=U("uxp"),Al=U("photoshop").imaging,Mt=X(),Ml=B(),Ln=te(),Te=ce();async function ci(e,t){try{await Te.deleteLayerByName(e,t,null)}catch(n){Mt.error(n)}}async function di(e,t,n){return await Sn.core.executeAsModal(async o=>{try{let a=await(await Ln.getTemporaryFolder()).createFile(t,{overwrite:!0});return n&&Mt.warn(a.nativePath),await e.saveAs.jpg(a,{quality:6}),a}catch(r){throw Mt.error(r),new Error("\u5904\u7406PS\u56FE\u50CF\u65F6\u51FA\u9519")}})}function ui(e,t,n,o){let r=Te.getDocumentSize(e),a=r.width,i=r.height,s=Te.getLayerBounds(t),l=s.width>=s.height?n*100/s.width:o*100/s.height,c,d;return c=a*3/4,d=i/2,[l,c-s.centerX,d-s.centerY]}var{ElementPlacement:Sl}=Sn.constants;async function fi(e,t,n,o,r){let a=e.activeLayers,i=a.length>0?a[0]:null,l={_obj:"placeEvent",null:{_path:await Ln.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:0},vertical:{_unit:"pixelsUnit",_value:0}}},c={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await Te.executeCommand([l,c],e.id);let d=e.activeLayers[0];await Te.deleteLayerByName(e,n,d);let[u,y,h]=ui(e,d,o,r);if(u>0){let m={_obj:"transform",_target:[{_ref:"layer",_enum:"ordinal",_value:"targetEnum"}],freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSCanvas"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:y},vertical:{_unit:"pixelsUnit",_value:h}},width:{_unit:"percentUnit",_value:u},height:{_unit:"percentUnit",_value:u}};await Te.executeCommand(m,e.id)}try{if(i)try{let m={_obj:"select",_target:[{_ref:"layer",_id:i.id}],makeVisible:!1};await Te.executeCommand(m,e.id)}catch{}}catch{}return d}Pn.exports={preparePSImageLive:ci,createPSImageLive:di,addLayerImageLive:fi}});var qn=D((Pl,Nn)=>{"use strict";var We=ne(),mi=Pe(),St=ce(),On=Dn(),z=X(),{app:kn}=U("photoshop"),ze=B(),pi=it(),Bn=document.getElementById("btnInterrupt"),gi=document.getElementById("wfButtonContainer"),wi=document.getElementById("btnPrompt"),yi=document.getElementById("logContainer"),Un=document.getElementById("btnSettings"),st=document.getElementById("lSimpleLog");function hi(){Ce=!1,window.showSingle(yi),z.clearLog(),console.clear();let e=!0;Array.from(gi.children).forEach(t=>{t.disabled=e}),wi.disabled=e,Un.disabled=e,Un.style.display=e?"none":"flex",Bn.disabled=!e,Bn.style.display=e?"flex":"none",st.style.display="block",st.textContent=""}function $n(){Ce=!1,pi.DisabledUI(!1)}var Lt=class{constructor(t,n,o){this.wfname=t,this.params=n,this.apidata=o;let r=n.params.filter(i=>i.kind===ze.INPUTIMAGE);if(r.length!==1)throw new Error('\u6709\u4E14\u53EA\u80FD\u6709\u4E00\u4E2A"\u83B7\u53D6\u56FE\u7247"\u6761\u4EF6');this.param=r[0];let a=String(Math.round(new Date().getMilliseconds()));if(this.filename=`pslive${a}.jpg`,!kn.activeDocument)throw new Error("\u8BF7\u5148\u6253\u5F00\u4E00\u5F20\u56FE\u7247\uFF01");this.doc=kn.activeDocument,this.docid=this.doc.id,this.outputWidth=-1,this.outputHeight=-1,this.firstLivePrompt=!0,this.docLastChangedTime=0,this.liveRunning=!1,this.sensitivity=window.config.livePromptSensitivity*1e3,this.inactivityTimer=null,St.addNotificationListenerForHistory(this.linstener),this.promptLiveOne()}linstener=async(t,n)=>{if(n.documentID===this.docid&&!this.liveRunning){if(!ze.LIVE_ACTIVE_PS_TOOLS.includes(n.name))return;clearTimeout(this.inactivityTimer),this.sensitivity===0?this.promptLiveOne():this.inactivityTimer=setTimeout(()=>{this.promptLiveOne()},this.sensitivity)}};promptLiveOne=async()=>{try{if(this.liveRunning=!0,Ce)throw Ce=!1,new Error("\u7528\u6237\u4E2D\u6B62\u751F\u56FE");z.log("\u5F00\u59CB\u751F\u56FE"),st.textContent="\u{1F7E2}",this.firstLivePrompt&&z.log("\u6B63\u5728\u8BFB\u53D6PS\u56FE\u50CF");let t=await On.createPSImageLive(this.doc,this.filename,this.firstLivePrompt),n=await We.uploadImageLive(t,this.filename);this.firstLivePrompt&&z.warn(n.path),this.param.value=n.path;let o=this.outputWidth===-1?ze.OUTPUT_ZOOM:ze.OUTPUT_NOZOOM,[r,a]=await We.prompt(this.wfname,this.params,this.apidata,window.config.showDetailLog,o,{width:100,height:100},null,this.firstLivePrompt),{arrayBuffer:i,width:s,height:l}=r[0];this.outputWidth===-1&&(this.outputWidth=s,this.outputHeight=l),this.firstLivePrompt&&z.log("\u6B63\u5728\u5B58\u50A8AI\u56FE\u50CF\u6587\u4EF6");let c=await St.saveTempFile(i,"cfimage.jpg");this.firstLivePrompt&&z.warn(c.nativePath,`${s}*${l}`),this.firstLivePrompt&&z.log("\u6B63\u5728\u6DFB\u52A0\u5230\u56FE\u5C42");let d=await On.addLayerImageLive(this.doc,c,this.wfname,this.outputWidth,this.outputHeight);if(this.firstLivePrompt=!1,z.log(`${mi.getCurrentTime()}\u751F\u56FE\u6210\u529F`),Ce)throw Ce=!1,new Error("\u7528\u6237\u4E2D\u6B62\u751F\u56FE")}catch(t){z.error(t),this.stopLive(),t instanceof We.VerifyError&&document.dispatchEvent(new CustomEvent("verifyUserEvent",{detail:{error:t}}))}finally{st.textContent="",this.liveRunning=!1}};stopLive=async()=>{try{St.removeNotificationListenerForHistory(this.linstener)}catch(t){console.error(t)}$n(),Q=null};paramChanged=async(t,n,o,r)=>{let a=this.params.params.find(i=>i.nodeid===n&&i.field===o);if(a){if(a.value=r,t===ze.PROMPTTEXT){let i=r;window.config.transEnable&&r&&(i=await We.translateToEN(r)),a.valueen=i}this.liveRunning||this.promptLiveOne()}}},Q;async function Ei(e,t,n){try{hi(),Q=new Lt(e,t,n)}catch(o){z.error(o),Q&&Q.stopLive(),$n()}}var Ce=!1;async function vi(){try{if(Q&&!Q.liveRunning){Q.stopLive(),z.error("\u7528\u6237\u4E2D\u6B62\u751F\u56FE");return}Ce=!0,await We.interrupt(),z.error("\u5C1D\u8BD5\u4E2D\u6B62\u751F\u56FE...")}catch(e){z.error(e)}}function bi(){try{let e=document.getElementById("wfBatchPromptHelpDialog");if(e){e.showModal();return}e=document.createElement("dialog"),e.id="wfBatchPromptHelpDialog",e.style.cssText="width: 800px;height: 500px;display: flex;flex-direction: column;";let t=document.createElement("div");t.style.cssText="max-width: 100%;max-height: 100%;overflow: auto;margin: 5px;gap: 5px;display: flex;flex-direction: column;";let n=document.createElement("sp-body");n.innerHTML=`\u5B9E\u65F6\u7ED8\u753B\uFF1A<br>
        \u53EA\u9488\u5BF9\u5F53\u524D\u56FE\u7247\u64CD\u4F5C<br>
        \u5FC5\u987B\u6709\u4E00\u4E2A"\u83B7\u53D6\u56FE\u7247"\u6761\u4EF6<br>
        \u5728\u5F53\u524D\u56FE\u7247\u7684\u5DE6\u534A\u533A\u57DF\u6D82\u9E26\u7ED8\u5236\u8349\u56FE\uFF0C\u5728\u5F53\u524D\u56FE\u7247\u7684\u53F3\u534A\u533A\u57DF\u663E\u793A\u751F\u6210\u7684\u56FE\u7247<br>
        \u6BCF\u6B21\u53EA\u751F\u6210\u4E00\u5F20\u56FE\u7247(\u4E0D\u652F\u6301\u591A\u6279\u6B21)<br>
        \u751F\u56FE\u65F6\u4E0D\u8981\u53D8\u66F4\u5F53\u524D\u6587\u4EF6\uFF0C\u4E0D\u8981\u4FEE\u6539\u753B\u5E03\u5C3A\u5BF8<br>
        \u751F\u56FE\u7075\u654F\u5EA6:\u5047\u5982\u503C\u4E3A2,\u5219\u5F53\u505C\u6B62\u7ED8\u753B2\u79D2\u540E,\u5F00\u59CB\u7ED8\u5236\u4E00\u5F20AI\u56FE\u7247<br>
        \u53EA\u9488\u5BF9\u753B\u7B14\u5DE5\u5177\uFF08B\uFF09\uFF0C\u6A61\u76AE\u64E6\u5DE5\u5177\uFF08E\uFF09\u7B49\u5C11\u6570\u51E0\u79CD\u5DE5\u5177\u5B9E\u65F6\u751F\u56FE<br>
        \u5982\u679C\u4FEE\u6539\u753B\u5E03\u5185\u5BB9\u540E\u672A\u751F\u56FE\uFF0C\u53EF\u4EE5\u7528\u753B\u7B14\u5DE5\u5177\u968F\u610F\u753B\u4E00\u7B14<br>


        `,t.appendChild(n),e.appendChild(t),document.body.appendChild(e),e.showModal()}catch(e){z.error(e)}}function _i(e){try{let t=e.currentTarget.value;window.config.livePromptSensitivity=t,window.saveConfig(),Q&&(Q.sensitivity=parseInt(t*1e3))}catch(t){console.error(t)}}function xi(e){try{if(Q){let t=e.currentTarget.value,n=e.currentTarget.getAttribute("data-kind"),o=e.currentTarget.getAttribute("data-nodeid"),r=e.currentTarget.getAttribute("data-field");Q.paramChanged(n,o,r,t)}}catch(t){console.error(t)}}Nn.exports={interruptPrompt:vi,promptLive:Ei,showHelp:bi,sensitivityChanged:_i,paramChanged:xi}});var jn=D((Bl,Rn)=>{"use strict";var Ue=U("photoshop"),{storage:Dl}=U("uxp"),Ol=U("photoshop").imaging,Fn=X(),kl=B(),Ii=te(),ee=ce();function Ti(e){switch(e){case 1:return[1024,512];case 2:return[1536,512];case 3:return[1024,1024]}}function Ci(e,t,n,o){let r=ee.getDocumentSize(e),a=r.width,i=r.height,s=ee.getLayerBounds(t),l=s.width>=s.height?512*100/s.width:512*100/s.height,c,d;switch(n){case 1:c=256+512*o,d=256;break;case 2:c=256+512*o,d=256;break;case 3:let u=Math.floor(o/2),y=o%2;c=256+512*u,d=256+512*y;break}return[l,c-s.centerX,d-s.centerY]}async function Ai(e,t){try{await Ue.core.executeAsModal(async n=>{e.layers.forEach(async o=>{o.name!=="\u80CC\u666F"&&o.delete()})})}catch(n){Fn.error(n)}}async function Mi(e,t,n,o,r){await ee.activateDocument(e.id);let a=e.activeLayers[0],s={_obj:"placeEvent",null:{_path:await Ii.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:0},vertical:{_unit:"pixelsUnit",_value:0}}},l={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await ee.executeCommand([s,l]);let c=e.activeLayers[0];if(ee.layerEqual(a,c))throw new Error("\u521B\u5EFA\u65B0\u56FE\u5C42\u5931\u8D25");let[d,u,y]=Ci(e,c,o,r);if(d>0){let h={_obj:"transform",_target:[{_ref:"layer",_enum:"ordinal",_value:"targetEnum"}],freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSCanvas"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:u},vertical:{_unit:"pixelsUnit",_value:y}},width:{_unit:"percentUnit",_value:d},height:{_unit:"percentUnit",_value:d}};await ee.executeCommand(h)}}function Si(e,t){let n,o,r,a;switch(e){case 1:n=520,o=10,r=500,a=500;break;case 2:n=1030,o=10,r=500,a=500;break;case 3:n=520,o=520,r=500,a=500;break}return[n,o,r,a]}async function Li(e,t,n,o,r){let a=t.length,[i,s,l,c]=Si(o,r),d={_obj:"make",_target:[{_ref:"textLayer"}],using:{_obj:"textLayer",textKey:t,orientation:{_enum:"orientation",_value:"horizontal"},textShape:[{_obj:"textShape",char:{_enum:"char",_value:"box"},orientation:{_enum:"orientation",_value:"horizontal"},transform:{_obj:"transform",xx:1,xy:0,yx:0,yy:1,tx:i,ty:s},bounds:{top:0,left:0,bottom:l,right:c}}],textStyleRange:[{_obj:"textStyleRange",from:0,to:a,textStyle:{_obj:"textStyle",fontName:"ArialMT",size:{_unit:"pointsUnit",_value:20},color:{_obj:"RGBColor",red:255,green:255,blue:255}}}]},_options:{dialogOptions:"dontDisplay"}},u={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await ee.executeCommand([d,u])}async function Pi(e){try{Fn.log("\u6B63\u5728\u6E05\u9664\u5386\u53F2\u8BB0\u5F55"),await ee.activateDocument(e.id);let t={_obj:"clearEvent",_target:[{_property:"historyStates",_ref:"property"},{_enum:"ordinal",_ref:"document",_value:"targetEnum"}]};await ee.executeCommand(t)}catch(t){console.error(t)}}async function Di(e){let[t,n]=Ti(e);if(Ue.app.activeDocument){let a=ee.getDocumentSize(Ue.app.activeDocument);if(t===a.width&&n===a.height)return Ue.app.activeDocument}let o=await Ue.core.executeAsModal(async a=>await Ue.app.documents.add({name:"\u6279\u91CF\u751F\u56FE",width:t,height:n,resolution:72,fill:"black"}));if(!o)throw new Error("\u521B\u5EFA\u65B0\u56FE\u7247\u5931\u8D25");let r={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:"\u80CC\u666F"}};return await ee.executeCommand(r),o}Rn.exports={createDocumentForBatch:Di,preparePSImageBatch:Ai,addLayerImageBatch:Mi,clearHistory:Pi,addLayerTextBatch:Li}});var Kn=D((zl,Gn)=>{"use strict";var Ge=ne(),Hn=Pe(),Oi=ce(),$e=jn(),Wn=it(),P=te(),W=X(),{app:Ul}=U("photoshop"),F=B(),ki=document.getElementById("lSimpleLog"),$l=document.getElementById("wfButtonContainer"),Nl=document.getElementById("btnPrompt"),Bi=document.getElementById("logContainer"),ql=document.getElementById("btnSettings"),Fl=document.getElementById("btnInterrupt"),Rl=document.getElementById("wfParamContainer"),jl=document.getElementById("wfPreviewImage"),Hl=document.getElementById("wfMainToolbar");function Ui(){Ke=!1,window.showSingle(Bi),W.clearLog(),console.clear(),Wn.DisabledUI(!0)}function $i(){Ke=!1,Wn.DisabledUI(!1)}var Pt=class{constructor(){}createDoc=async()=>{this.outputDoc=await $e.createDocumentForBatch(this.batchImageParams.length)};promptBatch=async(t,n,o,r)=>{let a=performance.now();Ui();try{this.batchImageParams=r;let i=P.joinPath(n.output.folderbatch,F.BATCH_TASK_FILE_NAME),[s,l]=await P.readJsonFile(i),c=P.joinPath(n.output.folderbatch,F.BATCH_OUTPUT_FILE_NAME),[d,u]=await P.readJsonFile(c),y=await P.getEntryWithUrl(`file:${n.output.folderbatch}`),h=r.find(p=>p.batchnamed===!0);h||(h=r[0]);let m=l[h.valuefolder],f=0;for(let p=u.output.length;p<m.length;p++){if(Ke)throw Ke=!1,new Error("\u7528\u6237\u4E2D\u6B62\u751F\u56FE");window.config.batchPromptPreview&&!this.outputDoc&&await this.createDoc(),ki.textContent=`${p+1}/${m.length}`;let w=m[p];W.log(`${p+1}/${m.length}`);let b=[];for(let I=0;I<r.length;I++){let L=r[I].valuefolder,T=l[L][p];if(T===void 0){W.error(`\u6587\u4EF6\u5939\u4E2D\u56FE\u7247\u6570\u91CF\u4E0D\u8DB3(${F.VALID_IMAGE_EXTENSIONS.join(" ")}):${L}`);return}let j=await P.getEntryWithUrl(P.joinPath(L,T));b.push(j)}await this.promptBatchOne(t,n,o,r,b,p,w,y,d,u),f>=2?document.dispatchEvent(new CustomEvent("wfChangeLogSimpleEvent",{detail:{}})):f+=1}let g=((performance.now()-a)/1e3).toFixed(1);W.log(`\u6279\u91CF\u6267\u884C\u5B8C\u6BD5  ${g}\u79D2`)}catch(i){W.error(i),i instanceof Ge.VerifyError&&document.dispatchEvent(new CustomEvent("verifyUserEvent",{detail:{error:i}}))}finally{$i()}};promptBatchOne=async(t,n,o,r,a,i,s,l,c,d)=>{let u=performance.now();this.outputDoc&&await $e.preparePSImageBatch(this.outputDoc,t);for(let m=0;m<r.length;m++){let f=a[m],g=await Ge.uploadImageBatch(f,f.name);W.warn(g.path),r[m].value=g.path,this.outputDoc&&await $e.addLayerImageBatch(this.outputDoc,f,t,r.length,m)}let[y,h]=Hn.extractFileNameAndExtension(s);if(n.output.kind===F.OUTPUTIMAGE){let[m,f]=await Ge.prompt(t,n,o,window.config.showDetailLog,F.OUTPUT_NOZOOM,{width:100,height:100},null);W.log("\u6B63\u5728\u5B58\u50A8\u6587\u4EF6");let g=[];for(let L=0;L<m.length;L++){let{arrayBuffer:T,width:j,height:se}=m[L],tt=L===0?`${y}${f}`:`${y}${L+1}${f}`,le=await l.createFile(tt,{overwrite:!0});if(await P.writeArrayBuffer(le,T),g.push(tt),this.outputDoc){let je=await Oi.saveTempFile(T,L===0?`cfimage${f}`:`cfimage${L+1}${f}`);W.warn(je.nativePath,`${j}*${se}`),await $e.addLayerImageBatch(this.outputDoc,je,t,r.length,r.length)}}d.output.push(g);let{_:p,width:w,height:b}=m[0],I=((performance.now()-u)/1e3).toFixed(1);W.log(window.config.batchPromptPause>0?`\u751F\u56FE\u6210\u529F  ${w}*${b} ${I}\u79D2   \u7761\u7720${window.config.batchPromptPause}\u79D2`:`\u6267\u884C\u6210\u529F  ${w}*${b} ${I}\u79D2`)}else if(n.output.kind===F.OUTPUTTEXT){let f=(await Ge.prompt(t,n,o,window.config.showDetailLog,F.OUTPUT_NOZOOM,{width:100,height:100},null)).text,g=".txt";W.log(f);let p=[],w=`${y}${g}`,b=await l.createFile(w,{overwrite:!0});await P.writeTEXTFile(b,f),p.push(w),this.outputDoc&&await $e.addLayerTextBatch(this.outputDoc,f,t,r.length,r.length),d.output.push(p);let I=((performance.now()-u)/1e3).toFixed(1);W.log(window.config.batchPromptPause>0?`\u6267\u884C\u6210\u529F  ${I}\u79D2   \u7761\u7720${window.config.batchPromptPause}\u79D2`:`\u6267\u884C\u6210\u529F  ${I}\u79D2`)}else throw new Error(`\u672A\u77E5\u8F93\u51FA\u7C7B\u578B${n.output.kind}`);window.config.batchPromptPause>0&&await Hn.sleep(window.config.batchPromptPause*1e3),await P.writeJsonFile(c,d),this.outputDoc&&await $e.clearHistory(this.outputDoc)}};async function Ni(e){let t=P.joinPath(e,F.BATCH_TASK_FILE_NAME);if(!await P.fileExists(t))return!1;let n=P.joinPath(e,F.BATCH_OUTPUT_FILE_NAME);if(!await P.fileExists(n))return!1;let[o,r]=await P.readJsonFile(n);return r.output.length>0}async function qi(e,t,n,o){let r=P.joinPath(t.output.folderbatch,F.BATCH_TASK_FILE_NAME),a={};for(let s=0;s<o.length;s++){let l=o[s].valuefolder,c=await P.getImageFileNamesFromFolder(l,F.VALID_IMAGE_EXTENSIONS);if(c.length===0)throw new Error(`\u6587\u4EF6\u5939\u4E2D\u6CA1\u6709\u6709\u6548\u7684\u56FE\u7247(${F.VALID_IMAGE_EXTENSIONS.join(" ")}):${l}`);a[l]=c}await P.createJsonFile(r,a);let i=P.joinPath(t.output.folderbatch,F.BATCH_OUTPUT_FILE_NAME);await P.createJsonFile(i,{output:[]})}async function Fi(e,t,n,o){let r=P.joinPath(t.output.folderbatch,F.BATCH_TASK_FILE_NAME),[a,i]=await P.readJsonFile(r),s=P.joinPath(t.output.folderbatch,F.BATCH_OUTPUT_FILE_NAME),[l,c]=await P.readJsonFile(s);for(let d=0;d<o.length;d++){let u=o[d].valuefolder;if(!i.hasOwnProperty(u))throw new Error(`\u7B2C${d+1}\u4E2A\u6587\u4EF6\u5939\uFF0C${u},\u8BE5\u76EE\u5F55\u5728\u4EFB\u52A1\u6587\u4EF6\u4E2D\u4E0D\u5B58\u5728\uFF0C\u8BF7\u4FEE\u6539\u5DE5\u4F5C\u6D41\u6216\u91CD\u65B0\u9009\u62E9\u7A7A\u7684\u8F93\u51FA\u6587\u4EF6\u5939`);if(d===0&&i[u].length<=c.output.length)throw new Error(`\u8F93\u5165\u76EE\u5F55${u}\u4E2D\u6709${i[u].length}\u5F20\u56FE\u7247,\u5DF2\u751F\u6210${c.output.length}\u5F20\u7ED3\u679C\u56FE\u7247.\u5F53\u524D\u4EFB\u52A1\u5DF2\u7ECF\u5B8C\u7ED3.`)}}function Ri(){try{let e=document.getElementById("wfBatchPromptHelpDialog");if(e){e.showModal();return}e=document.createElement("dialog"),e.id="wfBatchPromptHelpDialog",e.style.cssText="width: 800px;height: 500px;display: flex;flex-direction: column;";let t=document.createElement("div");t.style.cssText="max-width: 100%;max-height: 100%;overflow: auto;margin: 5px;gap: 5px;display: flex;flex-direction: column;";let n=document.createElement("sp-body");n.innerHTML=`\u6279\u91CF\u751F\u56FE\uFF1A<br>
        \u53EF\u4EE5\u6307\u5B9A\u4E00\u81F3\u4E09\u4E2A\u8F93\u5165\u76EE\u5F55<br>
        \u53EF\u4EE5\u4E2D\u65AD\u540E\u7EE7\u7EED\u6267\u884C\u672A\u5B8C\u6210\u7684\u4EFB\u52A1<br>
        \u652F\u6301\u7684\u56FE\u7247\u7C7B\u578B\u5305\u62EC${F.VALID_IMAGE_EXTENSIONS.join(" ")}<br>
        \u751F\u6210\u7684\u56FE\u7247\u5C06\u4EE5\u7B2C\u4E00\u4E2A\u8F93\u5165\u6587\u4EF6\u5939\u4E2D\u7684\u56FE\u7247\u540D\u79F0\u6765\u547D\u540D<br>
        \u5F00\u59CB\u6279\u91CF\u751F\u56FE\u540E\uFF0C\u4E0D\u8981\u968F\u610F\u53D8\u66F4\u8F93\u5165\u6587\u4EF6\u5939\u53CA\u5176\u4E2D\u7684\u56FE\u7247\uFF0C\u4EE5\u514D\u53D1\u751F\u672A\u77E5\u9519\u8BEF<br>
        \u5F00\u59CB\u6279\u91CF\u751F\u56FE\u540E\uFF0C\u4E0D\u8981\u4FEE\u6539\u6216\u5220\u9664\u8F93\u51FA\u76EE\u5F55\u4E2D\u7684JSON\u6587\u4EF6\uFF0C\u4EE5\u514D\u53D1\u751F\u672A\u77E5\u9519\u8BEF<br>
        \u6279\u5904\u7406\u65F6\uFF0C\u4E0D\u4F1A\u7EA6\u675F\u56FE\u7247\u6587\u4EF6\u7684\u5927\u5C0F\uFF0C\u8BF7\u5728\u5DE5\u4F5C\u6D41\u4E2D\u8FDB\u884C\u9650\u5B9A\uFF0C\u4EE5\u514D\u7206\u663E\u5B58<br>
        `,t.appendChild(n),e.appendChild(t),document.body.appendChild(e),e.showModal()}catch(e){W.error(e)}}var zn;function ji(e,t,n,o){zn=new Pt,zn.promptBatch(e,t,n,o)}var Ke=!1;async function Hi(){try{Ke=!0,await Ge.interrupt(),W.error("\u5C1D\u8BD5\u4E2D\u6B62\u751F\u56FE...")}catch(e){W.error(e)}}Gn.exports={promptBatch:ji,hasBatchTask:Ni,createBatchTask:qi,checkBatchTask:Fi,showHelp:Ri,interruptPrompt:Hi}});var Yn=D((Wl,Xn)=>{"use strict";var Vn=B(),ve,me,Dt,lt,ct,Ot,kt,Bt;function zi(){Dt=document.getElementById("wfMgrNodeOutputDialog"),ve=document.getElementById("wfMgrNodeOutputDialogListNode"),me=document.getElementById("wfMgrNodeOutputDialogListField"),lt=document.getElementById("wfMgrNodeOutputDialogOKButton"),ct=document.getElementById("wfMgrNodeOutputDialogKind"),Ot=document.getElementById("wfMgrNodeOutputDialogZoomDiv"),kt=document.getElementById("wfMgrNodeOutputDialogLess"),Bt=document.getElementById("wfMgrNodeOutputDialogMore"),ve.addEventListener("click",e=>{try{if(e.target.tagName==="SP-MENU-ITEM"){ve.querySelectorAll("sp-menu-item").forEach(n=>n.removeAttribute("selected")),e.target.setAttribute("selected",!0);let t=e.target.getAttribute("data-nodeid");Ut(t)}}catch(t){throw console.error(t),alert(t),t;return}}),me.addEventListener("click",e=>{e.target.tagName==="SP-MENU-ITEM"&&(me.querySelectorAll("sp-menu-item").forEach(t=>t.removeAttribute("selected")),e.target.setAttribute("selected",!0))}),me.addEventListener("dblclick",e=>{e.target.tagName==="SP-MENU-ITEM"&&lt.dispatchEvent(new Event("click"))}),ct.addEventListener("change",e=>{let t=e.currentTarget.value;Ot.style.display=t===Vn.OUTPUTIMAGE?"flex":"none"})}function Ut(e=null,t=null){me.innerHTML="";let n=dt[e],o=n?n.fields:{},r=!1;for(let a in o){let i=document.createElement("sp-menu-item");i.textContent=a,i.setAttribute("data-field",a),i.setAttribute("data-value",o[a]),a===t&&i.setAttribute("selected",!0),me.appendChild(i)}!r&&me.children.length===1&&me.children[0].setAttribute("selected",!0)}function Wi(){ve.innerHTML="";for(let e in dt){let t=dt[e],n=t.fields,o=t.nodeclass,r=t.nodetitle;if(Object.keys(n).length===0)continue;let a=document.createElement("sp-menu-item");a.textContent=`${r}(\u7F16\u53F7${e})`,a.setAttribute("data-nodeid",e),a.setAttribute("data-nodetitle",r),a.setAttribute("data-nodeclass",o),ve.appendChild(a)}}var dt=null;function Gi(e,t,n,o,r,a,i){dt=e,Wi();let s=null;t&&(s=ve.querySelector(`sp-menu-item[data-nodeid="${t}"]`)),t&&s?(s.setAttribute("selected",!0),Ut(t,n)):(ve.querySelectorAll("sp-menu-item").forEach(l=>{l.removeAttribute("selected")}),Ut()),ct.querySelectorAll("sp-menu-item").forEach(l=>{l.value===o?l.setAttribute("selected",!0):l.removeAttribute("selected")}),kt.querySelectorAll("sp-menu-item").forEach(l=>{l.value===r?l.setAttribute("selected",!0):l.removeAttribute("selected")}),Bt.querySelectorAll("sp-menu-item").forEach(l=>{l.value===a?l.setAttribute("selected",!0):l.removeAttribute("selected")}),Ot.style.display=o===Vn.OUTPUTIMAGE?"flex":"none",lt.addEventListener("click",async function l(){try{let c=ve.querySelector("sp-menu-item[selected]"),d=me.querySelector("sp-menu-item[selected]");if(!c||!d)return;let u=c.getAttribute("data-nodeid"),y=c.getAttribute("data-nodetitle"),h=c.getAttribute("data-nodeclass"),m=d.getAttribute("data-field"),f=ct.value,g=kt.value,p=Bt.value;lt.removeEventListener("click",l),Dt.close(),await i(u,y,h,m,f,g,p)}catch(c){throw console.error(c),alert(c),c;return}}),Dt.showModal()}Xn.exports={initShow:zi,show:Gi}});var Qn=D((Gl,Zn)=>{"use strict";var Jn=ne(),Ne,$t,Nt;function Ki(){$t=document.getElementById("wfMgrRecoverDialog"),Ne=document.getElementById("wfMgrRecoverList"),Nt=document.getElementById("wfMgrRecoverDialogOKButton"),Ne.addEventListener("click",e=>{try{e.target.tagName==="SP-MENU-ITEM"&&(Ne.querySelectorAll("sp-menu-item").forEach(t=>t.removeAttribute("selected")),e.target.setAttribute("selected",!0))}catch(t){throw console.error(t),alert(t),t;return}})}function Vi(e){Ne.innerHTML="";for(let t=0;t<e.length;t++){let n=e[t].wfname,o=e[t].deltime,r=e[t].wfid,a=document.createElement("sp-menu-item");a.textContent=`${n}(${o})`,a.setAttribute("data-wfname",n),a.setAttribute("data-wfid",r),Ne.appendChild(a)}}async function Xi(e){let t=await Jn.get_workflows_recover();Vi(t),Nt.addEventListener("click",async function n(){Nt.removeEventListener("click",n);try{let o=Ne.querySelector("sp-menu-item[selected]");if(!o)return;let r=o.getAttribute("data-wfname"),a=o.getAttribute("data-wfid");await Jn.workflows_recover(r,a),$t.close(),e(r)}catch(o){throw console.error(o),alert(o),o;return}}),$t.showModal()}Zn.exports={initShow:Ki,show:Xi}});var to=D((Kl,eo)=>{"use strict";var be=null,pe=null,qt=null,ut=null;function Yi(){qt=document.getElementById("wfMgrNodeFieldDialog"),be=document.getElementById("wfMgrNodeFieldDialogListNode"),pe=document.getElementById("wfMgrNodeFieldDialogListField"),ut=document.getElementById("wfMgrNodeFieldDialogOKButton"),be.addEventListener("click",e=>{try{if(e.target.tagName==="SP-MENU-ITEM"){be.querySelectorAll("sp-menu-item").forEach(n=>n.removeAttribute("selected")),e.target.setAttribute("selected",!0);let t=e.target.getAttribute("data-nodeid");Ft(t)}}catch(t){throw console.error(t),alert(t),t;return}}),pe.addEventListener("click",e=>{e.target.tagName==="SP-MENU-ITEM"&&(pe.querySelectorAll("sp-menu-item").forEach(t=>t.removeAttribute("selected")),e.target.setAttribute("selected",!0))}),pe.addEventListener("dblclick",e=>{e.target.tagName==="SP-MENU-ITEM"&&ut.dispatchEvent(new Event("click"))})}function Ft(e=null,t=null){pe.innerHTML="";let n=ft[e],o=n?n.fields:{},r=!1;for(let a in o){let i=document.createElement("sp-menu-item");i.textContent=a,i.setAttribute("data-field",a),i.setAttribute("data-value",o[a]),a===t&&i.setAttribute("selected",!0),pe.appendChild(i)}!r&&pe.children.length===1&&pe.children[0].setAttribute("selected",!0)}function Ji(){be.innerHTML="";for(let e in ft){let t=ft[e],n=t.fields,o=t.nodeclass,r=t.nodetitle;if(Object.keys(n).length===0)continue;let a=document.createElement("sp-menu-item");a.textContent=`${r}(\u7F16\u53F7${e})`,a.setAttribute("data-nodeid",e),a.setAttribute("data-nodetitle",r),a.setAttribute("data-nodeclass",o),be.appendChild(a)}}var ft=null;function Zi(e,t,n,o){ft=e,Ji();let r=null;t&&(r=be.querySelector(`sp-menu-item[data-nodeid="${t}"]`)),t&&r?(r.setAttribute("selected",!0),Ft(t,n)):(be.querySelectorAll("sp-menu-item").forEach(a=>{a.removeAttribute("selected")}),Ft()),ut.addEventListener("click",async function a(){try{let i=be.querySelector("sp-menu-item[selected]"),s=pe.querySelector("sp-menu-item[selected]");if(!i||!s)return;let l=i.getAttribute("data-nodeid"),c=i.getAttribute("data-nodetitle"),d=i.getAttribute("data-nodeclass"),u=s.getAttribute("data-field"),y=s.getAttribute("data-value");ut.removeEventListener("click",a),qt.close(),await o(l,c,d,u,y)}catch(i){throw console.error(i),alert(i),i;return}}),qt.showModal()}eo.exports={initShow:Yi,show:Zi}});var oo=D((Xl,no)=>{"use strict";var Vl=B();function Qi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function es(e){let t={};for(let n in e){if(!e.hasOwnProperty(n))continue;let o=e[n],r=o.class_type,a=o._meta?o._meta.title:o.class_type;t[n]={nodeclass:r,nodetitle:a,fields:{}};let i=t[n].fields;for(let s in o.inputs){if(!o.inputs.hasOwnProperty(s))continue;let l=o.inputs[s];Array.isArray(l)||(i[s]=l)}}return t}function ts(e){let t={};for(let n in e){if(!e.hasOwnProperty(n))continue;let o=e[n],r=o.class_type,a=o._meta?o._meta.title:o.class_type;t[n]={nodeclass:r,nodetitle:a,fields:{}};let i=t[n].fields;for(let s in o.inputs)o.inputs.hasOwnProperty(s)&&Array.isArray(o.inputs[s])&&(i[s]="")}return t}function ns(e){return!e||typeof e!="object"?!1:Object.keys(e).every(n=>/^\d+$/.test(n))}no.exports={isWfAPI:ns,parsenodes:es,generateUUID:Qi,parsenodeslist:ts}});var jt=D((Yl,go)=>{"use strict";var _e=ne(),ao=Yn(),io=Qn(),so=to(),Me=oo(),k=B();function os(){let e=null;for(let t in V){let o=V[t].nodeclass;if(o==="SaveImage"){e=t;break}else o==="PreviewImage"&&(e=t)}if(e){let t=V[e],n=t.nodetitle,o=t.nodeclass;E.setAttribute("data-nodeid",e),E.setAttribute("data-field","images"),E.setAttribute("data-kind",k.OUTPUTIMAGE),E.setAttribute("data-lesszoom",k.OUTPUT_LESSZOOM),E.setAttribute("data-morezoom",k.OUTPUT_MOREZOOM),E.setAttribute("data-nodetitle",n),E.setAttribute("data-nodeclass",o),E.textContent=`${n}(${e})`}else E.removeAttribute("data-nodeid"),E.removeAttribute("data-field"),E.removeAttribute("data-kind"),E.removeAttribute("data-lesszoom"),E.removeAttribute("data-morezoom"),E.removeAttribute("data-nodetitle"),E.removeAttribute("data-nodeclass"),E.textContent=""}function rs(){let e=null,t=null;for(let n in V){let o=V[n];for(let r in o.fields){let a=o.fields[r];if(r==="image"){e=n,t=r;break}}}if(e){let n=V[e],o=n.nodetitle,r=n.nodeclass,a=n.fields[t];mt(null,e,o,r,t,"\u83B7\u53D6\u56FE\u7247",a,k.INPUTIMAGE,"",!1)}else mt(null,null,null,null,"","\u83B7\u53D6\u56FE\u7247","",k.INPUTIMAGE,"",!1)}function as(){mt(null,null,null,null,"","","",null,"",!0)}function is(e){try{let t=E.getAttribute("data-nodeid"),n=E.getAttribute("data-field"),o=E.getAttribute("data-kind"),r=E.getAttribute("data-lesszoom"),a=E.getAttribute("data-morezoom");ao.show(Le,t,n,o,r,a,(i,s,l,c,d,u,y)=>{E.setAttribute("data-nodeid",i),E.setAttribute("data-field",c),E.setAttribute("data-kind",d),E.setAttribute("data-lesszoom",u),E.setAttribute("data-morezoom",y),E.setAttribute("data-nodetitle",s),E.setAttribute("data-nodeclass",l),E.textContent=`${s}(\u7F16\u53F7${i})`})}catch(t){throw console.error(t),alert(t),t;return}}function ss(e){try{let t=e.currentTarget.getAttribute("data-divid"),n=document.getElementById(t),o=n.querySelector(".wfMgrNode"),r=o.getAttribute("data-nodeid"),a=o.getAttribute("data-field");so.show(V,r,a,async(i,s,l,c,d)=>{o.setAttribute("data-nodeid",i),o.setAttribute("data-nodetitle",s),o.setAttribute("data-nodeclass",l),o.textContent=`\u8282\u70B9=${s}(${i}),   \u5B57\u6BB5=${c}`,o.setAttribute("data-field",c);let u=n.querySelector(".wfMgrTitle");u.value.trim()||(u.value=c);let h=n.querySelector(".wfMgrValue");h.value||(h.value=String(d));let f=n.querySelector(".wfMgrKind");if(!f.value){let[g,p]=await _e.guessFieldKind(l,c),w=n.querySelector(".wfMgrExtra");g&&(f.querySelectorAll("sp-menu-item").forEach(b=>{b.value===g?b.setAttribute("selected",!0):b.removeAttribute("selected")}),g===k.SLIDER&&(w.value=`${p.min},${p.max},${p.step}`))}})}catch(t){throw console.error(t),alert(t),t;return}}function mt(e,t,n,o,r,a,i,s,l,c,d){let u=document.createElement("div");u.id=`wfMgrDiv-${Me.generateUUID()}`,u.innerHTML=co,we.appendChild(u);let y=u.querySelector(".wfMgrNode");y.setAttribute("data-nodeid",t),y.setAttribute("data-field",r),y.setAttribute("data-nodetitle",n),y.setAttribute("data-nodeclass",o),y.setAttribute("data-divid",u.id),y.addEventListener("click",ss),t&&(y.textContent=`\u8282\u70B9=${n}(${t}),   \u5B57\u6BB5=${r}`),u.querySelector(".wfMgrTitle").value=a,e&&(e.named&&y.setAttribute("data-named",e.named),e.placed&&y.setAttribute("data-placed",e.placed));let h=u.querySelector(".wfMgrValue");h.value=String(i),h.setAttribute("data-valuefolder",d);let m=u.querySelector(".wfMgrKind");m.setAttribute("data-divid",u.id),m.querySelectorAll("sp-menu-item").forEach(p=>{p.value===s&&p.setAttribute("selected",!0)}),m.addEventListener("change",p=>{let w=p.currentTarget.value,b=p.currentTarget.getAttribute("data-divid"),I=document.getElementById(b),L=I.querySelector(".wfMgrVisible"),T=I.querySelector(".wfMgrExtra"),j=I.querySelector(".wfMgrValue");switch(T.style.display="block",j.style.display="block",T.parentElement.querySelector("[data-label-extra]").style.display="block",j.parentElement.querySelector("[data-label-value]").style.display="block",w){case k.SLIDER:let se=T.value;se||(r==="denoise"?se="0,1,0.01":r==="steps"?se="1,40,1":se="0,100,1",T.value=se);break;case k.SEED:L.checked=!1;break;case k.INPUTIMAGE:case k.INPUTIMAGEMASK:case k.INPUTREGIONMASK:L.checked=!1,T.style.display="none",T.parentElement.querySelector("[data-label-extra]").style.display="none",j.style.display="none",j.parentElement.querySelector("[data-label-value]").style.display="none";break;case k.FIELDENUM:T.style.display="none",T.parentElement.querySelector("[data-label-extra]").style.display="none";break;default:break}});let f=u.querySelector(".wfMgrExtra");f.value=l,u.querySelector(".wfMgrVisible").checked=c;let g=u.querySelector(".wfMgrDel");switch(g.addEventListener("click",ls),g.setAttribute("data-divid",u.id),s){case k.INPUTIMAGE:case k.INPUTIMAGEMASK:case k.INPUTREGIONMASK:f.style.display="none",f.parentElement.querySelector("[data-label-extra]").style.display="none",h.style.display="none",h.parentElement.querySelector("[data-label-value]").style.display="none";break;case k.FIELDENUM:f.style.display="none",f.parentElement.querySelector("[data-label-extra]").style.display="none";break;default:break}u.addEventListener("contextmenu",p=>{if(p.preventDefault(),Ve>=0){let w=we.children[Ve],b=p.currentTarget;if(!w||!b)return;Ve=-1,we.insertBefore(w,b);let I=w.querySelector(".wfMgrNode"),L=b.querySelector(".wfMgrNode");_e.save_wf_params_sort(H,I.getAttribute("data-nodeid"),I.getAttribute("data-field"),L.getAttribute("data-nodeid"),L.getAttribute("data-field"))}else Ve=Array.from(we.children).indexOf(p.currentTarget)})}function ls(e){let t=e.currentTarget.getAttribute("data-divid"),n=document.getElementById(t);we.removeChild(n)}async function lo(){try{let e=await _e.get_wf_api_run();return e.result?(Y=e,!0):!1}catch(e){throw console.error(e),alert(`\u8BFB\u53D6\u5DE5\u4F5C\u6D41API\u65F6\u51FA\u9519:${e}`),e;return}}async function cs(){if(await lo())try{V=Me.parsenodes(Y.apidata),Le=Me.parsenodeslist(Y.apidata),ge.disabled=!1,Se.disabled=!1,Se.value="\u65B0\u589E\u5DE5\u4F5C\u6D41",document.getElementById("tfwfMgrPath").value=Y.lasttime,we.innerHTML="",os(),rs()}catch(e){throw console.error(e),alert(e),e;return}}async function ds(){if(await lo())try{V=Me.parsenodes(Y.apidata),Le=Me.parsenodeslist(Y.apidata),document.getElementById("tfwfMgrPath").value=Y.lasttime}catch(e){throw console.error(e),alert(e),e;return}}function Xe(){try{let e=document.getElementById("wfPromptContainer"),t=document.getElementById("wfManageContainer");t.style.display="none",e.style.display="flex",Fe&&document.dispatchEvent(new CustomEvent("wfRefreshWorkflowEvent",{detail:{}}))}catch(e){throw console.error(e),alert(e),e}}async function ro(e){try{await io.show(t=>{localStorage.setItem("lastWorkflow",t),Fe=!0,Xe()})}catch(t){throw console.error(t),alert(t),t;return}}var pt=!1,Fe=!1,Se,ge,we,qe,Rt,E,Ae,Ve=-1,co,H,Y,V,Le;async function uo(){pt=!1,Fe=!1,H=null,Y=null,V=null,Le=null,Ve=-1,await window.loadHtml("wfManageContainer","html/wfmanage.html"),Se=document.getElementById("tfwfMgrName"),ge=document.getElementById("btnWfManageSave"),we=document.getElementById("wfManageContainerInner"),qe=document.getElementById("btnWfManageDel"),Rt=document.getElementById("btnWfManageRecover"),E=document.getElementById("tfwfMgrOutput"),Ae=document.getElementById("wfManageLog"),co=await(await fetch("html/wfparamtempelate.html")).text(),document.getElementById("btnWfManageHelp").addEventListener("click",t=>{document.getElementById("wfManageHelpDialog").showModal()}),document.getElementById("btnWfManageReturn").addEventListener("click",async t=>{(!pt||await window.confirm("\u5DE5\u4F5C\u6D41\u5C1A\u672A\u4FDD\u5B58\uFF0C\u786E\u5B9A\u8981\u8FD4\u56DE\u5417\uFF1F"))&&Xe()}),qe.addEventListener("click",us),document.getElementById("tfwfMgrAddParam").addEventListener("click",as),E.addEventListener("click",is),Rt.addEventListener("click",ro),so.initShow(),ao.initShow()}async function us(){try{if(!H||!await confirm("\u786E\u5B9A\u8981\u5220\u9664\u5DE5\u4F5C\u6D41\u5417\uFF1F"))return;Fe=!0,await _e.save_wf_del({wfname:H}),Xe()}catch(e){throw console.error(e),alert(e),e}finally{qe.disabled=!1}}function fo(){let e=E.getAttribute("data-nodeid"),t=E.getAttribute("data-field"),n=E.getAttribute("data-kind"),o=E.getAttribute("data-lesszoom"),r=E.getAttribute("data-morezoom"),a=E.getAttribute("data-nodetitle"),i=E.getAttribute("data-nodeclass"),s=E.getAttribute("data-folderbatch");if(!e||!t){re("\u8BF7\u5148\u8BBE\u7F6E\u7ED3\u679C\u8282\u70B9\u53CA\u5B57\u6BB5");return}if(!(e in Le)){re("\u7ED3\u679C\u8282\u70B9\u4E0D\u6B63\u786E");return}if(!(t in Le[e].fields)){re("\u7ED3\u679C\u8282\u70B9\u5B57\u6BB5\u4E0D\u6B63\u786E");return}let l=[],c=new Set;for(let u=0;u<we.children.length;u++){let y=we.children[u],h=y.querySelector(".wfMgrTitle").value.trim(),m=y.querySelector(".wfMgrNode"),f=m.getAttribute("data-nodetitle"),g=m.getAttribute("data-nodeclass"),p=m.getAttribute("data-nodeid"),w=m.getAttribute("data-field"),b=m.getAttribute("data-named"),I=m.getAttribute("data-placed"),L=y.querySelector(".wfMgrValue").value,T=y.querySelector(".wfMgrValue").getAttribute("data-valuefolder"),j=y.querySelector(".wfMgrKind").value,se=y.querySelector(".wfMgrExtra").value,tt=y.querySelector(".wfMgrVisible").checked;if(!j){re(`\u7B2C${u+1}\u4E2A\u6761\u4EF6\uFF0C\u6761\u4EF6\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A`);return}if(!p||!w){re(`\u7B2C${u+1}\u4E2A\u6761\u4EF6\uFF0C\u8282\u70B9\u53CA\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A`);return}if(!(p in V&&w in V[p].fields)){re(`\u7B2C${u+1}\u4E2A\u6761\u4EF6\uFF0C\u8282\u70B9\u6216\u5B57\u6BB5\u4E0D\u6B63\u786E`);return}let le={title:h,kind:j,nodeid:p,nodetitle:f,nodeclass:g,field:w,value:L,extra:se,visible:tt,valuefolder:T};b&&(le.named=b),I&&(le.placed=I),l.push(le);let je=`${le.nodeid}-${le.field}`;if(c.has(je)){re(`\u627E\u5230\u91CD\u590D: \u8282\u70B9=${le.nodeid}, \u5B57\u6BB5=${le.field}`);return}c.add(je)}return{params:l,output:{nodeid:e,field:t,nodetitle:a,nodeclass:i,folderbatch:s,kind:n,lesszoom:o,morezoom:r}}}function mo(e){Ae.textContent=e,Ae.style.color="lightgreen",setTimeout(()=>{Ae.textContent=""},800)}function re(e){Ae.textContent=e,Ae.style.color="orange",setTimeout(()=>{Ae.textContent=""},2e3)}async function fs(){if(!Y){re("\u8BF7\u5148\u63D0\u53D6\u5DE5\u4F5C\u6D41API,\u5982\u679C\u63D0\u53D6\u4E0D\u5230\uFF0C\u8BF7\u5728COMFYUI\u4E2D\u6267\u884C\u4E00\u6B21\u540E\u518D\u8BD5\uFF01");return}let e=Se.value.trim();if(!e){re("\u5DE5\u4F5C\u6D41\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A");return}let t=fo();t&&(await _e.save_wf_new_run({apidata:Y.apidata,wfname:e,params:t}),pt=!1,Fe=!0,H=e,localStorage.setItem("lastWorkflow",H),mo("\u5DE5\u4F5C\u6D41\u4FDD\u5B58\u6210\u529F"),Xe())}async function po(){let e=Se.value.trim();if(!e){re("\u5DE5\u4F5C\u6D41\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A");return}let t=fo();t&&(await _e.save_wf_edit({wfname:H,wfnamenew:e,params:t,apidata:Y?Y.apidata:null}),pt=!1,Fe=!0,H!==e&&localStorage.setItem("lastWorkflow",e),H=e,mo("\u5DE5\u4F5C\u6D41\u4FDD\u5B58\u6210\u529F"),Xe())}async function ms(){await uo(),io.initShow(),document.getElementById("btnWfManageOpenFile").addEventListener("click",cs),ge.disabled=!0,Se.disabled=!0,qe.style.display="none",Rt.style.display="block",ge.addEventListener("click",async e=>{try{ge.disabled=!0,H?await po():await fs()}catch(t){throw console.error(t),alert(t),t}finally{ge.disabled=!1}}),document.getElementById("btnWfManageOpenFile").dispatchEvent(new Event("click"))}async function ps(e){try{await uo(),document.getElementById("btnWfManageOpenFile").addEventListener("click",ds),qe.disabled=!0,ge.disabled=!0,ge.addEventListener("click",async o=>{try{await po()}catch(r){throw console.error(r),alert(r),r}}),H=e,document.getElementById("tfwfMgrPath").value=`${H}.json`;let t=await _e.get_wf_api(H);V=Me.parsenodes(t),Le=Me.parsenodeslist(t);let n=await _e.get_wf_params(H);n.output.kind||(n.output.kind=k.PROMPTMODE_COMMON),n.output.lesszoom||(n.output.lesszoom=k.OUTPUT_LESSZOOM),n.output.morezoom||(n.output.morezoom=k.OUTPUT_MOREZOOM),Se.value=H,E.setAttribute("data-nodeid",n.output.nodeid),E.setAttribute("data-field",n.output.field),E.setAttribute("data-kind",n.output.kind),E.setAttribute("data-lesszoom",n.output.lesszoom),E.setAttribute("data-morezoom",n.output.morezoom),E.setAttribute("data-nodetitle",n.output.nodetitle),E.setAttribute("data-nodeclass",n.output.nodeclass),E.setAttribute("data-folderbatch",n.output.folderbatch),E.textContent=`${n.output.nodetitle}(${n.output.nodeid})`,n.output.kind||(n.output.kind=k.OUTPUTIMAGE);for(let o of n.params)mt(o,o.nodeid,o.nodetitle,o.nodeclass,o.field,o.title,o.value,o.kind,o.extra,o.visible,o.valuefolder)}catch(t){throw console.error(t),alert(t),t}finally{ge.disabled=!1,qe.disabled=!1}}function gs(){window.loadCSS("../css/wfmgr.css")}go.exports={initPanel:gs,showNew:ms,showEdit:ps}});var zt=D((Zl,vo)=>{"use strict";var yo=te(),Jl=B(),ho="promptHistory.json",wo=30,J={items:[]},Ht=!1;async function Eo(){try{let n=await(await(await yo.getDataFolder()).getEntry(ho)).read(),o=JSON.parse(n);Array.isArray(o.items)?J.items=o.items.map(r=>typeof r=="string"?{text:r,fav:!1}:typeof r=="object"&&r.text?{text:r.text,fav:!!r.fav}:null).filter(r=>r!==null):(console.warn("Invalid history format, resetting."),J.items=[])}catch{J.items=[]}finally{Ht=!0}}async function ws(){try{await(await(await yo.getDataFolder()).createEntry(ho,{overwrite:!0})).write(JSON.stringify(J,null,2))}catch(e){console.error("Error saving history:",e)}}async function ys(e){try{if(!e||typeof e!="string"||e.length<1||(Ht||await Eo(),J.items[0]?.text===e))return;J.items=J.items.filter(t=>t.text!==e),J.items.unshift({text:e,fav:!1}),J.items.length>wo&&(J.items=J.items.slice(0,wo)),await ws()}catch(t){console.error(t)}}async function hs(){return Ht||await Eo(),J.items}vo.exports={add:ys,getHistory:hs}});var Co=D((Ql,To)=>{"use strict";var gt=te(),Gt=ne(),Wt=B(),Kt=ce(),Es=X(),vs=zt(),$=document.getElementById("wfParamContainer");function bs(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function bo(e,t=-1){e.innerHTML="";let n=Kt.getDocuments(),o=!1;for(let r=0;r<n.length;r++){let a=document.createElement("sp-menu-item");a.textContent=n[r].name,a.setAttribute("value",n[r].id),(r===0&&t===-1||n[r].id===t)&&(a.setAttribute("selected",!0),o=!0),e.appendChild(a)}!o&&e.children.length>0&&e.children[0].setAttribute("selected",!0)}function xe(e,t){let n=document.createElement("sp-action-button");return n.style.justifyContent="flex-end",n.setAttribute("quiet",!0),n.textContent=e,n.setAttribute("size","s"),n.addEventListener("click",t),n}function _s(e){let t=e.currentTarget.value;try{Kt.activateDocument(t)}catch(n){console.error(n)}}function ye(e){let t=document.createElement("sp-label");return t.setAttribute("data-input-label",!0),t.textContent=`${e}:`,t.style.marginRight="5px",t.style.width="25%",t}function xs(e,t){let n=e.value,o=ae();$.appendChild(o);let r=ye(e.title);o.appendChild(r);let a=0,i=100,s=1;e.extra&&([a,i,s]=e.extra.split(","));let l=document.createElement("sp-slider");l.setAttribute("min",a),l.setAttribute("max",i),l.setAttribute("step",s),l.setAttribute("variant","filled"),l.setAttribute("gradient","true"),t&&l.addEventListener("change",t),l.style.padding="0px",l.style.flexGrow="1",l.value=n,o.appendChild(l);let c=document.createElement("sp-label");return c.style.justifyContent="flex-end",Number.isInteger(l.value)?c.textContent=`${l.value}`:c.textContent=`${l.value.toFixed(2)}`,c.style.padding="0px",l.addEventListener("input",d=>{Number.isInteger(l.value)?c.textContent=`${l.value}`:c.textContent=`${l.value.toFixed(2)}`}),o.appendChild(c),l}function ae(){let e=document.createElement("div");return e.style.justifyContent="space-between",e.style.display="flex",e.style.width="100%",e}function Is(e){let t=e.value,n=ye(e.title),o=ae();$.appendChild(o),o.appendChild(n),n.addEventListener("click",s=>{$.querySelectorAll("[data-input-image]").forEach(d=>{d.removeAttribute("data-output-placed");let u=d.getAttribute("data-title"),y=d.parentElement.querySelector("[data-input-label]");y.textContent=`${u}:`});let l=s.currentTarget.parentElement.querySelector("sp-picker"),c=l.getAttribute("data-title");l.setAttribute("data-output-placed",!0),s.currentTarget.textContent=`${c}(*):`});let r=document.createElement("sp-picker");r.setAttribute("data-input-image",!0);let a=document.createElement("sp-menu");a.setAttribute("slot","options"),r.appendChild(a),bo(a,e.docid),r.addEventListener("change",_s),r.style.flexGrow="1",o.appendChild(r),e.placed&&(n.textContent=`${e.title}(*):`,r.setAttribute("data-output-placed",!0));let i=xe("",async s=>{try{let l=await gt.getImageFilePath();if(!l)return;let c=await Kt.openImageFile(l),d=s.target.parentElement.parentElement.parentElement.querySelector('sp-menu[slot="options"]');bo(d,c)}catch(l){console.error(l)}});return i.innerHTML=`
    <div slot="icon" style="fill: currentColor">
    <svg viewBox="0 0 36 36" style="width: 18px; height: 18px;">
      <path d="M6 6h24v24H6V6zm2 2v16l5-5 4 4 7-7 4 4V8H8z" fill="currentColor"/>
    </svg>
  </div>`,i.style.padding="0px",o.appendChild(i),r}function xo(e){try{e.focus()}catch{}}function Ts(e){let t=e.output.folderbatch,n=ye("\u8F93\u51FA\u76EE\u5F55"),o=ae();$.appendChild(o),o.appendChild(n);let r=document.createElement("sp-textfield");r.value=t,r.setAttribute("data-output-batchfolder",!0),r.size="s",r.style.flexGrow="1",o.appendChild(r);let a=xe("",async i=>{let s=await gt.getFolder();if(s){let l=i.target.parentElement.querySelector("sp-textfield");l.value=s.nativePath,xo(l)}});return a.innerHTML='<sp-icon name="ui:FolderBreadcrumb" size="s" slot="icon"></sp-icon>',a.style.padding="0px",o.appendChild(a),Io(),r}function Cs(e){let t=e.valuefolder,n=ae();$.appendChild(n);let o=ye(e.title);n.appendChild(o),o.addEventListener("click",i=>{let s=i.currentTarget.parentElement.querySelector("sp-textfield");$.querySelectorAll("[data-input-batchfolder]").forEach(c=>{c.removeAttribute("data-batch-named");let d=c.getAttribute("data-title"),u=c.parentElement.querySelector("[data-input-label]");u.textContent=`${d}:`});let l=s.getAttribute("data-title");s.setAttribute("data-batch-named",!0),i.currentTarget.textContent=`${l}(*):`});let r=document.createElement("sp-textfield");r.setAttribute("data-input-batchfolder",!0),r.value=t,r.style.flexGrow="1",n.appendChild(r),e.batchnamed&&(o.textContent=`${e.title}(*):`,r.setAttribute("data-batch-named",!0));let a=xe("",async i=>{let s=await gt.getFolder();if(s){let l=i.target.parentElement.querySelector("sp-textfield");try{l.value=s.nativePath,xo(l);let c=gt.joinPath(s.nativePath,"output"),d=$.querySelector("[data-output-batchfolder]");(!d.value||d.value==="")&&(d.value=c)}catch(c){console.log(c)}}});return a.innerHTML='<sp-icon name="ui:FolderBreadcrumb" size="s" slot="icon"></sp-icon>',a.style.padding="0px",n.appendChild(a),r}function As(e,t){let n=e.value,o=ye(e.title),r=document.createElement("div");r.style.flexDirection="column",r.style.display="flex",$.appendChild(r);let a=document.createElement("div");a.style.justifyContent="space-between",a.style.display="flex",a.appendChild(o);let i=document.createElement("div");i.style.justifyContent="flex-end",i.style.display="flex",a.appendChild(i);let s=xe("\u4E2D",async m=>{try{let f=m.currentTarget.parentElement.parentElement.parentElement.querySelector("sp-textarea"),g=f.value.trim();if(!g)return;let p=await Gt.translateToZH(g);f.value=p}catch(f){throw console.error(f),alert(`\u7FFB\u8BD1\u65F6\u51FA\u9519${f}`),f}});i.appendChild(s),s.style.display=window.config.transEnable?"flex":"none",s.style.padding="0px";let l=xe("\u82F1",async m=>{try{let f=m.currentTarget.parentElement.parentElement.parentElement.querySelector("sp-textarea"),g=f.value.trim();if(!g)return;let p=await Gt.translateToEN(g);f.value=p}catch(f){throw console.error(f),alert(`\u7FFB\u8BD1\u65F6\u51FA\u9519${f}`),f}});l.style.display=window.config.transEnable?"flex":"none",l.style.padding="0px",i.appendChild(l);let c=xe("\u6587",async m=>{try{let f=m.currentTarget.parentElement.parentElement.parentElement.querySelector("sp-textarea");document.dispatchEvent(new CustomEvent("wfReverseEvent",{detail:{textarea_id:f.id}}))}catch(f){throw console.error(f),alert(`\u7FFB\u8BD1\u65F6\u51FA\u9519${f}`),f}});c.style.padding="0px",i.appendChild(c),r.appendChild(a);let d=document.createElement("sp-textarea");d.style.height=100,d.style.overflow="auto",d.setAttribute("grows",!0),d.setAttribute("maxlength","1500"),d.id=`wfInputText-${bs()}`,d.value=n,r.appendChild(d),d.style.width="100%",t&&d.addEventListener("change",t);let u=ae();u.style.display=window.config.showPromptHistory?"flex":"none",u.setAttribute("data-prompt-history",!0),$.appendChild(u);let y=document.createElement("sp-picker");y.setAttribute("size","s");let h=document.createElement("sp-menu");return h.setAttribute("slot","options"),y.appendChild(h),window.config.showPromptHistory&&_o(h),y.style.flexGrow="1",y.addEventListener("change",m=>{if(h.value){d.value=h.value;let f=h.querySelector("[selected]");f&&f.removeAttribute("selected")}}),u.appendChild(y),o.addEventListener("click",m=>{window.config.showPromptHistory=!window.config.showPromptHistory,window.saveConfig();let f=window.config.showPromptHistory?"flex":"none";$.querySelectorAll("[data-prompt-history]").forEach(g=>{g.style.display=f}),window.config.showPromptHistory&&_o(h)}),d}async function _o(e){e.innerHTML="";let t=await vs.getHistory();for(let n=0;n<t.length;n++){let o=document.createElement("sp-menu-item");o.setAttribute("size","s"),o.textContent=t[n].text.slice(0,28),o.value=t[n].text,e.appendChild(o)}}async function Ms(e,t){e.innerHTML="";let n=!1,o=await Gt.get_wf_nodefield_enum(t.nodeclass,t.field);for(let r=0;r<o.length;r++){let a=document.createElement("sp-menu-item");a.textContent=o[r],o[r]===t.value&&(a.setAttribute("selected",!0),n=!0),e.appendChild(a)}!n&&o.length>0&&e.children[0].setAttribute("selected",!0)}function Ss(e,t){let n=e.value,o=ye(e.title),r=ae();$.appendChild(r),r.appendChild(o);let a=document.createElement("sp-picker"),i=document.createElement("sp-menu");return i.setAttribute("slot","options"),a.appendChild(i),Ms(i,e),a.style.flexGrow="1",t&&a.addEventListener("change",t),r.appendChild(a),a}function Ls(e,t){let n=ae();$.appendChild(n);let o=e.value,r=ye(e.title);n.appendChild(r);let a=document.createElement("sp-textfield");return a.value=o,a.style.flexGrow="1",a.setAttribute("maxlength","100"),t&&a.addEventListener("change",t),n.appendChild(a),a}function Ps(){switch(window.config.promptMode){case Wt.PROMPTMODE_COMMON:return"\u751F\u6210";case Wt.PROMPTMODE_BATCH:return"\u6279\u91CF\u751F\u6210";case Wt.PROMPTMODE_LIVE:return"\u5B9E\u65F6\u7ED8\u753B"}}function Io(){let e=document.createElement("sp-divider");e.style.marginTop="2px",e.style.marginBottom="2px",e.size="s",$.appendChild(e)}function Ds(e){let t=ae();$.appendChild(t);let n=ye("\u654F\u9510\u5EA6(\u79D2)");t.appendChild(n);let o=window.config.livePromptSensitivity,r=0,a=5,i=.1,s=document.createElement("sp-slider");s.setAttribute("min",r),s.setAttribute("max",a),s.setAttribute("step",i),s.setAttribute("variant","filled"),s.setAttribute("gradient","true"),s.style.flexGrow="1",s.style.padding="0px",s.value=o,s.addEventListener("change",e),t.appendChild(s);let l=document.createElement("sp-label");return l.style.justifyContent="flex-end",Number.isInteger(s.value)?l.textContent=`${s.value}`:l.textContent=`${s.value.toFixed(2)}`,l.style.padding="0px",s.addEventListener("input",c=>{Number.isInteger(s.value)?l.textContent=`${s.value}`:l.textContent=`${s.value.toFixed(2)}`}),t.appendChild(l),s}function Os(){let e=ae();$.appendChild(e);let t=ye("\u751F\u56FE\u6682\u505C(\u79D2):");t.setAttribute("data-keep-enabled",!0),e.appendChild(t);let n=window.config.batchPromptPause,o=0,r=60,a=1,i=document.createElement("sp-slider");i.setAttribute("data-keep-enabled",!0),i.setAttribute("min",o),i.setAttribute("max",r),i.setAttribute("step",a),i.setAttribute("variant","filled"),i.setAttribute("gradient","true"),i.style.flexGrow="1",i.style.padding="0px",i.value=n,e.appendChild(i),i.style.width="60%",i.addEventListener("input",c=>{try{Number.isInteger(i.value)?s.textContent=`${i.value}`:s.textContent=`${i.value.toFixed(2)}`;let d=c.currentTarget.value;window.config.batchPromptPause=d,window.saveConfig()}catch(d){console.error(d)}});let s=document.createElement("sp-label");s.setAttribute("data-keep-enabled",!0),s.style.justifyContent="flex-end",Number.isInteger(i.value)?s.textContent=`${i.value}`:s.textContent=`${i.value.toFixed(2)}`,s.style.padding="0px";let l=xe("",c=>{});return l.textContent=window.config.batchPromptPreview?"\u{1F50D}":"---",l.setAttribute("quiet",!0),l.setAttribute("variant","secondary"),l.setAttribute("variant","overBackground"),l.style.padding="0px",l.setAttribute("data-keep-enabled",!0),l.addEventListener("click",()=>{window.config.batchPromptPreview=!window.config.batchPromptPreview,l.textContent=window.config.batchPromptPreview?"\u{1F50D}":"---",window.saveConfig(),Es.log(window.config.batchPromptPreview?"\u5F00\u542F\u9884\u89C8":"\u5173\u95ED\u9884\u89C8")}),e.appendChild(l),i}function ks(e){let t=ae();$.appendChild(t);let n=document.createElement("sp-body");n.style.width="100%",n.style.textAlign="center",n.textContent=e,t.appendChild(n);let o=xe("",r=>{document.dispatchEvent(new CustomEvent("wfEditWorkflowEvent",{detail:{}}))});o.className="btnWfEdit",o.innerHTML=`
    <div slot="icon" style="fill: currentColor">
        <svg viewBox="0 0 36 36" style="width: 14px; height: 14px;">
        <g transform="scale(0.85) translate(8, 0)">
            <path d="M32 9l-6-6-21 21-3 9 9-3L32 9z" />
        </g>
        </svg>
    </div>
    `,o.style.padding="0px",o.title="\u4FEE\u6539\u5DE5\u4F5C\u6D41",t.appendChild(o)}function Bs(e){let t=$.querySelector(`[data-nodeid="${e.nodeid}"][data-field="${e.field}"]`);return t||null}To.exports={createParamPromptText:As,createParamSlider:xs,createParamImage:Is,createParamImageBatch:Cs,createParamOutputBatch:Ts,createParamFIELDENUM:Ss,createParamDefault:Ls,getPromptModeLabel:Ps,createParamDivider:Io,createParamLiveSensitivity:Ds,createParamBatchPause:Os,createWfTitle:ks,getUIParamsInput:Bs}});var Wo=D((ec,zo)=>{"use strict";var{app:Vt}=U("photoshop"),Us=te(),Z=ne(),Ye=it(),Je=qn(),Re=Kn(),Ao=jt(),Zt=X(),R=Co(),Uo=Pe(),v=B(),$o=zt(),No=document.getElementById("btnPrompt"),he=document.getElementById("wfButtonContainer"),Qe=document.getElementById("wfParamContainer"),Mo=document.getElementById("lSimpleLog"),$s=document.getElementById("buttonContainer"),qo=document.getElementById("wfMainToolbar"),Ns=document.getElementById("btnInterrupt"),So=document.getElementById("wfPromptContainer"),Lo=document.getElementById("wfManageContainer"),Yt=document.getElementById("btnAddWorkflow"),Jt=document.getElementById("btnWfRefresh");function Ze(e){$s.querySelectorAll("*").forEach(t=>{t.disabled=e}),qo.querySelectorAll("*").forEach(t=>{t.disabled=e}),Qe.querySelectorAll("*").forEach(t=>{t.hasAttribute("data-keep-enabled")||(t.disabled=e)}),he.style.display!=="none"&&Array.from(he.children).forEach(t=>{t.disabled=e})}function yt(){qo.querySelectorAll("*").forEach(n=>{n.disabled=!1}),Array.from(he.children).forEach(n=>{n.disabled=!1});let t=Qe.querySelector(".btnWfEdit");t&&(t.disabled=!1)}async function qs(e){try{let t=e.currentTarget,n=t.getAttribute("data-wfname");if(n===G)return;Array.from(he.children).forEach(o=>{o.setAttribute("quiet",!0),o.setAttribute("variant","secondary")}),t.removeAttribute("quiet"),t.setAttribute("variant","overBackground"),await Ro(n)}catch(t){throw console.error(t),alert(`\u52A0\u8F7D\u5DE5\u4F5C\u6D41\u65F6\u51FA\u9519:${t}`),t}}function Xt(e,t){let n=null;switch(e.kind){case v.PROMPTTEXT:n=R.createParamPromptText(e,t);break;case v.SLIDER:n=R.createParamSlider(e,t);break;case v.INPUTIMAGE:switch(window.config.promptMode){case v.PROMPTMODE_BATCH:n=R.createParamImageBatch(e);break;default:n=R.createParamImage(e)}break;case v.INPUTIMAGEMASK:n=R.createParamImage(e);break;case v.INPUTREGIONMASK:n=R.createParamImage(e);break;case v.FIELDENUM:n=R.createParamFIELDENUM(e,t);break;default:n=R.createParamDefault(e,t)}n.setAttribute("data-kind",e.kind),n.setAttribute("data-nodeid",e.nodeid),n.setAttribute("data-field",e.field),n.setAttribute("data-title",e.title),n.size="s",R.createParamDivider()}async function Po(e){try{Qe.innerHTML="",Mo.textContent="",Mo.style.display="none",R.createWfTitle(e.newwfname),await Ho(e.newwfname),M.params.forEach(t=>{t.visible?window.config.promptMode===v.PROMPTMODE_LIVE?Xt(t,Je.paramChanged):Xt(t):window.config.promptMode===v.PROMPTMODE_BATCH&&t.kind===v.INPUTIMAGE&&Xt(t)}),window.config.promptMode===v.PROMPTMODE_BATCH?(R.createParamOutputBatch(M),R.createParamBatchPause()):window.config.promptMode===v.PROMPTMODE_LIVE&&R.createParamLiveSensitivity(Je.sensitivityChanged),localStorage.setItem("lastWorkflow",G),Zt.clearLog(),window.showSingle(document.getElementById("logContainer")),Ze(!1)}catch(t){throw Ze(!0),yt(),t}}function Fo(e){Bo=e,Bo==="ADMIN"?(Yt.style.display="flex",Jt.style.display="flex"):(Yt.style.display="none",Jt.style.display="none")}async function Ro(e){if(!e)return;let[t,n]=await Z.test_comfyui_jinn(window.config.comfyuiURL);if(t===!0){Fo(n),await Po({newwfname:e});return}Ze(!0);let o=new CustomEvent("comfyuiConnectEvent",{detail:{data:{newwfname:e},callback:Po}});document.dispatchEvent(o)}async function Do(){M.output.docid=-1;for(let e of M.params){let t=null,n=R.getUIParamsInput(e);switch(n&&(t=n.value),e.kind){case v.SEED:t=t??Uo.randInt(1,1e6),e.value=t;break;case v.PROMPTTEXT:t=t??e.value,e.value=t;let o=t;window.config.transEnable&&t&&(o=await Z.translateToEN(t)),e.valueen=o,$o.add(t);break;case v.INPUTIMAGE:if(window.config.promptMode===v.PROMPTMODE_COMMON){if(!Vt.activeDocument)throw new Error("\u8BF7\u5148\u6253\u5F00\u56FE\u7247");if(t=t??-1,n&&t===-1)throw new Error(`${e.title}:\u6CA1\u6709\u9009\u5B9A\u56FE\u7247`);e.docid=t,n&&n.hasAttribute("data-output-placed")?(e.placed=!0,M.output.docid=e.docid):e.placed=!1}else window.config.promptMode===v.PROMPTMODE_LIVE&&(t=t??-1,e.docid=t);break;case v.INPUTIMAGEMASK:if(window.config.promptMode===v.PROMPTMODE_LIVE)throw new Error(`"${e.title}":\u5B9E\u65F6\u751F\u56FE\u4E0D\u652F\u6301\u56FE\u7247\u8499\u677F\u6761\u4EF6\u3002`);if(window.config.promptMode===v.PROMPTMODE_COMMON){if(!Vt.activeDocument)throw new Error("\u8BF7\u5148\u6253\u5F00\u56FE\u7247");if(t=t??-1,n&&t===-1)throw new Error(`${e.title}:\u6CA1\u6709\u9009\u5B9A\u56FE\u7247`);e.docid=t,n&&n.hasAttribute("data-output-placed")?(e.placed=!0,M.output.docid=e.docid):e.placed=!1}break;case v.INPUTREGIONMASK:if(window.config.promptMode===v.PROMPTMODE_LIVE)throw new Error(`"${e.title}":\u6279\u91CF\u751F\u56FE\u4E0D\u652F\u6301\u9009\u533A\u8499\u677F`);if(window.config.promptMode===v.PROMPTMODE_COMMON){if(!Vt.activeDocument)throw new Error("\u8BF7\u5148\u6253\u5F00\u56FE\u7247");if(t=t??-1,n&&t===-1)throw new Error(`${e.title}:\u6CA1\u6709\u9009\u5B9A\u56FE\u7247`);e.docid=t,n&&n.hasAttribute("data-output-placed")?(e.placed=!0,M.output.docid=e.docid):e.placed=!1}break;default:t=t??e.value,e.value=t}}}async function Fs(){let e=[],t=new Set;for(let r of M.params){let a=null,i=R.getUIParamsInput(r);switch(i&&(a=i.value),r.kind){case v.SEED:a=a??Uo.randInt(1,1e6),r.value=a;break;case v.PROMPTTEXT:a=a??r.value,r.value=a;let s=a;window.config.transEnable&&a&&(s=await Z.translateToEN(a)),$o.add(a),r.valueen=s;break;case v.INPUTIMAGE:if(!a||a.trim()==="")throw new Error(`${r.title}:\u6CA1\u6709\u6307\u5B9A\u76EE\u5F55`);if(t.has(a))throw new Error(`"${r.title}":\u5176\u5B83\u6761\u4EF6\u5DF2\u7ECF\u6307\u5B9A\u4E86\u8BE5\u76EE\u5F55`);t.add(a),r.valuefolder=a,i&&i.hasAttribute("data-batch-named")?r.batchnamed=!0:r.batchnamed=!1,e.push(r);break;case v.INPUTIMAGEMASK:throw new Error(`"${r.title}":\u6279\u91CF\u751F\u56FE\u4E0D\u652F\u6301\u56FE\u7247\u8499\u677F\u6761\u4EF6\u3002`);case v.INPUTREGIONMASK:throw new Error(`"${r.title}":\u6279\u91CF\u751F\u56FE\u4E0D\u652F\u6301\u9009\u533A\u8499\u677F`);default:a=a??r.value,r.value=a}}if(e.length===0)throw new Error("\u6CA1\u6709\u627E\u5230\u201C\u83B7\u53D6\u56FE\u7247\u201D\u6761\u4EF6");if(e.length>3)throw new Error("\u6682\u4E0D\u652F\u63013\u4E2A\u4EE5\u4E0A\u7684\u201C\u83B7\u53D6\u56FE\u7247\u201D\u6761\u4EF6");let o=Qe.querySelector("[data-output-batchfolder]").value;if(!o)throw new Error("\u6CA1\u6709\u6307\u5B9A\u8F93\u51FA\u56FE\u50CF\u7684\u76EE\u5F55");if(t.has(o))throw new Error('"\u8F93\u51FA\u56FE\u50CF":\u5176\u5B83\u6761\u4EF6\u5DF2\u7ECF\u6307\u5B9A\u4E86\u8BE5\u76EE\u5F55');return t.add(o),M.output.folderbatch=o,e}async function Rs(){try{if(!G){alert("\u8BF7\u9009\u62E9\u4E00\u4E2A\u5DE5\u4F5C\u6D41");return}if(!M){alert("\u672A\u6B63\u786E\u52A0\u8F7D\u5DE5\u4F5C\u6D41");return}if(window.config.promptMode===v.PROMPTMODE_BATCH){let e=await Fs(),t;try{t=await Us.getFolderWithCreate(M.output.folderbatch)}catch(n){throw new Error(`"\u8F93\u51FA\u56FE\u50CF":${n.message}`)}if(await Re.hasBatchTask(M.output.folderbatch)){if(await Re.checkBatchTask(G,M,Ie,e),!await confirm('"\u8F93\u51FA\u56FE\u50CF":\u8BE5\u76EE\u5F55\u5DF2\u5B58\u5728\u6279\u91CF\u4EFB\u52A1\uFF0C\u5C06\u81EA\u52A8\u8DF3\u8FC7\u5DF2\u5904\u7406\u7684\u56FE\u7247\uFF0C\u8981\u7EE7\u7EED\u751F\u56FE\u5417\uFF1F'))return}else await Re.createBatchTask(G,M,Ie,e);Re.promptBatch(G,M,Ie,e)}else if(window.config.promptMode===v.PROMPTMODE_LIVE){if(M.output.kind!==v.OUTPUTIMAGE){alert("\u5B9E\u65F6\u751F\u56FE\u65F6\uFF0C\u8F93\u51FA\u7C7B\u578B\u53EA\u80FD\u662F\u56FE\u50CF");return}await Do(),Je.promptLive(G,M,Ie)}else await Do(),M.output.kind===v.OUTPUTIMAGE?Ye.prompt(G,M,Ie):Ye.promptOutputText(G,M,Ie)}catch(e){throw Zt.error(e),e}}var wt=-1;async function Oo(){try{Zt.clearLog(),window.showSingle(document.getElementById("logContainer"));let e=localStorage.getItem("lastWorkflow"),t=-1,n=await Z.get_workflows();for(let o=0;o<n.length;o++)if(n[o].wfname===e){t=o;break}t<0&&n.length>0&&(t=0),he.innerHTML="",Qe.innerHTML="";for(let o=0;o<n.length;o++){let r=n[o],a=document.createElement("sp-action-button");a.setAttribute("data-wfname",r.wfname),a.setAttribute("quiet",!0),a.setAttribute("variant","secondary"),a.size="s",a.style.border="0px solid #0056b3",a.textContent=r.wfname.slice(0,window.config.wfNameLength),t>=0&&r.wfname===n[t].wfname&&(a.setAttribute("variant","overBackground"),a.removeAttribute("quiet")),a.addEventListener("click",qs),a.addEventListener("contextmenu",i=>{if(i.preventDefault(),wt>=0){let s=he.children[wt],l=i.currentTarget;if(!s||!l)return;wt=-1,he.insertBefore(s,l),Z.workflows_sort(s.getAttribute("data-wfname"),l.getAttribute("data-wfname"))}else wt=Array.from(he.children).indexOf(i.currentTarget)}),a.className="dynamic-button",he.appendChild(a)}t>=0?(await Ro(n[t].wfname),n[t].selected=!0):yt(),No.textContent=R.getPromptModeLabel(),document.getElementById("btnWfBatchPromptHelp").style.display=window.config.promptMode===v.PROMPTMODE_BATCH||window.config.promptMode===v.PROMPTMODE_LIVE?"flex":"none"}catch(e){throw Ze(!0),yt(),e}}async function js(){try{Ze(!0),await Ho(null);let[e,t]=await Z.test_comfyui_jinn(window.config.comfyuiURL);if(e===!0){document.dispatchEvent(new CustomEvent("setReverseRefreshEvent",{detail:{}})),Fo(t),await Oo();return}let n=new CustomEvent("comfyuiConnectEvent",{detail:{data:{},callback:Oo}});document.dispatchEvent(n)}catch(e){throw yt(),console.error(e),alert(`\u52A0\u8F7D\u5DE5\u4F5C\u6D41\u5217\u8868\u65F6\u51FA\u9519:${e}`),e}}async function ko(){try{let e=document.getElementById("userInfoDialog"),n=document.getElementById("tfUserInfoPhone").value.trim();if(n.length<7||!/^\d+$/.test(n)){alert("\u8F93\u5165\u4E0D\u6B63\u786E");return}await Z.registry_user(n),e.close()}catch(e){alert(e)}}function Hs(){let e=document.getElementById("userInfoDialog");if(e)return;e=document.createElement("dialog"),e.id="userInfoDialog",e.style.cssText="width:300px; padding:20px; display:flex; flex-direction:column; align-items:center; text-align:center;";let t=document.createElement("sp-body");t.id="tfUserInfoMessage",t.textContent="\u8BF7\u8F93\u5165\u4F60\u7684\u624B\u673A\u53F7\u7801\uFF1A",t.style.marginBottom="15px";let n=document.createElement("sp-textfield");n.id="tfUserInfoPhone",n.setAttribute("maxlength","20"),n.setAttribute("placeholder","\u8BF7\u8F93\u5165\u624B\u673A\u53F7"),n.style.width="100%",n.style.margin="0 auto";let o=document.createElement("sp-action-button");o.id="btnUserInfoSubmit",o.textContent="\u63D0\u4EA4",o.style.marginTop="15px",e.appendChild(t),e.appendChild(n),e.appendChild(o),document.body.appendChild(e)}function zs(e){try{let{error:t}=e.detail;if(t.needinfo){Hs();let n=document.getElementById("userInfoDialog"),o=document.getElementById("btnUserInfoSubmit"),r=document.getElementById("tfUserInfoMessage");r.textContent=t.message,n.showModal(),o.removeEventListener("click",ko),o.addEventListener("click",ko,{once:!0})}else alert(t.message)}catch(t){alert(t)}}async function Ws(e){try{let{textarea_id:t}=e.detail;if(!window.config.reverseWfName){alert("\u8BF7\u5728\u53C2\u6570\u8BBE\u7F6E\u4E2D\u6307\u5B9A\u53CD\u63A8\u5DE5\u4F5C\u6D41");return}let n=await Z.get_wf_params(window.config.reverseWfName),o=await Z.get_wf_api(window.config.reverseWfName);Ye.promptOutputText(window.config.reverseWfName,n,o,async r=>{let a=document.getElementById(t);if(window.config.transEnable){let i=await Z.translateToZH(r);a.value=i}else a.value=r})}catch(t){alert(t)}}function Gs(){Yt.addEventListener("click",t=>{try{Lo.style.display="flex",So.style.display="none",Ao.showNew()}catch(n){throw console.error(n),alert(n),n}}),document.addEventListener("wfEditWorkflowEvent",t=>{try{let n=jo();if(!n)return;Lo.style.display="flex",So.style.display="none",Ao.showEdit(n)}catch(n){throw console.error(n),alert(n),n}}),No.addEventListener("click",Rs),Ns.addEventListener("click",async()=>{window.config.promptMode===v.PROMPTMODE_LIVE?Je.interruptPrompt():window.config.promptMode===v.PROMPTMODE_BATCH?Re.interruptPrompt():Ye.interruptPrompt()}),document.getElementById("btnWfBatchPromptHelp").addEventListener("click",async()=>{window.config.promptMode===v.PROMPTMODE_LIVE?Je.showHelp():Re.showHelp()}),document.addEventListener("wfRefreshWorkflowEvent",js),document.addEventListener("verifyUserEvent",zs),document.addEventListener("wfReverseEvent",Ws),Jt.addEventListener("click",async()=>{document.dispatchEvent(new CustomEvent("wfRefreshWorkflowEvent",{detail:{}}))}),document.dispatchEvent(new CustomEvent("wfRefreshWorkflowEvent",{detail:{}})),document.addEventListener("wfLoadTempImageEvent",async t=>{try{Ye.loadTempImage(t.detail)}catch(n){console.error(n)}})}function jo(){return G}var G,M,Ie,Bo="";async function Ho(e){G=e,G!==null?(M=await Z.get_wf_params(G),M.output.kind||(M.output.kind=v.OUTPUTIMAGE),M.output.field||(M.output.field="images"),Ie=await Z.get_wf_api(G)):(M=null,Ie=null)}zo.exports={initPanel:Gs,getWfname:jo}});var Xo=D((tc,Vo)=>{"use strict";var Ks=ne(),Go=te(),Et=B(),S={comfyuiURL:"http://127.0.0.1:8188",setAILayer:Et.SETAILAYERCLOSE,wfDisplayType:"button",wfNameLength:10,pszoomMinsize:"512",pszoomMaxsize:"1024",showDetailLog:!1,outputPreview:!1,transEnable:!1,transBaiduAppID:"",transBaiduAppKey:"",promptMode:Et.PROMPTMODE_COMMON,livePromptSensitivity:2,batchPromptPause:2,batchPromptPreview:!0,reverseWfName:"",loadTempImage:!1,showPromptHistory:!0};window.config=S;var Ko="pluginConfig.json";async function Vs(){try{let n=await(await(await Go.getDataFolder()).getEntry(Ko)).read(),o=JSON.parse(n);Object.assign(S,o)}catch{console.log("\u4F7F\u7528\u9ED8\u8BA4\u53C2\u6570")}}async function ie(){try{await(await(await Go.getDataFolder()).createEntry(Ko,{overwrite:!0})).write(JSON.stringify(S,null,2))}catch(e){console.error("Error saving config:",e)}}window.saveConfig=ie;function ht(e,t){e.forEach(n=>{n.getAttribute("data-value")===t?n.removeAttribute("quiet"):n.setAttribute("quiet","")})}async function Xs(){let e=document.getElementById("btnSetDisplayTypePicker"),t=document.getElementById("btnSetDisplayTypeButton"),n=document.getElementById("btnSetAILayerClose"),o=document.getElementById("btnSetAILayerDel"),r=document.getElementById("btnSetAILayerOmit");document.getElementById("btnSetComfyuiURL").addEventListener("click",p=>{let w=I=>{window.showSingle(document.getElementById("settingsContainer"))},b=new CustomEvent("comfyuiConnectEvent",{detail:{data:{},callback:w}});document.dispatchEvent(b)});let a=[n,o,r];a.forEach(p=>{p.addEventListener("click",w=>{let b=w.currentTarget.getAttribute("data-value");b!==S.setAILayer&&(S.setAILayer=b,ie(),ht([n,o,r],S.setAILayer),S.setAILayer===Et.SETAILAYERDEL&&alert("\u542F\u7528\u8BE5\u53C2\u6570\u65F6\uFF0CAI\u751F\u56FE\u540E\u4F1A\u5220\u9664\u5176\u5B83\u7531AI\u751F\u6210\u7684\u56FE\u5C42\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"))})}),ht(a,S.setAILayer);let i=document.getElementById("spSetMaxSize"),s=document.getElementById("spSetMinSize");i.querySelectorAll("sp-menu-item").forEach(p=>{p.value===S.pszoomMaxsize&&p.setAttribute("selected",!0)}),s.querySelectorAll("sp-menu-item").forEach(p=>{p.value===S.pszoomMinsize&&p.setAttribute("selected",!0)}),i.addEventListener("change",p=>{let w=p.currentTarget.value;S.pszoomMaxsize=w,ie()}),s.addEventListener("change",p=>{let w=p.currentTarget.value;S.pszoomMinsize=w,ie()});let l=document.getElementById("cbSetLoadTempImage");l.checked=S.loadTempImage,l.addEventListener("change",async p=>{try{let w=document.getElementById("cbSetLoadTempImage").checked;S.loadTempImage=w,ie()}catch(w){throw console.error(w),alert(w),w}});let c=document.getElementById("cbSetTransEnable");c.checked=S.transEnable,c.addEventListener("change",async p=>{try{let w=document.getElementById("cbSetTransEnable").checked;S.transEnable=w,ie()}catch(w){throw console.error(w),alert(w),w}});let d=document.getElementById("cbSetTransBaiduAppID");d.value=S.transBaiduAppID,d.addEventListener("change",async p=>{try{let w=document.getElementById("cbSetTransBaiduAppID").value;S.transBaiduAppID=w,ie()}catch(w){throw console.error(w),alert(w),w}});let u=document.getElementById("cbSetTransBaiduAppKey");u.value=S.transBaiduAppKey,u.addEventListener("change",async p=>{try{let w=document.getElementById("cbSetTransBaiduAppKey").value;S.transBaiduAppKey=w,ie()}catch(w){throw console.error(w),alert(w),w}}),document.getElementById("btnSetTransBaiduHelp").addEventListener("click",p=>{document.getElementById("cbSetTransHelpBaiduDialog").showModal()}),document.getElementById("spSetReverse").addEventListener("change",p=>{let w=p.currentTarget.value;S.reverseWfName=w,ie()}),document.addEventListener("setReverseRefreshEvent",async p=>{try{if(document.getElementById("settingsContainer").children.length===0)return;let b=document.getElementById("spSetReverse"),I=await Ks.get_workflows(),L=b.querySelector('sp-menu[slot="options"]');L.innerHTML="";for(let T=0;T<I.length;T++){if(I[T].output_kind!==Et.OUTPUTTEXT)continue;let j=document.createElement("sp-menu-item");j.textContent=I[T].wfname,I[T].wfname===S.reverseWfName&&j.setAttribute("selected",!0),L.appendChild(j)}}catch(w){console.error(w)}}),document.dispatchEvent(new CustomEvent("setReverseRefreshEvent",{detail:{}}));let h=document.getElementById("btnSetPromptCommon"),m=document.getElementById("btnSetPromptBatch"),f=document.getElementById("btnSetPromptLive"),g=[h,m,f];g.forEach(p=>{p.addEventListener("click",w=>{let b=w.currentTarget.getAttribute("data-value");b!==S.promptMode&&(S.promptMode=b,ie(),ht(g,S.promptMode),document.dispatchEvent(new CustomEvent("wfRefreshWorkflowEvent",{detail:{}})))})}),ht(g,S.promptMode)}Vo.exports={loadConfig:Vs,initPanel:Xs}});var er=D((nc,Qo)=>{"use strict";var Yo=ne(),Ys=B();function et(e,t=!0){let n=document.getElementById("divTestInfo");n.innerHTML=`${e}`,t?n.style.color="#ff5555":n.style.color="lightgreen"}async function Js(e,t){let n=document.getElementById("btnConnect"),o=document.getElementById("tfComfyuiURL"),r=o.value.trim();try{r=r.match(/^https?:\/\//)?r:`http://${r}`,r=r.replace(/\/+$/,""),new URL(r)}catch(s){et(`URL\u4E0D\u5408\u6CD5:${r}`),console.log(s);return}et(`\u5C1D\u8BD5\u8FDE\u63A5\u5230:${r}`),n.disabled=!0;try{await Yo.test_comfyui(r)}catch(s){et("\u8FDE\u63A5COMFYUI\u5931\u8D25<br>\u8BF7\u590D\u5236\u4E0A\u9762\u7684\u5730\u5740\u5230\u6D4F\u89C8\u5668\uFF0C\u4EE5\u68C0\u67E5COMFYUI\u662F\u5426\u542F\u52A8"),console.log(s),n.disabled=!1;return}let[a,i]=await Yo.test_comfyui_jinn(r);if(a!==!0){et("COMFYUI\u5DF2\u8FDE\u63A5,\u4F46\u662F\u6CA1\u6709\u5B89\u88C5comfyui_jinn\u63D2\u4EF6<br>\u8BF7\u5C06\u5B89\u88C5\u5305\u4E2D\u7684comfyui_jinn_ps\u76EE\u5F55\u590D\u5236\u5230COMFYUI\u4E0B\u7684custom_nodes\u76EE\u5F55\uFF0C\u91CD\u542FCOMFYUI\u670D\u52A1\u518D\u8BD5"),n.disabled=!1;return}window.config.comfyuiURL=r,window.saveConfig(),o.value=window.config.comfyuiURL,et("\u8FDE\u63A5COMFYUI\u6210\u529F!",!1),n.disabled=!1;try{await e(t)}catch(s){throw console.error(s),alert(s),s}}var Jo=null,Zo=null;function Zs(e,t){let n=document.getElementById("connContainer");window.showSingle(n);let o=document.getElementById("divTestInfo");o.innerHTML="";let r=document.getElementById("tfComfyuiURL");r.value=config.comfyuiURL,Jo=e,Zo=t}document.addEventListener("comfyuiConnectEvent",e=>{let{data:t,callback:n}=e.detail;Zs(n,t)});async function Qs(){document.getElementById("connContainer").innerHTML.trim()===""&&await window.loadHtml("connContainer","html/connect.html");let t=document.getElementById("btnResetComfyuiURL"),n=document.getElementById("btnConnect");t.addEventListener("click",()=>{tfComfyuiURL.value=Ys.DEFAULT_COMFYUI_URL}),n.addEventListener("click",async o=>{await Js(Jo,Zo)})}Qo.exports={initPanel:Qs}});var nr=D(()=>{var{entrypoints:el}=U("uxp");typeof window.alert!="function"&&(window.alert=async function(e=""){let t=document.getElementById("alertDialog");t||(t=document.createElement("dialog"),t.innerHTML=`
      <sp-body>${e}</sp-body>
      <div style="width:100%;display: flex; justify-content:center;">
        <sp-action-button id="alertDialogOK" >\u786E\u5B9A</sp-action-button>
      </div>
      `,document.body.appendChild(t),t.querySelector("#alertDialogOK").addEventListener("click",()=>{t.close(),resolve(!0)})),t.querySelector("sp-body").textContent=e,t.style.width="350px",t.id="alertDialog",t.showModal()});typeof window.confirm!="function"&&(window.confirm=async function(e="\u786E\u5B9A\u8981\u7EE7\u7EED\u5417\uFF1F"){let t=document.getElementById("confirmDialog");return t||(t=document.createElement("dialog"),t.innerHTML=`
          <sp-body  style="width=100%;">${e}</sp-body>
          <div style="width:100%;display: flex; justify-content:center;">
            <sp-action-button id="confirmDialogCancel">\u53D6\u6D88</sp-action-button>
            <sp-action-button id="confirmDialogOK" >\u786E\u5B9A</sp-action-button>
          </div>
      `,t.id="confirmDialog",t.style.width="350px",document.body.appendChild(t)),t.querySelector("sp-body").textContent=e,new Promise(n=>{t.querySelector("#confirmDialogOK").addEventListener("click",()=>{t.close(),n(!0)}),t.querySelector("#confirmDialogCancel").addEventListener("click",()=>{t.close(),n(!1)}),t.showModal()})});el.setup({panels:{"jinn_ps_ai.panel_main":{show(e){},create(){},hide(){},destroy(){},menuItems:[],invokeMenu(e){}}}});window.loadHtml=async function(t,n){try{let r=await(await fetch(n)).text();document.getElementById(t).innerHTML=r}catch(o){throw console.log(`\u52A0\u8F7D${n}\u5931\u8D25`,o),o}};window.loadCSS=function(t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,document.head.appendChild(n)};window.showSingle=function(e){Array.from(il.children).forEach(t=>{t===e?t.style.display="flex":t.style.display="none"})};async function tl(){Qt.children.length===0&&(await window.loadHtml("settingsContainer","html/settings.html"),await tr.initPanel()),Qt.style.display!=="none"?window.showSingle(sl):window.showSingle(Qt)}document.body.innerHTML=`
  <div id="wfPromptContainer">
    <div id="wfMainToolbar" style="display: flex; align-items: center;  justify-content:flex-end; ">
      <div style="display: flex; align-items: center;  justify-content: flex-end;">
        <sp-action-button id="btnWfBatchPromptHelp" title="\u5E2E\u52A9" style="display: none;" quiet><sp-icon name="ui:HelpSmall" size="s" slot="icon"></sp-icon></sp-action-button>

        <sp-action-button id="btnAddWorkflow" title="\u6DFB\u52A0\u5DE5\u4F5C\u6D41" size="s" style="display: none;" quiet>
          <div slot="icon" style="fill: currentColor"><svg viewBox="0 0 36 36" style="width: 18px; height: 18px;"><path d="M16 2v14H2v4h14v14h4V20h14v-4H20V2h-4z" fill="currentColor" /></svg></div>
        </sp-action-button>
        <sp-action-button id="btnWfRefresh" title="\u5237\u65B0" size="s" style="display: none;" quiet>
          <div slot="icon" style="fill: currentColor">
            <svg viewBox="0 0 36 36" style="width: 18px; height: 18px;"><path d="M18 4a14 14 0 1 0 13.86 16h-3.02a11 11 0 1 1-2.68-9.29l-3.46 3.47H32V4l-3.92 3.92A13.95 13.95 0 0 0 18 4z" fill="currentColor"/></svg>
          </div>
        </sp-action-button>
      </div>
    </div>
    
    <sp-divider size="medium" style="margin-top: 0px; margin-top: 5px;"></sp-divider>
    <div id="wfButtonContainer" style="display: flex;flex-wrap: wrap; overflow-y: auto;"></div>
    <sp-divider size="medium" style="margin-top: 2px; margin-bottom: 0px;"></sp-divider>

    <div id="wfParamContainer" class="wfParamContainer">
    </div>
    
    <div id="buttonContainer" style="display: flex;flex-direction: row;  justify-content: space-between; align-items: center; width: 100%;margin-top: 5px;">
      <div style="width: 30%; display: flex; justify-content:flex-start;">
        <sp-action-button id="btnInterrupt" title="\u4E2D\u65AD"  size="xxs" style="display: none; justify-content: flex-end;margin-right: 0px;" variant="warning" quiet>\u2715</sp-action-button>
      </div>
      
      <sp-button id="btnPrompt" style="width: 30%;  position: absolute;left: 50%;transform: translateX(-50%);">\u751F\u6210</sp-button>
      

      <div style="width: 30%;height:100%; display: flex; justify-content:flex-end;">
        <sp-label id="lSimpleLog" style="display: none; justify-content: flex-end;text-align: right;"></sp-label>
        <sp-action-button id="btnSettings" title="\u8BBE\u7F6E" style=" justify-content: flex-end; margin-top: auto" quiet>
          <div slot="icon" style="fill: currentColor">
            <svg viewBox="8 8 16 16" style="width: 18px; height: 18px;"><path fill-rule="evenodd" clip-rule="evenodd" d="M21.6809 16.2095C21.6809 16.5068 21.8334 16.772 22.0878 16.9206C23.1918 17.5625 23.5706 18.9877 22.9343 20.0987C22.6239 20.6386 22.1235 21.0244 21.5246 21.1855C20.9294 21.3427 20.307 21.2618 19.7725 20.9513C19.5197 20.8036 19.2186 20.8036 18.9657 20.9497C18.709 21.0968 18.5558 21.3637 18.5558 21.6616C18.5558 22.9446 17.5179 23.9894 16.242 23.9894C14.9653 23.9894 13.9275 22.9446 13.9275 21.6616C13.9275 21.3628 13.7742 21.0968 13.5176 20.949C13.2647 20.8036 12.9636 20.8036 12.7123 20.9513C12.1771 21.2618 11.5539 21.3442 10.9572 21.1847C10.3589 21.0237 9.85945 20.6379 9.54981 20.0987C8.91342 18.9877 9.29308 17.5617 10.3963 16.9199C10.6507 16.7728 10.8024 16.5068 10.8024 16.2095C10.8024 15.9123 10.6507 15.6463 10.3963 15.4985C9.29308 14.8582 8.91342 13.4329 9.54981 12.3212C9.85945 11.7812 10.3589 11.3954 10.958 11.2343C11.5554 11.074 12.1771 11.1581 12.7123 11.4685C12.9643 11.6163 13.2655 11.6148 13.5176 11.4701C13.7742 11.3222 13.9275 11.0561 13.9275 10.7574C13.9275 9.47452 14.9653 8.42969 16.242 8.42969C17.5179 8.42969 18.5558 9.47452 18.5558 10.7574C18.5558 11.0554 18.709 11.3222 18.9657 11.4692C19.2193 11.6163 19.5205 11.6163 19.7725 11.4685C20.3063 11.1581 20.9285 11.0756 21.5246 11.2335C22.1235 11.3946 22.6239 11.7805 22.9343 12.3204C23.5706 13.4321 23.1918 14.8574 22.0885 15.4992C21.8334 15.647 21.6809 15.9123 21.6809 16.2095ZM16.2419 18.5434C14.955 18.5434 13.9079 17.4962 13.9079 16.2094C13.9079 14.9226 14.955 13.8755 16.2419 13.8755C17.5287 13.8755 18.5758 14.9226 18.5758 16.2094C18.5758 17.4962 17.5287 18.5434 16.2419 18.5434Z"fill="#7D7D7D"></path> </svg>
          </div>
        </sp-action-button>
      </div>
      

    </div>

    <div id='singleContainer' style="margin-top: 15px;">
      <div id="logContainer" style="display: flex;flex-direction: column;width: 100%;"></div>
      <div id="settingsContainer" style="display: none;flex-direction: column; overflow-y: auto;"></div>
      <div id="connContainer" style="display: none;"></div>
    </div>
    <div style="display: none; flex-direction: column; height: 200px; overflow: hidden;">
      <img id="wfPreviewImage" src="" alt="Preview" style="width: auto; height: auto; max-width: 100%; max-height: 100%; object-fit: contain;" >
    </div>
  </div>
  
  
  <div id="wfManageContainer" style="display: none;"></div>

`;var nl=Wo(),ol=jt(),rl=X(),tr=Xo(),al=er(),il=document.getElementById("singleContainer"),sl=document.getElementById("logContainer"),Qt=document.getElementById("settingsContainer");document.getElementById("btnSettings").addEventListener("click",tl);document.addEventListener("DOMContentLoaded",async()=>{try{await tr.loadConfig(),await window.loadHtml("logContainer","html/logger.html"),rl.initPanel(),al.initPanel(),nl.initPanel(),ol.initPanel()}catch(e){throw console.log(e),e}})});nr();})();
