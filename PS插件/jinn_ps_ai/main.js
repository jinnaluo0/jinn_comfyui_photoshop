(()=>{var B=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var D=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var U=D(x=>{"use strict";x.TEMP_CHANNEL_NAME="JinnSelectionChannel";x.INPUTIMAGE="INPUTIMAGE";x.INPUTIMAGEMASK="INPUTIMAGEMASK";x.INPUTREGIONMASK="INPUTREGIONMASK";x.OUTPUTIMAGE="OUTPUTIMAGE";x.OUTPUTTEXT="OUTPUTTEXT";x.SEED="SEED";x.PROMPTTEXT="PROMPTTEXT";x.TEXTFIELD="TEXTFIELD";x.SLIDER="SLIDER";x.FIELDENUM="FIELDENUM";x.TEXT="TEXT";x.SETAILAYERCLOSE="close";x.SETAILAYERDEL="del";x.SETAILAYEROMIT="omit";x.DEFAULT_COMFYUI_URL="http://127.0.0.1:8188";x.OUTPUT_ZOOM="OUTPUT_ZOOM";x.OUTPUT_NOZOOM="OUTPUT_NOZOOM";x.OUTPUT_LESSZOOM="OUTPUT_LESSZOOM";x.OUTPUT_LESSREAL="OUTPUT_LESSREAL";x.OUTPUT_MOREZOOM="OUTPUT_MOREZOOM";x.OUTPUT_MOREREAL="OUTPUT_MOREREAL";x.PROMPTMODE_COMMON="COMMON";x.PROMPTMODE_BATCH="BATCH";x.PROMPTMODE_LIVE="LIVE";x.MINETYPES={".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".bmp":"image/bmp",".gif":"image/gif",".webp":"image/webp"};x.VALID_IMAGE_EXTENSIONS=[".jpg",".jpeg",".png",".gif",".bmp",".webp"];x.BATCH_TASK_FILE_NAME="task.json";x.BATCH_OUTPUT_FILE_NAME="output.json";x.LIVE_ACTIVE_PS_TOOLS=["Pencil","Brush Tool","Color Replacement Tool","Mixer Brush","Eraser","Background Eraser","Magic Eraser","Dodge Tool","Burn Tool","Sponge Tool"]});var ie=D((Zs,Jt)=>{var{storage:Et}=B("uxp"),$=Et.localFileSystem,Ys=U();async function Ko(){return $.getTemporaryFolder()}async function Vo(){return $.getDataFolder()}async function Xo(e){return $.createSessionToken(e)}async function Yo(e){return $.getFileForSaving(e)}async function Zo(){return $.getFolder()}async function Jo(){let e=await $.getFileForOpening();if(e)return e}async function Qo(e){return $.getEntryWithUrl(e)}async function er(e){return $.getFileForOpening(e)}async function tr(e,t){try{let o=await(await $.getEntryWithUrl(`file:${e}`)).getEntries(),r=[];for(let a of o)if(a.isFile){let i=a.name.slice(a.name.lastIndexOf(".")).toLowerCase();t.includes(i)&&r.push(a.name)}return r}catch(n){throw console.error(n),new Error(`\u83B7\u53D6\u6587\u4EF6\u5939\u5185\u56FE\u7247\u65F6\u51FA\u9519:${e}`)}}async function nr(e,t){try{let o=await(await $.getEntryWithUrl(`file:${e}`)).getEntries(),r=[];for(let a of o){let i=a.name.slice(a.name.lastIndexOf(".")).toLowerCase();if(a.isFile&&t.includes(i))return!0}return!1}catch{return!1}}async function or(e){let t;try{t=await $.getEntryWithUrl(e)}catch{try{await $.createEntryWithUrl(e,{type:"folder"})}catch(o){throw console.log(o),new Error(`\u521B\u5EFA\u76EE\u5F55\u5931\u8D25${e}`)}}try{if(t=await $.getEntryWithUrl(e),t.isFolder)return t;throw new Error(`\u76EE\u5F55\u4E0D\u6B63\u786E${e}`)}catch{throw new Error(`\u76EE\u5F55\u4E0D\u6B63\u786E${e}`)}}async function rr(e){try{return!!(await $.getEntryWithUrl(e)).isFile}catch{return!1}}function ar(e,...t){let n=e.includes("/")?"/":"\\",o=e;(o.endsWith("/")||o.endsWith("\\"))&&(o=o.slice(0,-1));for(let r of t)(r.startsWith("/")||r.startsWith("\\"))&&(r=r.slice(1)),o+=`${n}${r}`;return o}async function ir(e){return e.read({format:Et.formats.binary})}async function sr(e,t){return e.write(t,{format:Et.formats.binary})}async function lr(e){let t=await $.getEntryWithUrl(e),n=await t.read(),o=JSON.parse(n);return[t,o]}async function cr(e,t){let n=await $.createEntryWithUrl(e,{overwrite:!0});return Zt(n,t),n}async function Zt(e,t){await e.write(JSON.stringify(t,null,2))}async function ur(e,t){await e.write(t)}Jt.exports={getTemporaryFolder:Ko,getDataFolder:Vo,createSessionToken:Xo,getFileForSaving:Yo,getFileForOpening:er,getFolder:Zo,getEntryWithUrl:Qo,getImageFilePath:Jo,getImageFileNamesFromFolder:tr,getFolderWithCreate:or,fileExists:rr,joinPath:ar,hasImageFile:nr,readArrayBuffer:ir,writeArrayBuffer:sr,writeJsonFile:Zt,readJsonFile:lr,createJsonFile:cr,writeTEXTFile:ur}});var X=D((Qs,on)=>{"use strict";var Js=U(),C=null;function en(){let e=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),t=Math.round(new Date().getMilliseconds());return`${e}.${t}`}function dr(e,t,n,o){let r=C.querySelector(`[data-node-id="${t}"]`);if(r){r.value=o,r.max=n;return}r=vt("sp-progressbar"),r.style.margin="5 0px",r.setAttribute("data-node-id",t),r.value=o,r.max=n,window.config.showDetailLog,C.appendChild(r),C.scrollTop=C.scrollHeight}var tn=30;function vt(e,t,n=!1){let o=null;return window.config.showDetailLog||C.children.length===0?o=document.createElement(e):C.children.length>0&&(C.children[C.children.length-1].style.display="none",o=document.createElement(e)),o.addEventListener("click",hr),o.setAttribute("size","s"),o.style.width="100%",o}function bt(e){let t=vt("div");if(window.config.showDetailLog){let n=en();t.textContent=`${n} ${e}`}else t.textContent=e;C.appendChild(t),C.childNodes.length>tn&&C.removeChild(C.firstChild),C.scrollTop=C.scrollHeight}function Qt(e){let t=vt("div");if(window.config.showDetailLog){let n=en();t.textContent=`${n} ${e}`}else t.textContent=e;t.style.color="#ff5555",C.appendChild(t),C.childNodes.length>tn&&C.removeChild(C.firstChild),C.scrollTop=C.scrollHeight}var fr=(...e)=>{bt(e.join(" ")),window.config.showDetailLog&&console.log(...e)},mr=(...e)=>{bt(e.join(" ")),window.config.showDetailLog&&console.log(...e)},pr=(...e)=>{e&&e[0]instanceof Error?Qt(e[0].message):Qt(e.join(" ")),window.config.showDetailLog&&console.error(...e)},gr=(e,t,n,o)=>{dr(e,t,n,o)};async function wr(){document.getElementById("logArea").innerHTML=""}async function yr(){let e=document.getElementById("logArea");try{let t=Array.from(e.childNodes).map(n=>n.textContent).join(`\r
`);navigator.clipboard.write({"text/plain":t})}catch(t){bt(`Copy failed: ${t.message}`)}}function nn(e){window.config.showDetailLog=e,window.saveConfig(),window.config.showDetailLog?(C.className="logArea-normal",document.getElementById("logtoolbar").style.display="flex",Array.from(C.children).forEach(t=>{t.style.display="block"}),C.scrollTop=C.scrollHeight):(document.getElementById("logtoolbar").style.display="none",C.className="logArea-single",Array.from(C.children).forEach(t=>{t.style.display="none"}),C.children.length>0&&(C.children[C.children.length-1].style.display="block"))}function hr(){nn(!window.config.showDetailLog)}function Er(){nn(!1)}var vr;function br(){C=document.getElementById("logArea"),vr=document.getElementById("logtoolbar"),document.getElementById("btnCopyLog").addEventListener("click",yr),document.addEventListener("wfChangeLogSimpleEvent",Er)}on.exports={clearLog:wr,initPanel:br,log:fr,warn:mr,error:pr,progress:gr}});var se=D((rl,sn)=>{"use strict";var N=B("photoshop"),{storage:el}=B("uxp"),tl=B("photoshop").imaging,nl=X(),ol=U(),rn=ie();async function _r(e,t){let o=await(await rn.getTemporaryFolder()).createFile(t,{overwrite:!0}),r=new Uint8Array(e);return await o.write(r),o}async function xr(e,t,n){e&&await N.core.executeAsModal(async o=>{e.layers.forEach(async r=>{r.name===t&&!an(r,n)&&r.delete()})})}async function Ir(e){e&&await N.core.executeAsModal(async t=>{e.layers.forEach(async n=>{n.delete()})})}function an(e,t){return e&&t&&e._id===t._id&&e._docId===t._docId}async function Tr(e){await _t({_obj:"select",_target:[{_ref:"document",_id:e}]})}function Cr(e){if(e===-1)return N.app.activeDocument;for(let t of N.app.documents)if(t.id===e)return t}async function Mr(){try{let e=await N.action.batchPlay([{_obj:"get",_target:[{_property:"selection"},{_ref:"document",_enum:"ordinal",_value:"targetEnum"}]}],{});return e[0].selection&&e[0].selection.bottom?!0:null}catch(e){return console.error(e),null}}function Ar(e){if(Array.isArray(e),e.length,e.length>0&&e[0]&&e[0]._obj==="error")throw new Error(`\u6267\u884C\u51FA\u9519: ${e[0].message||"\u672A\u77E5\u9519\u8BEF"}`)}async function _t(e,t){if(Array.isArray(e)||(e=[e]),!e||e.length===0)throw new Error("\u672A\u63D0\u4F9B\u4EFB\u4F55\u547D\u4EE4");let n=await N.core.executeAsModal(async o=>{let r,a;try{return r=await N.action.batchPlay(e,{synchronousExecution:!0,modalBehavior:"execute"}),Ar(r),r}catch(i){throw console.error(i),r&&console.log(JSON.stringify(r,null,2)),console.log(JSON.stringify(e,null,2)),new Error("\u6267\u884C\u52A8\u4F5C\u51FA\u9519")}finally{}})}async function Sr(e="AI\u56FE\u7247",t=512,n=512){let o=await N.core.executeAsModal(async r=>await N.app.documents.add({name:e,width:t,height:n,resolution:72,fill:"black"}));if(!o)throw new Error("\u521B\u5EFA\u65B0\u56FE\u7247\u5931\u8D25");return o}function Lr(){let e=[],t=N.app.documents;return t&&t.length>0&&t.forEach(n=>{e.push({id:n.id,name:n.name})}),e}function Pr(e){let t=e.width,n=e.height;return{width:t,height:n}}function Dr(){return N.app.documents.length>0}function Or(e){for(let t of N.app.documents)if(t.id===e)return!0}function kr(e){for(let t of N.app.documents)if(t.name===e)return t.id;return null}function Br(e){let t=e.bounds,n=t.left,o=t.top,r=t.right,a=t.bottom,i=r-n,s=a-o,l=(r+n)/2,c=(a+o)/2;return{left:n,top:o,right:r,bottom:a,width:i,height:s,centerX:l,centerY:c}}async function Ur(e){let n={_obj:"open",dontRecord:!0,forceNotify:!0,null:{_kind:"local",_path:await rn.createSessionToken(e)},template:!1};return await _t(n),N.app.activeDocument.id}function $r(e){N.action.addNotificationListener(["historyStateChanged"],e)}function Nr(e){N.action.removeNotificationListener(["historyStateChanged"],e)}sn.exports={getDocuments:Lr,createDocument:Sr,getDocumentSize:Pr,activateDocument:Tr,hasDocument:Dr,existsDocument:Or,findDocument:kr,hasSelection:Mr,getDocumentByID:Cr,deleteAllLayers:Ir,deleteLayerByName:xr,saveTempFile:_r,executeCommand:_t,layerEqual:an,getLayerBounds:Br,addNotificationListenerForHistory:$r,removeNotificationListenerForHistory:Nr,openImageFile:Ur}});var Le=D((al,dn)=>{"use strict";async function qr(e,t){try{let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`\u8BBF\u95EECOMFYUI\u51FA\u9519 ${e}  ${n.status} ${n.statusText}`);let o=await n.json();if("comfy_error"in o)throw new Error(`serverlog=${o.comfy_error}`);return o}catch(n){throw n.message&&n.message==="Network request failed"?new Error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u65E0\u6CD5\u8FDE\u63A5\u5230COMFYUI"):n}}async function Fr(e,t){try{let n=e;if(t){let a=new URLSearchParams(t).toString();n=`${e}${e.includes("?")?"&":"?"}${a}`}let o=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`\u8BBF\u95EECOMFYUI\u51FA\u9519 ${n}  ${o.status} ${o.statusText}`);let r=await o.json();if("comfy_error"in r)throw new Error(`serverlog=${r.comfy_error}`);return r}catch(n){throw n.message&&n.message==="Network request failed"?new Error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u65E0\u6CD5\u8FDE\u63A5\u5230COMFYUI"):n}}function Rr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}function jr(e){return new Promise(t=>setTimeout(t,e))}async function zr(e){try{let t=await fetch(e);if(!t.ok)throw new Error(`\u8BBF\u95EECOMFYUI\u51FA\u9519 ${e}  ${t.status} ${t.statusText}`);let n=t.headers.get("Content-Type");if(n&&n.includes("application/json")){let i=await t.json();throw new Error(`serverlog=${i.comfy_error}`)}let o=await t.arrayBuffer();if(o.byteLength<=0)throw new Error("arrayBuffer\u4E3A\u7A7A");let r=t.headers.get("X-Image-Width"),a=t.headers.get("X-Image-Height");return{arrayBuffer:o,width:r,height:a}}catch(t){throw t.message&&t.message==="Network request failed"?new Error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u65E0\u6CD5\u8FDE\u63A5\u5230COMFYUI"):t}}function cn(e,t="userSettings"){wx.setStorage({key:t,data:e,success(n){},fail(n){console.error("\u672C\u5730\u6570\u636E\u4FDD\u5B58\u5931\u8D25",n)}})}function Hr(e="userSettings"){try{return wx.getStorageSync(e)}catch(t){console.error("\u52A0\u8F7D\u672C\u5730\u6570\u636E\u5931\u8D25",t)}}function Wr(e,t="userSettings"){let n=wx.getStorageSync(t);(n==null||n==="")&&(n=[]),n.length>=10&&n.shift(),n.push(e),cn(n,t)}function Gr(e){return e==null||e.trim()===""}function Kr(e,t){return Math.floor(Math.random()*(t-e+1))+e}var un=e=>{let t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),r=e.getHours(),a=e.getMinutes(),i=e.getSeconds();return`${[t,n,o].map(ln).join("/")} ${[r,a,i].map(ln).join(":")}`},ln=e=>(e=e.toString(),e[1]?e:`0${e}`),Vr=()=>{let e=getCurrentPages();return e[e.length-1].route},Xr=()=>un(new Date);function Yr(e){try{let t=e.lastIndexOf(".");if(t===-1)return[e,""];let n=e.substring(0,t),o=e.substring(t).toLowerCase();return[n,o]}catch(t){throw console.error("\u63D0\u53D6\u6587\u4EF6\u540D\u548C\u6269\u5C55\u540D\u5931\u8D25:",t),t}}function Zr(){let e=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),t=Math.round(new Date().getMilliseconds()/100);return`${e}`}dn.exports={post:qr,get:Fr,generateUUID:Rr,downloadImage:zr,randInt:Kr,getLocal:Hr,setLocal:cn,appendLocal:Wr,formatTime:un,now:Xr,getCurrPageRoute:Vr,isEmpty:Gr,sleep:jr,extractFileNameAndExtension:Yr,getCurrentTime:Zr}});var ee=D((sl,mn)=>{"use strict";var il=se(),M=Le(),le=X(),K=U();async function Jr(e){return await M.get(`${window.config.comfyuiURL}/models/checkpoints`)}async function Qr(e){return await M.get(`${e}/system_stats`)}async function ea(e){try{return[!0,(await M.get(`${e}/jinn_test`)).role]}catch{return[!1,""]}}async function ta(){return await M.get(`${window.config.comfyuiURL}/jinn_get_wf_api_run`)}async function na(e){return await M.get(`${window.config.comfyuiURL}/jinn_get_wf_params/${e}`)}async function oa(e){return await M.get(`${window.config.comfyuiURL}/jinn_get_wf_api/${e}`)}async function ra(){return(await M.get(`${window.config.comfyuiURL}/jinn_get_workflows`)).items}async function aa(){return await M.get(`${window.config.comfyuiURL}/jinn_get_workflows_recover`)}async function ia(e,t){let n=await M.post(`${window.config.comfyuiURL}/jinn_workflows_recover`,{wfname:e,wfid:t})}async function sa(e){let t=await M.post(`${window.config.comfyuiURL}/jinn_save_wf_new_run`,e)}async function la(e){let t=await M.post(`${window.config.comfyuiURL}/jinn_save_wf_edit`,e)}async function ca(e){let t=await M.post(`${window.config.comfyuiURL}/jinn_save_wf_del`,e)}async function ua(e,t){let n=await M.post(`${window.config.comfyuiURL}/jinn_workflows_sort`,{wfname1:e,wfname2:t})}async function da(e,t,n,o,r){let a=await M.post(`${window.config.comfyuiURL}/jinn_save_wf_params_sort`,{wfname:e,nodeid1:t,field1:n,nodeid2:o,field2:r})}async function fa(){let e={},t=await M.post(`${window.config.comfyuiURL}/jinn_interrupt`,e)}async function ma(e){let t={preview:e},n=await M.post(`${window.config.comfyuiURL}/jinn_set_output_preview`,t)}var tt=class extends Error{constructor(t,n){super(t),this.name=this.constructor.name,this.needinfo=n}};async function pa(e){let t=await M.post(`${window.config.comfyuiURL}/jinn_registry_user`,{user_id:e})}async function ga(e,t,n,o,r,a,i,s=null){s!==!1&&le.log("\u6B63\u5728\u8BF7\u6C42COFMYUI.");let l=M.generateUUID(),c={client_id:l,wfname:e,params:t,debug:o},u=await M.post(`${window.config.comfyuiURL}/jinn_prompt_byid`,c);if(u.verify===!1)throw new tt(u.message,u.needinfo);u.verify_message&&(le.error(u.verify_message),alert(u.verify_message));let d=u.prompt_id;if(s!==!1&&le.log("\u6B63\u5728\u8FD0\u884C\u5DE5\u4F5C\u6D41"),await va(l,d,n,i,s),t.output.kind===K.OUTPUTIMAGE)return s!==!1&&le.log("\u6B63\u5728\u4E0B\u8F7D\u56FE\u7247."),ya(d,t.output.nodeid,t.output.field,r,a,s);if(t.output.kind===K.OUTPUTTEXT)return s!==!1&&le.log("\u6B63\u5728\u83B7\u53D6\u6587\u672C."),wa(d,t.output.nodeid,t.output.field,r,a,s);throw new Error(`\u672A\u77E5\u8F93\u51FA\u7C7B\u578B${t.output.kind}`)}async function wa(e,t,n,o,r,a){let i={prompt_id:e,nodeid:t,field:n},s=await M.post(`${window.config.comfyuiURL}/jinn_prompt_result_text_byid`,i);return{kind:K.OUTPUTTEXT,text:s.result}}async function ya(e,t,n,o,r,a){let i={prompt_id:e,nodeid:t,field:n},s=await M.post(`${window.config.comfyuiURL}/jinn_prompt_result_byid`,i),l=[],c=".jpg";for(let u of s){u.docwidth=r.width,u.docheight=r.height,u.zoom=o,c=u.filename.toLowerCase().endsWith(".png")?".png":".jpg";let d=new URLSearchParams(u),f=`${window.config.comfyuiURL}/jinn_view?${d.toString()}`;a!==!1&&le.warn(f);let h=await M.downloadImage(f);l.push(h)}return[l,c]}async function ha(e,t){let n=`${window.config.comfyuiURL}/view?filename=${e}&subfolder=${t}&type=temp`;return await M.downloadImage(n)}async function Ea(e){return(await M.get(`${window.config.comfyuiURL}/jinn_get_queue/${e}`)).queue_index}async function va(e,t,n,o,r){return new Promise((a,i)=>{let s=!1,l=p=>{try{h.close()}catch{}i(new Error(p))},c=window.config.comfyuiURL.replace(/^https?:\/\//,""),d=`${window.config.comfyuiURL.toLowerCase().startsWith("http")?"ws":"wss"}://${c}/ws?clientId=${e}`,f=0,h=new WebSocket(d);h.onerror=function(p){l("WebSocket\u51FA\u9519")},h.onclose=function(p){p.wasClean||l("WebSocket\u610F\u5916\u5173\u95ED: "+p.reason)},h.onmessage=async function(p){let y=p.data;if(typeof y=="string"){let w=JSON.parse(y);switch(w.type){case"executing":if(w.data&&w.data.node&&w.data.node in n){let T=n[w.data.node];T&&T._meta&&T._meta.title&&r!==!1&&le.warn(`\u6B63\u5728\u6267\u884C${T._meta.title}(${w.data.node})`)}break;case"executed":try{if(window.config.loadTempImage&&window.config.promptMode===K.PROMPTMODE_COMMON&&w.data&&w.data.output&&w.data.output.images&&w.data.output.images[0].type==="temp"){let T=new CustomEvent("wfLoadTempImageEvent",{detail:{filename:w.data.output.images[0].filename,subfolder:w.data.output.images[0].subfolder}});document.dispatchEvent(T)}}catch{}break;case"execution_error":l("\u7B49\u5F85\u65F6\u51FA\u9519,\u8BF7\u67E5\u770BCOMFYUI\u65E5\u5FD7.");break;case"execution_interrupted":l("\u7528\u6237\u4E2D\u6B62\u751F\u56FE.");break;case"execution_success":s=!0;break;case"status":if(s===!0){h.close(),a(!0);break}if(w.data.status.exec_info.queue_remaining==0){l("\u7531\u4E8E\u79CD\u5B50\u6570\u56FA\u5B9A\u7B49\u7CFB\u7EDF\u7F13\u5B58\u539F\u56E0\uFF0C\u5DE5\u4F5C\u6D41\u672A\u88AB\u6267\u884C.");break}let g=await Ea(t);if(g<0){l(`${t}\u4E0D\u5728\u961F\u5217\u4E2D`);break}else g>0&&le.log(`\u5F53\u524D\u6392\u961F\u7B2C${g+1}\u4F4D`);break;case"progress":let{value:m,max:b,node:I}=w.data,L=n[I]._meta?n[I]._meta.title:n[I].class_type;b>1&&r!==!1&&le.progress(L,I,b,m);break;default:}}}})}async function ba(e,t,n="psupload"){let o=new FormData;o.append("image",e,t),o.append("subfolder",n),o.append("filename",t);let r=await fetch(`${window.config.comfyuiURL}/jinn_upload_image_live`,{method:"POST",body:o});if(r.ok){let a=await r.json();return{path:`${a.subfolder}/${a.name}`,filename:a.name,subfolder:a.subfolder}}else throw new Error(`\u4E0A\u4F20\u56FE\u7247\u5931\u8D25  ${t},${r.status},${r.statusText}`)}async function _a(e,t,n){let o="psupload",r=new FormData;r.append("image",e,t),r.append("subfolder",o),r.append("filename",t),r.append("minsize",window.config.pszoomMinsize),r.append("maxsize",window.config.pszoomMaxsize),n&&r.append("bounds",`${n.left},${n.top},${n.right},${n.bottom}`);let a=await fetch(`${window.config.comfyuiURL}/jinn_upload_image`,{method:"POST",body:r});if(a.ok){let i=await a.json();return{path:`${i.subfolder}/${i.name}`,filename:i.name,subfolder:i.subfolder}}else throw new Error(`\u4E0A\u4F20\u56FE\u7247\u5931\u8D25  ${t},${a.status},${a.statusText}`)}async function xa(e,t){let n="psupload",o=new FormData;o.append("image",e,t),o.append("subfolder",n),o.append("filename",t);let r=await fetch(`${window.config.comfyuiURL}/jinn_upload_image`,{method:"POST",body:o});if(r.ok){let a=await r.json();return{path:`${a.subfolder}/${a.name}`,filename:a.name,subfolder:a.subfolder}}else throw new Error(`\u4E0A\u4F20\u56FE\u7247\u5931\u8D25  ${t},${r.status},${r.statusText}`)}async function Ia(e,t,n,o){let r="psupload",a=new FormData;a.append("image",e,t),a.append("maskfilename",t),a.append("maskfolder",r),a.append("imagefilename",n.filename),a.append("imagefolder",n.subfolder),a.append("minsize",window.config.pszoomMinsize),a.append("maxsize",window.config.pszoomMaxsize),o&&a.append("bounds",`${o.left},${o.top},${o.right},${o.bottom}`);let i=await fetch(`${window.config.comfyuiURL}/jinn_upload_mask`,{method:"POST",body:a});if(i.ok){let s=await i.json();return`${s.subfolder}/${s.name}`}else throw new Error(`\u4E0A\u4F20\u56FE\u7247\u5931\u8D25  ${t},${i.status},${i.statusText}`)}async function Ta(e){let t={text:e,appid:window.config.transBaiduAppID,appkey:window.config.transBaiduAppKey,from_lang:"zh",to_lang:"en"};return(await M.post(`${window.config.comfyuiURL}/jinn_translate`,t)).result}async function Ca(e){let t={text:e,appid:window.config.transBaiduAppID,appkey:window.config.transBaiduAppKey,from_lang:"en",to_lang:"zh"};return(await M.post(`${window.config.comfyuiURL}/jinn_translate`,t)).result}async function Ma(e,t){let n=await fn(e,t);try{return n[0]}catch{return[]}}async function fn(e,t){return await M.get(`${window.config.comfyuiURL}/jinn_get_wf_nodefield_info/${e}/${t}`)}var Aa=new Map;async function Sa(e,t){let n=`${e},${t}`;try{let o=await fn(e,t),r=o[0],a=o.length>1?o[1]:{},i;if(t.toLowerCase()==="seed"?i=K.SEED:t.toLowerCase()==="image"||a.hasOwnProperty("image_upload")&&a.image_upload===!0||r==="IMAGE"?i=K.INPUTIMAGE:Array.isArray(r)?i=K.FIELDENUM:r==="INT"?a.hasOwnProperty("min")&&a.hasOwnProperty("max")&&t.toLowerCase()==="steps"?(a={min:1,max:20,step:1},i=K.SLIDER):i=K.TEXTFIELD:r==="FLOAT"?a.hasOwnProperty("min")&&a.hasOwnProperty("max")&&a.hasOwnProperty("step")&&(i=K.SLIDER):r==="STRING"&&a.hasOwnProperty("multiline")&&a.multiline===!0&&(i=K.PROMPTTEXT),i)return Aa.set(n,i),[i,a]}catch(o){console.error("Error guessing field kind:",o)}return[null,null]}mn.exports={VerifyError:tt,registry_user:pa,loadTempImage:ha,prompt:ga,uploadImage:_a,uploadImageBatch:xa,uploadMask:Ia,load_checkpoints:Jr,get_wf_params:na,get_workflows:ra,test_comfyui:Qr,test_comfyui_jinn:ea,get_wf_api:oa,save_wf_new_run:sa,save_wf_edit:la,save_wf_del:ca,get_wf_api_run:ta,get_workflows_recover:aa,workflows_recover:ia,workflows_sort:ua,save_wf_params_sort:da,interrupt:fa,setOutputPreview:ma,translateToZH:Ca,translateToEN:Ta,get_wf_nodefield_enum:Ma,guessFieldKind:Sa,uploadImageLive:ba}});var hn=D((ul,yn)=>{"use strict";var nt=B("photoshop"),{storage:ll}=B("uxp"),cl=B("photoshop").imaging,Pe=X(),he=U(),De=ie(),_=se();async function La(e,t){if(window.config.setAILayer===he.SETAILAYERCLOSE)try{let n=_.getDocumentByID(e);if(!n)throw new Error(`\u6CA1\u6709\u627E\u5230\u6307\u5B9A\u7684\u56FE\u7247,docid=${e}`);await nt.core.executeAsModal(async o=>{n.layers.forEach(async r=>{r.name===t&&(r.visible=!1)})})}catch(n){Pe.error(n)}else if(window.config.setAILayer===he.SETAILAYERDEL)try{let n=_.getDocumentByID(e);if(!n)throw new Error(`\u6CA1\u6709\u627E\u5230\u6307\u5B9A\u7684\u56FE\u7247,docid=${e}`);Pe.log(`\u5220\u9664\u6240\u6709"${t}"\u56FE\u5C42`),await _.deleteLayerByName(n,t,null)}catch(n){Pe.error(n)}}async function Pa(e,t){let o=await(await De.getTemporaryFolder()).createFile(t,{overwrite:!0});Pe.warn(o.nativePath);let r={compression:6,interlaced:!1,embedColorProfile:!0};if(await e.saveAs.png(o,{compression:6}),De.readArrayBuffer(o).byteLength<=0)throw new Error("arrayBuffer\u4E3A\u7A7A");return o}async function Da(e,t,n){let o=_.getDocumentByID(e);if(!o)throw new Error(`\u6CA1\u6709\u627E\u5230\u6307\u5B9A\u7684\u56FE\u7247,docid=${e}`);return await nt.core.executeAsModal(async r=>{try{return await Pa(o,t)}catch(a){throw Pe.error(a),new Error("\u5904\u7406PS\u56FE\u50CF\u65F6\u51FA\u9519")}})}function pn(e,t){let n=e.channels,o=n.length;for(let r=0;r<o;r++)try{let a=n[r];if(a&&a.name===t)return!0}catch{continue}return!1}async function gn(e){pn(e,he.TEMP_CHANNEL_NAME)&&await _.executeCommand([{_obj:"select",_target:[{_name:he.TEMP_CHANNEL_NAME,_ref:"channel"}]},{_obj:"delete",_target:[{_enum:"ordinal",_ref:"channel",_value:"targetEnum"}]}]),await _.executeCommand([{_obj:"duplicate",_target:[{_property:"selection",_ref:"channel"}],name:he.TEMP_CHANNEL_NAME},{_obj:"set",_target:[{_property:"selection",_ref:"channel"}],to:{_enum:"ordinal",_value:"none"}}])}async function wn(e){if(pn(e,"JinnSelectionChannel")){let t=[{_obj:"select",_target:[{_name:he.TEMP_CHANNEL_NAME,_ref:"channel"}]},{_obj:"set",_target:[{_property:"selection",_ref:"channel"}],to:{_enum:"ordinal",_ref:"channel",_value:"targetEnum"}},{_obj:"delete",_target:[{_enum:"ordinal",_ref:"channel",_value:"targetEnum"}]}];await _.executeCommand(t)}}function Oa(e,t,n,o,r){let a=_.getDocumentSize(e),i=a.width,s=a.height,l=_.getLayerBounds(t),c=100;if(!(n>=i||o>=s))if(r.lesszoom===he.OUTPUT_LESSZOOM){if(!(l.width===i||l.height===s)){let u=l.width/l.height,d=i/s;u>d?c=100*s/l.height:c=100*i/l.width}}else n===l.width||o===l.height||(c=100*n/l.width);return[c,i/2-l.centerX,s/2-l.centerY]}async function ka(e,t,n,o,r,a){o=parseInt(o),r=parseInt(r),await _.activateDocument(e);let i=_.getDocumentByID(e),s=await _.hasSelection(e);s&&await gn(i);let l=_.getDocumentSize(i),c=l.width,u=l.height;if((o>c||r>u)&&a.morezoom===he.OUTPUT_MOREREAL){let b={_obj:"canvasSize",canvasExtensionColorType:{_enum:"canvasExtensionColorType",_value:"backgroundColor"},width:{_unit:"pixelsUnit",_value:o},height:{_unit:"pixelsUnit",_value:r},horizontal:{_enum:"horizontalLocation",_value:"center"},vertical:{_enum:"verticalLocation",_value:"center"}};await _.executeCommand(b)}let d=i.activeLayers[0],h={_obj:"placeEvent",null:{_path:await De.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:0},vertical:{_unit:"pixelsUnit",_value:0}}},p={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await _.executeCommand([h,p]);let y=i.activeLayers[0];if(_.layerEqual(d,y))throw new Error("\u521B\u5EFA\u65B0\u56FE\u5C42\u5931\u8D25");let[w,g,m]=Oa(i,y,o,r,a);if(w!==100||g!==0||m!==0){let b={_obj:"transform",_target:[{_ref:"layer",_enum:"ordinal",_value:"targetEnum"}],freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSCanvas"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:g},vertical:{_unit:"pixelsUnit",_value:m}},width:{_unit:"percentUnit",_value:w},height:{_unit:"percentUnit",_value:w},linked:!0};await _.executeCommand(b)}return s&&await wn(i),y}async function Ba(e,t){await _.activateDocument(e);let n=_.getDocumentByID(e),r={_obj:"placeEvent",null:{_path:await De.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"}};await _.executeCommand(r)}function Ua(e,t,n,o,r){let a=_.getLayerBounds(t);return[100*(r.right-r.left)/a.width,r.centerX-a.centerX,r.centerY-a.centerY]}async function $a(e,t,n,o,r,a){await _.activateDocument(e);let i=_.getDocumentByID(e),s=await _.hasSelection(e);s&&await gn(i);let l=i.activeLayers[0],u={_obj:"placeEvent",null:{_path:await De.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:0},vertical:{_unit:"pixelsUnit",_value:0}}},d={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await _.executeCommand([u,d]);let f=i.activeLayers[0];if(_.layerEqual(l,f))throw new Error("\u521B\u5EFA\u65B0\u56FE\u5C42\u5931\u8D25");let[h,p,y]=Ua(i,f,parseInt(o),parseInt(r),a);if(h>0){let w={_obj:"transform",_target:[{_ref:"layer",_enum:"ordinal",_value:"targetEnum"}],freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSCanvas"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:p},vertical:{_unit:"pixelsUnit",_value:y}},width:{_unit:"percentUnit",_value:h},height:{_unit:"percentUnit",_value:h}};await _.executeCommand(w)}return s&&await wn(i),f}async function Na(e,t){let n=e.selection,o=await e.createLayer({name:"AIMask",opacity:100,mode:"normal"}),r={_obj:"fill",using:{_enum:"fillContents",_value:"white"},opacity:{_unit:"percentUnit",_value:100},mode:{_enum:"blendMode",_value:"normal"}},a={_obj:"inverse"},i={_obj:"fill",using:{_enum:"fillContents",_value:"black"},opacity:{_unit:"percentUnit",_value:100},mode:{_enum:"blendMode",_value:"normal"}},l=await(await De.getTemporaryFolder()).createFile(t,{overwrite:!0});return await _.executeCommand([r,a,i]),await e.saveAs.jpg(l,{quality:12}),await o.delete(),await _.executeCommand({_obj:"inverse"}),l}async function qa(e,t){let n=_.getDocumentByID(e);if(await _.activateDocument(n.id),!await _.hasSelection())throw new Error("\u6CA1\u6709\u627E\u5230\u6709\u6548\u9009\u533A\uFF01");if(!n)throw new Error(`\u6CA1\u6709\u627E\u5230\u6307\u5B9A\u7684\u56FE\u7247,docid=${e}`);return await nt.core.executeAsModal(async o=>{try{return await Na(n,t)}catch(r){throw Pe.error(r),new Error("\u83B7\u53D6\u9009\u533A\u65F6\u51FA\u9519")}})}async function Fa(e){try{let t=_.getDocumentByID(e);await _.activateDocument(t.id);let n=await nt.action.batchPlay([{_obj:"get",_target:[{_property:"selection"},{_ref:"document",_enum:"ordinal",_value:"targetEnum"}]}],{});if(!(n[0].selection&&n[0].selection.bottom))return null;let o=_.getDocumentSize(t),r=o.width,a=o.height,i={left:n[0].selection.left._value,top:n[0].selection.top._value,right:n[0].selection.right._value,bottom:n[0].selection.bottom._value},s=i.right-i.left,l=i.bottom-i.top,c=.08,u=Math.max(0,i.left-s*c),d=Math.max(0,i.top-l*c),f=Math.min(r,i.right+s*c),h=Math.min(a,i.bottom+l*c),p=f-u,y=h-d;p-=p%8,y-=y%8,f=u+p,h=d+y;let w={left:Math.round(u),top:Math.round(d),right:Math.round(f),bottom:Math.round(h)};return w.centerX=(w.right+w.left)/2,w.centerY=(w.bottom+w.top)/2,w}catch(t){return console.error(t),null}}yn.exports={addLayerImage:ka,addLayerImageRegion:$a,preparePSImage:La,createPSImage:Da,createSelectionMask:qa,getSelectionSmartBounds:Fa,addLayerImageTemp:Ba}});var at=D((dl,Tn)=>{"use strict";var Ra=Le(),te=ee(),ke=se(),ue=hn(),O=X(),{app:ot}=B("photoshop"),ce=U(),ja=document.getElementById("wfButtonContainer"),za=document.getElementById("btnPrompt"),Ha=document.getElementById("logContainer"),En=document.getElementById("btnSettings"),vn=document.getElementById("btnInterrupt"),Wa=document.getElementById("wfParamContainer"),Ga=document.getElementById("wfPreviewImage"),xt=document.getElementById("lSimpleLog"),Ka=document.getElementById("wfMainToolbar");function Tt(e){Array.from(ja.children).forEach(t=>{t.disabled=e}),Ka.querySelectorAll("*").forEach(t=>{t.disabled=e}),za.disabled=e,En.disabled=e,En.style.display=e?"none":"flex",vn.disabled=!e,vn.style.display=e?"flex":"none",Wa.querySelectorAll("*").forEach(t=>{t.hasAttribute("data-keep-enabled")||(t.disabled=e)}),xt.textContent="",e?xt.style.display=window.config.promptMode===ce.PROMPTMODE_BATCH?"block":"none":xt.style.display="none"}function bn(){Ct=!1,window.showSingle(Ha),O.clearLog(),console.clear(),Tt(!0)}function je(){Ct=!1,Tt(!1)}async function rt(e,t,n){O.warn("\u6B63\u5728\u8BFB\u53D6PS\u56FE\u50CF");let o=n===0?"psimage.png":`psimage${n}.png`,r=await ue.createPSImage(t.docid,o,e),a=await te.uploadImage(r,o);return O.warn(a.path),t.value=a.path,a}async function _n(e,t,n){O.warn("\u6B63\u5728\u8BFB\u53D6PS\u9009\u533A");let o=t===0?"psmask.jpg":`psmask${t}.jpg`,r=t===0?"psmask.png":`psmask${t}.png`,a=await ue.createSelectionMask(e.docid,o),i=await te.uploadMask(a,r,n);return O.warn(i),e.value=i,i}async function xn(e,t,n){O.warn("\u6B63\u5728\u8BFB\u53D6PS\u9009\u533A\u4F5C\u4E3A\u56FE\u50CF\u53CA\u8499\u677F");let o=n===0?"psareaimg.png":`psareaimg${n}.png`,r=await ue.getSelectionSmartBounds(t.docid);if(!r)throw new Error("\u6CA1\u6709\u627E\u5230\u9009\u533A");let a=await ue.createPSImage(t.docid,o,e),i=await te.uploadImage(a,o,r);O.warn(i.path);let s=n===0?"psareamask.jpg":`psareamask${n}.jpg`,l=n===0?"psareamask.png":`psareamask${n}.png`,c=await ue.createSelectionMask(t.docid,s),u=await te.uploadMask(c,l,i,r);return O.warn(u),t.value=u,r}function In(e){let t=new Image;t.src=e,Ga.src=t.src}async function Va(e,t,n,o){bn();let r=null;try{if(!ot.activeDocument){O.error("\u8BF7\u5148\u6253\u5F00\u4E00\u5F20\u56FE\u7247\uFF01"),je();return}let a=t.params.filter(i=>i.kind===ce.INPUTIMAGEMASK);for(let i=0;i<a.length;i++){let s=a[i];s.docid=-1;let l=await rt(e,s,i+1);await _n(s,i,l)}a=t.params.filter(i=>i.kind===ce.INPUTIMAGE);for(let i=0;i<a.length;i++){let s=a[i];s.docid=-1,await rt(e,s,i)}a=t.params.filter(i=>i.kind===ce.INPUTREGIONMASK);for(let i=0;i<a.length;i++){let s=a[i];s.docid=-1,r=await xn(e,s,i)}}catch(a){O.error(a),je();return}try{let a=await te.prompt(e,t,n,window.config.showDetailLog,{width:100,height:100},In);O.log(a.text),o&&o(a.text)}catch(a){O.error(a),a instanceof te.VerifyError&&document.dispatchEvent(new CustomEvent("verifyUserEvent",{detail:{error:a}}))}finally{je()}}async function Xa(e,t,n){bn();let o=null,r=null,a=performance.now();try{ot.activeDocument||await ke.createDocument(),r=t.output.docid===-1?ot.activeDocument.id:t.output.docid,await ue.preparePSImage(r,e);let i=t.params.filter(s=>s.kind===ce.INPUTIMAGEMASK);for(let s=0;s<i.length;s++){let l=i[s],c=await rt(e,l,s+1);await _n(l,s,c)}i=t.params.filter(s=>s.kind===ce.INPUTIMAGE);for(let s=0;s<i.length;s++){let l=i[s];await rt(e,l,s)}i=t.params.filter(s=>s.kind===ce.INPUTREGIONMASK);for(let s=0;s<i.length;s++){let l=i[s];o=await xn(e,l,s)}}catch(i){O.error(i),je();return}try{let i=t.output.lesszoom==ce.OUTPUT_LESSREAL||t.output.morezoom==ce.OUTPUT_MOREREAL,[s,l]=await te.prompt(e,t,n,window.config.showDetailLog,i,{width:100,height:100},In);O.log("\u6B63\u5728\u5B58\u50A8AI\u56FE\u50CF\u6587\u4EF6");let c=[];for(let p=0;p<s.length;p++){let{arrayBuffer:y,width:w,height:g}=s[p],m=await ke.saveTempFile(y,p===0?`cfimage${l}`:`cfimage${p+1}${l}`);O.warn(m.nativePath,`${w}*${g}`),c.push([m,w,g])}if(O.log("\u6B63\u5728\u6DFB\u52A0\u5230\u56FE\u5C42"),o)for(let[p,y,w]of c)await ue.addLayerImageRegion(r,p,e,y,w,o);else for(let[p,y,w]of c)await ue.addLayerImage(r,p,e,y,w,t.output);let[u,d,f]=c[0],h=((performance.now()-a)/1e3).toFixed(1);O.log(`\u751F\u56FE\u6210\u529F  ${d}*${f} ${h}\u79D2`)}catch(i){O.error(i),i instanceof te.VerifyError&&document.dispatchEvent(new CustomEvent("verifyUserEvent",{detail:{error:i}}))}finally{je()}}var Ct=!1;async function Ya(){try{Ct=!0,await te.interrupt(),O.error("\u5C1D\u8BD5\u4E2D\u6B62\u751F\u56FE...")}catch(e){O.error(e)}}var Oe,It=!1;async function Za(){It=!0;try{(!Oe||!ke.existsDocument(Oe))&&(Oe=ke.findDocument("CF-TEMP"),Oe||(await ke.createDocument("CF-TEMP",1024,1024),Oe=ot.activeDocument.id))}catch{}finally{It=!1}}async function Ja(e){let{filename:t,subfolder:n}=e,{arrayBuffer:o,width:r,height:a}=await te.loadTempImage(t,n),i=await ke.saveTempFile(o,"cftemp.png");It&&await Ra.sleep(300),await Za(),await ue.addLayerImageTemp(Oe,i)}Tn.exports={prompt:Xa,promptOutputText:Va,interruptPrompt:Ya,DisabledUI:Tt,loadTempImage:Ja}});var Sn=D((wl,An)=>{"use strict";var Cn=B("photoshop"),{storage:fl}=B("uxp"),ml=B("photoshop").imaging,Mt=X(),pl=U(),Mn=ie(),Ie=se();async function Qa(e,t){try{await Ie.deleteLayerByName(e,t,null)}catch(n){Mt.error(n)}}async function ei(e,t,n){return await Cn.core.executeAsModal(async o=>{try{let a=await(await Mn.getTemporaryFolder()).createFile(t,{overwrite:!0});return n&&Mt.warn(a.nativePath),await e.saveAs.jpg(a,{quality:6}),a}catch(r){throw Mt.error(r),new Error("\u5904\u7406PS\u56FE\u50CF\u65F6\u51FA\u9519")}})}function ti(e,t,n,o){let r=Ie.getDocumentSize(e),a=r.width,i=r.height,s=Ie.getLayerBounds(t),l=s.width>=s.height?n*100/s.width:o*100/s.height,c,u;return c=a*3/4,u=i/2,[l,c-s.centerX,u-s.centerY]}var{ElementPlacement:gl}=Cn.constants;async function ni(e,t,n,o,r){let a=e.activeLayers,i=a.length>0?a[0]:null,l={_obj:"placeEvent",null:{_path:await Mn.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:0},vertical:{_unit:"pixelsUnit",_value:0}}},c={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await Ie.executeCommand([l,c],e.id);let u=e.activeLayers[0];await Ie.deleteLayerByName(e,n,u);let[d,f,h]=ti(e,u,o,r);if(d>0){let p={_obj:"transform",_target:[{_ref:"layer",_enum:"ordinal",_value:"targetEnum"}],freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSCanvas"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:f},vertical:{_unit:"pixelsUnit",_value:h}},width:{_unit:"percentUnit",_value:d},height:{_unit:"percentUnit",_value:d}};await Ie.executeCommand(p,e.id)}try{if(i)try{let p={_obj:"select",_target:[{_ref:"layer",_id:i.id}],makeVisible:!1};await Ie.executeCommand(p,e.id)}catch{}}catch{}return u}An.exports={preparePSImageLive:Qa,createPSImageLive:ei,addLayerImageLive:ni}});var Un=D((yl,Bn)=>{"use strict";var He=ee(),oi=Le(),At=se(),Ln=Sn(),H=X(),{app:Pn}=B("photoshop"),ze=U(),ri=at(),Dn=document.getElementById("btnInterrupt"),ai=document.getElementById("wfButtonContainer"),ii=document.getElementById("btnPrompt"),si=document.getElementById("logContainer"),On=document.getElementById("btnSettings"),it=document.getElementById("lSimpleLog");function li(){Te=!1,window.showSingle(si),H.clearLog(),console.clear();let e=!0;Array.from(ai.children).forEach(t=>{t.disabled=e}),ii.disabled=e,On.disabled=e,On.style.display=e?"none":"flex",Dn.disabled=!e,Dn.style.display=e?"flex":"none",it.style.display="block",it.textContent=""}function kn(){Te=!1,ri.DisabledUI(!1)}var St=class{constructor(t,n,o){this.wfname=t,this.params=n,this.apidata=o;let r=n.params.filter(i=>i.kind===ze.INPUTIMAGE);if(r.length!==1)throw new Error('\u6709\u4E14\u53EA\u80FD\u6709\u4E00\u4E2A"\u83B7\u53D6\u56FE\u7247"\u6761\u4EF6');this.param=r[0];let a=String(Math.round(new Date().getMilliseconds()));if(this.filename=`pslive${a}.jpg`,!Pn.activeDocument)throw new Error("\u8BF7\u5148\u6253\u5F00\u4E00\u5F20\u56FE\u7247\uFF01");this.doc=Pn.activeDocument,this.docid=this.doc.id,this.outputWidth=-1,this.outputHeight=-1,this.firstLivePrompt=!0,this.docLastChangedTime=0,this.liveRunning=!1,this.sensitivity=window.config.livePromptSensitivity*1e3,this.inactivityTimer=null,At.addNotificationListenerForHistory(this.linstener),this.promptLiveOne()}linstener=async(t,n)=>{if(n.documentID===this.docid&&!this.liveRunning){if(!ze.LIVE_ACTIVE_PS_TOOLS.includes(n.name))return;clearTimeout(this.inactivityTimer),this.sensitivity===0?this.promptLiveOne():this.inactivityTimer=setTimeout(()=>{this.promptLiveOne()},this.sensitivity)}};promptLiveOne=async()=>{try{if(this.liveRunning=!0,Te)throw Te=!1,new Error("\u7528\u6237\u4E2D\u6B62\u751F\u56FE");H.log("\u5F00\u59CB\u751F\u56FE"),it.textContent="\u{1F7E2}",this.firstLivePrompt&&H.log("\u6B63\u5728\u8BFB\u53D6PS\u56FE\u50CF");let t=await Ln.createPSImageLive(this.doc,this.filename,this.firstLivePrompt),n=await He.uploadImageLive(t,this.filename);this.firstLivePrompt&&H.warn(n.path),this.param.value=n.path;let o=this.outputWidth===-1?ze.OUTPUT_ZOOM:ze.OUTPUT_NOZOOM,[r,a]=await He.prompt(this.wfname,this.params,this.apidata,window.config.showDetailLog,o,{width:100,height:100},null,this.firstLivePrompt),{arrayBuffer:i,width:s,height:l}=r[0];this.outputWidth===-1&&(this.outputWidth=s,this.outputHeight=l),this.firstLivePrompt&&H.log("\u6B63\u5728\u5B58\u50A8AI\u56FE\u50CF\u6587\u4EF6");let c=await At.saveTempFile(i,"cfimage.jpg");this.firstLivePrompt&&H.warn(c.nativePath,`${s}*${l}`),this.firstLivePrompt&&H.log("\u6B63\u5728\u6DFB\u52A0\u5230\u56FE\u5C42");let u=await Ln.addLayerImageLive(this.doc,c,this.wfname,this.outputWidth,this.outputHeight);if(this.firstLivePrompt=!1,H.log(`${oi.getCurrentTime()}\u751F\u56FE\u6210\u529F`),Te)throw Te=!1,new Error("\u7528\u6237\u4E2D\u6B62\u751F\u56FE")}catch(t){H.error(t),this.stopLive(),t instanceof He.VerifyError&&document.dispatchEvent(new CustomEvent("verifyUserEvent",{detail:{error:t}}))}finally{it.textContent="",this.liveRunning=!1}};stopLive=async()=>{try{At.removeNotificationListenerForHistory(this.linstener)}catch(t){console.error(t)}kn(),J=null};paramChanged=async(t,n,o,r)=>{let a=this.params.params.find(i=>i.nodeid===n&&i.field===o);if(a){if(a.value=r,t===ze.PROMPTTEXT){let i=r;window.config.transEnable&&r&&(i=await He.translateToEN(r)),a.valueen=i}this.liveRunning||this.promptLiveOne()}}},J;async function ci(e,t,n){try{li(),J=new St(e,t,n)}catch(o){H.error(o),J&&J.stopLive(),kn()}}var Te=!1;async function ui(){try{if(J&&!J.liveRunning){J.stopLive(),H.error("\u7528\u6237\u4E2D\u6B62\u751F\u56FE");return}Te=!0,await He.interrupt(),H.error("\u5C1D\u8BD5\u4E2D\u6B62\u751F\u56FE...")}catch(e){H.error(e)}}function di(){try{let e=document.getElementById("wfBatchPromptHelpDialog");if(e){e.showModal();return}e=document.createElement("dialog"),e.id="wfBatchPromptHelpDialog",e.style.cssText="width: 800px;height: 500px;display: flex;flex-direction: column;";let t=document.createElement("div");t.style.cssText="max-width: 100%;max-height: 100%;overflow: auto;margin: 5px;gap: 5px;display: flex;flex-direction: column;";let n=document.createElement("sp-body");n.innerHTML=`\u5B9E\u65F6\u7ED8\u753B\uFF1A<br>
        \u53EA\u9488\u5BF9\u5F53\u524D\u56FE\u7247\u64CD\u4F5C<br>
        \u5FC5\u987B\u6709\u4E00\u4E2A"\u83B7\u53D6\u56FE\u7247"\u6761\u4EF6<br>
        \u5728\u5F53\u524D\u56FE\u7247\u7684\u5DE6\u534A\u533A\u57DF\u6D82\u9E26\u7ED8\u5236\u8349\u56FE\uFF0C\u5728\u5F53\u524D\u56FE\u7247\u7684\u53F3\u534A\u533A\u57DF\u663E\u793A\u751F\u6210\u7684\u56FE\u7247<br>
        \u6BCF\u6B21\u53EA\u751F\u6210\u4E00\u5F20\u56FE\u7247(\u4E0D\u652F\u6301\u591A\u6279\u6B21)<br>
        \u751F\u56FE\u65F6\u4E0D\u8981\u53D8\u66F4\u5F53\u524D\u6587\u4EF6\uFF0C\u4E0D\u8981\u4FEE\u6539\u753B\u5E03\u5C3A\u5BF8<br>
        \u751F\u56FE\u7075\u654F\u5EA6:\u5047\u5982\u503C\u4E3A2,\u5219\u5F53\u505C\u6B62\u7ED8\u753B2\u79D2\u540E,\u5F00\u59CB\u7ED8\u5236\u4E00\u5F20AI\u56FE\u7247<br>
        \u53EA\u9488\u5BF9\u753B\u7B14\u5DE5\u5177\uFF08B\uFF09\uFF0C\u6A61\u76AE\u64E6\u5DE5\u5177\uFF08E\uFF09\u7B49\u5C11\u6570\u51E0\u79CD\u5DE5\u5177\u5B9E\u65F6\u751F\u56FE<br>
        \u5982\u679C\u4FEE\u6539\u753B\u5E03\u5185\u5BB9\u540E\u672A\u751F\u56FE\uFF0C\u53EF\u4EE5\u7528\u753B\u7B14\u5DE5\u5177\u968F\u610F\u753B\u4E00\u7B14<br>


        `,t.appendChild(n),e.appendChild(t),document.body.appendChild(e),e.showModal()}catch(e){H.error(e)}}function fi(e){try{let t=e.currentTarget.value;window.config.livePromptSensitivity=t,window.saveConfig(),J&&(J.sensitivity=parseInt(t*1e3))}catch(t){console.error(t)}}function mi(e){try{if(J){let t=e.currentTarget.value,n=e.currentTarget.getAttribute("data-kind"),o=e.currentTarget.getAttribute("data-nodeid"),r=e.currentTarget.getAttribute("data-field");J.paramChanged(n,o,r,t)}}catch(t){console.error(t)}}Bn.exports={interruptPrompt:ui,promptLive:ci,showHelp:di,sensitivityChanged:fi,paramChanged:mi}});var qn=D((bl,Nn)=>{"use strict";var Be=B("photoshop"),{storage:hl}=B("uxp"),El=B("photoshop").imaging,$n=X(),vl=U(),pi=ie(),Q=se();function gi(e){switch(e){case 1:return[1024,512];case 2:return[1536,512];case 3:return[1024,1024]}}function wi(e,t,n,o){let r=Q.getDocumentSize(e),a=r.width,i=r.height,s=Q.getLayerBounds(t),l=s.width>=s.height?512*100/s.width:512*100/s.height,c,u;switch(n){case 1:c=256+512*o,u=256;break;case 2:c=256+512*o,u=256;break;case 3:let d=Math.floor(o/2),f=o%2;c=256+512*d,u=256+512*f;break}return[l,c-s.centerX,u-s.centerY]}async function yi(e,t){try{await Be.core.executeAsModal(async n=>{e.layers.forEach(async o=>{o.name!=="\u80CC\u666F"&&o.delete()})})}catch(n){$n.error(n)}}async function hi(e,t,n,o,r){await Q.activateDocument(e.id);let a=e.activeLayers[0],s={_obj:"placeEvent",null:{_path:await pi.createSessionToken(t),_kind:"local"},freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSAverage"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:0},vertical:{_unit:"pixelsUnit",_value:0}}},l={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await Q.executeCommand([s,l]);let c=e.activeLayers[0];if(Q.layerEqual(a,c))throw new Error("\u521B\u5EFA\u65B0\u56FE\u5C42\u5931\u8D25");let[u,d,f]=wi(e,c,o,r);if(u>0){let h={_obj:"transform",_target:[{_ref:"layer",_enum:"ordinal",_value:"targetEnum"}],freeTransformCenterState:{_enum:"quadCenterState",_value:"QCSCanvas"},offset:{_obj:"offset",horizontal:{_unit:"pixelsUnit",_value:d},vertical:{_unit:"pixelsUnit",_value:f}},width:{_unit:"percentUnit",_value:u},height:{_unit:"percentUnit",_value:u}};await Q.executeCommand(h)}}function Ei(e,t){let n,o,r,a;switch(e){case 1:n=520,o=10,r=500,a=500;break;case 2:n=1030,o=10,r=500,a=500;break;case 3:n=520,o=520,r=500,a=500;break}return[n,o,r,a]}async function vi(e,t,n,o,r){let a=t.length,[i,s,l,c]=Ei(o,r),u={_obj:"make",_target:[{_ref:"textLayer"}],using:{_obj:"textLayer",textKey:t,orientation:{_enum:"orientation",_value:"horizontal"},textShape:[{_obj:"textShape",char:{_enum:"char",_value:"box"},orientation:{_enum:"orientation",_value:"horizontal"},transform:{_obj:"transform",xx:1,xy:0,yx:0,yy:1,tx:i,ty:s},bounds:{top:0,left:0,bottom:l,right:c}}],textStyleRange:[{_obj:"textStyleRange",from:0,to:a,textStyle:{_obj:"textStyle",fontName:"ArialMT",size:{_unit:"pointsUnit",_value:20},color:{_obj:"RGBColor",red:255,green:255,blue:255}}}]},_options:{dialogOptions:"dontDisplay"}},d={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:n}};await Q.executeCommand([u,d])}async function bi(e){try{$n.log("\u6B63\u5728\u6E05\u9664\u5386\u53F2\u8BB0\u5F55"),await Q.activateDocument(e.id);let t={_obj:"clearEvent",_target:[{_property:"historyStates",_ref:"property"},{_enum:"ordinal",_ref:"document",_value:"targetEnum"}]};await Q.executeCommand(t)}catch(t){console.error(t)}}async function _i(e){let[t,n]=gi(e);if(Be.app.activeDocument){let a=Q.getDocumentSize(Be.app.activeDocument);if(t===a.width&&n===a.height)return Be.app.activeDocument}let o=await Be.core.executeAsModal(async a=>await Be.app.documents.add({name:"\u6279\u91CF\u751F\u56FE",width:t,height:n,resolution:72,fill:"black"}));if(!o)throw new Error("\u521B\u5EFA\u65B0\u56FE\u7247\u5931\u8D25");let r={_obj:"set",_target:[{_enum:"ordinal",_ref:"layer",_value:"targetEnum"}],to:{_obj:"layer",name:"\u80CC\u666F"}};return await Q.executeCommand(r),o}Nn.exports={createDocumentForBatch:_i,preparePSImageBatch:yi,addLayerImageBatch:hi,clearHistory:bi,addLayerTextBatch:vi}});var Hn=D((Ll,zn)=>{"use strict";var We=ee(),Fn=Le(),xi=se(),Ue=qn(),jn=at(),P=ie(),W=X(),{app:_l}=B("photoshop"),q=U(),Ii=document.getElementById("lSimpleLog"),xl=document.getElementById("wfButtonContainer"),Il=document.getElementById("btnPrompt"),Ti=document.getElementById("logContainer"),Tl=document.getElementById("btnSettings"),Cl=document.getElementById("btnInterrupt"),Ml=document.getElementById("wfParamContainer"),Al=document.getElementById("wfPreviewImage"),Sl=document.getElementById("wfMainToolbar");function Ci(){Ge=!1,window.showSingle(Ti),W.clearLog(),console.clear(),jn.DisabledUI(!0)}function Mi(){Ge=!1,jn.DisabledUI(!1)}var Lt=class{constructor(){}createDoc=async()=>{this.outputDoc=await Ue.createDocumentForBatch(this.batchImageParams.length)};promptBatch=async(t,n,o,r)=>{let a=performance.now();Ci();try{this.batchImageParams=r;let i=P.joinPath(n.output.folderbatch,q.BATCH_TASK_FILE_NAME),[s,l]=await P.readJsonFile(i),c=P.joinPath(n.output.folderbatch,q.BATCH_OUTPUT_FILE_NAME),[u,d]=await P.readJsonFile(c),f=await P.getEntryWithUrl(`file:${n.output.folderbatch}`),h=r.find(g=>g.batchnamed===!0);h||(h=r[0]);let p=l[h.valuefolder],y=0;for(let g=d.output.length;g<p.length;g++){if(Ge)throw Ge=!1,new Error("\u7528\u6237\u4E2D\u6B62\u751F\u56FE");window.config.batchPromptPreview&&!this.outputDoc&&await this.createDoc(),Ii.textContent=`${g+1}/${p.length}`;let m=p[g];W.log(`${g+1}/${p.length}`);let b=[];for(let I=0;I<r.length;I++){let L=r[I].valuefolder,T=l[L][g];if(T===void 0){W.error(`\u6587\u4EF6\u5939\u4E2D\u56FE\u7247\u6570\u91CF\u4E0D\u8DB3(${q.VALID_IMAGE_EXTENSIONS.join(" ")}):${L}`);return}let R=await P.getEntryWithUrl(P.joinPath(L,T));b.push(R)}await this.promptBatchOne(t,n,o,r,b,g,m,f,u,d),y>=2?document.dispatchEvent(new CustomEvent("wfChangeLogSimpleEvent",{detail:{}})):y+=1}let w=((performance.now()-a)/1e3).toFixed(1);W.log(`\u6279\u91CF\u6267\u884C\u5B8C\u6BD5  ${w}\u79D2`)}catch(i){W.error(i),i instanceof We.VerifyError&&document.dispatchEvent(new CustomEvent("verifyUserEvent",{detail:{error:i}}))}finally{Mi()}};promptBatchOne=async(t,n,o,r,a,i,s,l,c,u)=>{let d=performance.now();this.outputDoc&&await Ue.preparePSImageBatch(this.outputDoc,t);for(let p=0;p<r.length;p++){let y=a[p],w=await We.uploadImageBatch(y,y.name);W.warn(w.path),r[p].value=w.path,this.outputDoc&&await Ue.addLayerImageBatch(this.outputDoc,y,t,r.length,p)}let[f,h]=Fn.extractFileNameAndExtension(s);if(n.output.kind===q.OUTPUTIMAGE){let[p,y]=await We.prompt(t,n,o,window.config.showDetailLog,q.OUTPUT_NOZOOM,{width:100,height:100},null);W.log("\u6B63\u5728\u5B58\u50A8\u6587\u4EF6");let w=[];for(let L=0;L<p.length;L++){let{arrayBuffer:T,width:R,height:re}=p[L],et=L===0?`${f}${y}`:`${f}${L+1}${y}`,ae=await l.createFile(et,{overwrite:!0});if(await P.writeArrayBuffer(ae,T),w.push(et),this.outputDoc){let Re=await xi.saveTempFile(T,L===0?`cfimage${y}`:`cfimage${L+1}${y}`);W.warn(Re.nativePath,`${R}*${re}`),await Ue.addLayerImageBatch(this.outputDoc,Re,t,r.length,r.length)}}u.output.push(w);let{_:g,width:m,height:b}=p[0],I=((performance.now()-d)/1e3).toFixed(1);W.log(window.config.batchPromptPause>0?`\u751F\u56FE\u6210\u529F  ${m}*${b} ${I}\u79D2   \u7761\u7720${window.config.batchPromptPause}\u79D2`:`\u6267\u884C\u6210\u529F  ${m}*${b} ${I}\u79D2`)}else if(n.output.kind===q.OUTPUTTEXT){let y=(await We.prompt(t,n,o,window.config.showDetailLog,q.OUTPUT_NOZOOM,{width:100,height:100},null)).text,w=".txt";W.log(y);let g=[],m=`${f}${w}`,b=await l.createFile(m,{overwrite:!0});await P.writeTEXTFile(b,y),g.push(m),this.outputDoc&&await Ue.addLayerTextBatch(this.outputDoc,y,t,r.length,r.length),u.output.push(g);let I=((performance.now()-d)/1e3).toFixed(1);W.log(window.config.batchPromptPause>0?`\u6267\u884C\u6210\u529F  ${I}\u79D2   \u7761\u7720${window.config.batchPromptPause}\u79D2`:`\u6267\u884C\u6210\u529F  ${I}\u79D2`)}else throw new Error(`\u672A\u77E5\u8F93\u51FA\u7C7B\u578B${n.output.kind}`);window.config.batchPromptPause>0&&await Fn.sleep(window.config.batchPromptPause*1e3),await P.writeJsonFile(c,u),this.outputDoc&&await Ue.clearHistory(this.outputDoc)}};async function Ai(e){let t=P.joinPath(e,q.BATCH_TASK_FILE_NAME);if(!await P.fileExists(t))return!1;let n=P.joinPath(e,q.BATCH_OUTPUT_FILE_NAME);if(!await P.fileExists(n))return!1;let[o,r]=await P.readJsonFile(n);return r.output.length>0}async function Si(e,t,n,o){let r=P.joinPath(t.output.folderbatch,q.BATCH_TASK_FILE_NAME),a={};for(let s=0;s<o.length;s++){let l=o[s].valuefolder,c=await P.getImageFileNamesFromFolder(l,q.VALID_IMAGE_EXTENSIONS);if(c.length===0)throw new Error(`\u6587\u4EF6\u5939\u4E2D\u6CA1\u6709\u6709\u6548\u7684\u56FE\u7247(${q.VALID_IMAGE_EXTENSIONS.join(" ")}):${l}`);a[l]=c}await P.createJsonFile(r,a);let i=P.joinPath(t.output.folderbatch,q.BATCH_OUTPUT_FILE_NAME);await P.createJsonFile(i,{output:[]})}async function Li(e,t,n,o){let r=P.joinPath(t.output.folderbatch,q.BATCH_TASK_FILE_NAME),[a,i]=await P.readJsonFile(r),s=P.joinPath(t.output.folderbatch,q.BATCH_OUTPUT_FILE_NAME),[l,c]=await P.readJsonFile(s);for(let u=0;u<o.length;u++){let d=o[u].valuefolder;if(!i.hasOwnProperty(d))throw new Error(`\u7B2C${u+1}\u4E2A\u6587\u4EF6\u5939\uFF0C${d},\u8BE5\u76EE\u5F55\u5728\u4EFB\u52A1\u6587\u4EF6\u4E2D\u4E0D\u5B58\u5728\uFF0C\u8BF7\u4FEE\u6539\u5DE5\u4F5C\u6D41\u6216\u91CD\u65B0\u9009\u62E9\u7A7A\u7684\u8F93\u51FA\u6587\u4EF6\u5939`);if(u===0&&i[d].length<=c.output.length)throw new Error(`\u8F93\u5165\u76EE\u5F55${d}\u4E2D\u6709${i[d].length}\u5F20\u56FE\u7247,\u5DF2\u751F\u6210${c.output.length}\u5F20\u7ED3\u679C\u56FE\u7247.\u5F53\u524D\u4EFB\u52A1\u5DF2\u7ECF\u5B8C\u7ED3.`)}}function Pi(){try{let e=document.getElementById("wfBatchPromptHelpDialog");if(e){e.showModal();return}e=document.createElement("dialog"),e.id="wfBatchPromptHelpDialog",e.style.cssText="width: 800px;height: 500px;display: flex;flex-direction: column;";let t=document.createElement("div");t.style.cssText="max-width: 100%;max-height: 100%;overflow: auto;margin: 5px;gap: 5px;display: flex;flex-direction: column;";let n=document.createElement("sp-body");n.innerHTML=`\u6279\u91CF\u751F\u56FE\uFF1A<br>
        \u53EF\u4EE5\u6307\u5B9A\u4E00\u81F3\u4E09\u4E2A\u8F93\u5165\u76EE\u5F55<br>
        \u53EF\u4EE5\u4E2D\u65AD\u540E\u7EE7\u7EED\u6267\u884C\u672A\u5B8C\u6210\u7684\u4EFB\u52A1<br>
        \u652F\u6301\u7684\u56FE\u7247\u7C7B\u578B\u5305\u62EC${q.VALID_IMAGE_EXTENSIONS.join(" ")}<br>
        \u751F\u6210\u7684\u56FE\u7247\u5C06\u4EE5\u7B2C\u4E00\u4E2A\u8F93\u5165\u6587\u4EF6\u5939\u4E2D\u7684\u56FE\u7247\u540D\u79F0\u6765\u547D\u540D<br>
        \u5F00\u59CB\u6279\u91CF\u751F\u56FE\u540E\uFF0C\u4E0D\u8981\u968F\u610F\u53D8\u66F4\u8F93\u5165\u6587\u4EF6\u5939\u53CA\u5176\u4E2D\u7684\u56FE\u7247\uFF0C\u4EE5\u514D\u53D1\u751F\u672A\u77E5\u9519\u8BEF<br>
        \u5F00\u59CB\u6279\u91CF\u751F\u56FE\u540E\uFF0C\u4E0D\u8981\u4FEE\u6539\u6216\u5220\u9664\u8F93\u51FA\u76EE\u5F55\u4E2D\u7684JSON\u6587\u4EF6\uFF0C\u4EE5\u514D\u53D1\u751F\u672A\u77E5\u9519\u8BEF<br>
        \u6279\u5904\u7406\u65F6\uFF0C\u4E0D\u4F1A\u7EA6\u675F\u56FE\u7247\u6587\u4EF6\u7684\u5927\u5C0F\uFF0C\u8BF7\u5728\u5DE5\u4F5C\u6D41\u4E2D\u8FDB\u884C\u9650\u5B9A\uFF0C\u4EE5\u514D\u7206\u663E\u5B58<br>
        `,t.appendChild(n),e.appendChild(t),document.body.appendChild(e),e.showModal()}catch(e){W.error(e)}}var Rn;function Di(e,t,n,o){Rn=new Lt,Rn.promptBatch(e,t,n,o)}var Ge=!1;async function Oi(){try{Ge=!0,await We.interrupt(),W.error("\u5C1D\u8BD5\u4E2D\u6B62\u751F\u56FE...")}catch(e){W.error(e)}}zn.exports={promptBatch:Di,hasBatchTask:Ai,createBatchTask:Si,checkBatchTask:Li,showHelp:Pi,interruptPrompt:Oi}});var Kn=D((Pl,Gn)=>{"use strict";var Wn=U(),Ee,de,Pt,st,lt,Dt,Ot,kt;function ki(){Pt=document.getElementById("wfMgrNodeOutputDialog"),Ee=document.getElementById("wfMgrNodeOutputDialogListNode"),de=document.getElementById("wfMgrNodeOutputDialogListField"),st=document.getElementById("wfMgrNodeOutputDialogOKButton"),lt=document.getElementById("wfMgrNodeOutputDialogKind"),Dt=document.getElementById("wfMgrNodeOutputDialogZoomDiv"),Ot=document.getElementById("wfMgrNodeOutputDialogLess"),kt=document.getElementById("wfMgrNodeOutputDialogMore"),Ee.addEventListener("click",e=>{try{if(e.target.tagName==="SP-MENU-ITEM"){Ee.querySelectorAll("sp-menu-item").forEach(n=>n.removeAttribute("selected")),e.target.setAttribute("selected",!0);let t=e.target.getAttribute("data-nodeid");Bt(t)}}catch(t){throw console.error(t),alert(t),t;return}}),de.addEventListener("click",e=>{e.target.tagName==="SP-MENU-ITEM"&&(de.querySelectorAll("sp-menu-item").forEach(t=>t.removeAttribute("selected")),e.target.setAttribute("selected",!0))}),de.addEventListener("dblclick",e=>{e.target.tagName==="SP-MENU-ITEM"&&st.dispatchEvent(new Event("click"))}),lt.addEventListener("change",e=>{let t=e.currentTarget.value;Dt.style.display=t===Wn.OUTPUTIMAGE?"flex":"none"})}function Bt(e=null,t=null){de.innerHTML="";let n=ct[e],o=n?n.fields:{},r=!1;for(let a in o){let i=document.createElement("sp-menu-item");i.textContent=a,i.setAttribute("data-field",a),i.setAttribute("data-value",o[a]),a===t&&i.setAttribute("selected",!0),de.appendChild(i)}!r&&de.children.length===1&&de.children[0].setAttribute("selected",!0)}function Bi(){Ee.innerHTML="";for(let e in ct){let t=ct[e],n=t.fields,o=t.nodeclass,r=t.nodetitle;if(Object.keys(n).length===0)continue;let a=document.createElement("sp-menu-item");a.textContent=`${r}(\u7F16\u53F7${e})`,a.setAttribute("data-nodeid",e),a.setAttribute("data-nodetitle",r),a.setAttribute("data-nodeclass",o),Ee.appendChild(a)}}var ct=null;function Ui(e,t,n,o,r,a,i){ct=e,Bi();let s=null;t&&(s=Ee.querySelector(`sp-menu-item[data-nodeid="${t}"]`)),t&&s?(s.setAttribute("selected",!0),Bt(t,n)):(Ee.querySelectorAll("sp-menu-item").forEach(l=>{l.removeAttribute("selected")}),Bt()),lt.querySelectorAll("sp-menu-item").forEach(l=>{l.value===o?l.setAttribute("selected",!0):l.removeAttribute("selected")}),Ot.querySelectorAll("sp-menu-item").forEach(l=>{l.value===r?l.setAttribute("selected",!0):l.removeAttribute("selected")}),kt.querySelectorAll("sp-menu-item").forEach(l=>{l.value===a?l.setAttribute("selected",!0):l.removeAttribute("selected")}),Dt.style.display=o===Wn.OUTPUTIMAGE?"flex":"none",st.addEventListener("click",async function l(){try{let c=Ee.querySelector("sp-menu-item[selected]"),u=de.querySelector("sp-menu-item[selected]");if(!c||!u)return;let d=c.getAttribute("data-nodeid"),f=c.getAttribute("data-nodetitle"),h=c.getAttribute("data-nodeclass"),p=u.getAttribute("data-field"),y=lt.value,w=Ot.value,g=kt.value;st.removeEventListener("click",l),Pt.close(),await i(d,f,h,p,y,w,g)}catch(c){throw console.error(c),alert(c),c;return}}),Pt.showModal()}Gn.exports={initShow:ki,show:Ui}});var Yn=D((Dl,Xn)=>{"use strict";var Vn=ee(),$e,Ut,$t;function $i(){Ut=document.getElementById("wfMgrRecoverDialog"),$e=document.getElementById("wfMgrRecoverList"),$t=document.getElementById("wfMgrRecoverDialogOKButton"),$e.addEventListener("click",e=>{try{e.target.tagName==="SP-MENU-ITEM"&&($e.querySelectorAll("sp-menu-item").forEach(t=>t.removeAttribute("selected")),e.target.setAttribute("selected",!0))}catch(t){throw console.error(t),alert(t),t;return}})}function Ni(e){$e.innerHTML="";for(let t=0;t<e.length;t++){let n=e[t].wfname,o=e[t].deltime,r=e[t].wfid,a=document.createElement("sp-menu-item");a.textContent=`${n}(${o})`,a.setAttribute("data-wfname",n),a.setAttribute("data-wfid",r),$e.appendChild(a)}}async function qi(e){let t=await Vn.get_workflows_recover();Ni(t),$t.addEventListener("click",async function n(){$t.removeEventListener("click",n);try{let o=$e.querySelector("sp-menu-item[selected]");if(!o)return;let r=o.getAttribute("data-wfname"),a=o.getAttribute("data-wfid");await Vn.workflows_recover(r,a),Ut.close(),e(r)}catch(o){throw console.error(o),alert(o),o;return}}),Ut.showModal()}Xn.exports={initShow:$i,show:qi}});var Jn=D((Ol,Zn)=>{"use strict";var ve=null,fe=null,Nt=null,ut=null;function Fi(){Nt=document.getElementById("wfMgrNodeFieldDialog"),ve=document.getElementById("wfMgrNodeFieldDialogListNode"),fe=document.getElementById("wfMgrNodeFieldDialogListField"),ut=document.getElementById("wfMgrNodeFieldDialogOKButton"),ve.addEventListener("click",e=>{try{if(e.target.tagName==="SP-MENU-ITEM"){ve.querySelectorAll("sp-menu-item").forEach(n=>n.removeAttribute("selected")),e.target.setAttribute("selected",!0);let t=e.target.getAttribute("data-nodeid");qt(t)}}catch(t){throw console.error(t),alert(t),t;return}}),fe.addEventListener("click",e=>{e.target.tagName==="SP-MENU-ITEM"&&(fe.querySelectorAll("sp-menu-item").forEach(t=>t.removeAttribute("selected")),e.target.setAttribute("selected",!0))}),fe.addEventListener("dblclick",e=>{e.target.tagName==="SP-MENU-ITEM"&&ut.dispatchEvent(new Event("click"))})}function qt(e=null,t=null){fe.innerHTML="";let n=dt[e],o=n?n.fields:{},r=!1;for(let a in o){let i=document.createElement("sp-menu-item");i.textContent=a,i.setAttribute("data-field",a),i.setAttribute("data-value",o[a]),a===t&&i.setAttribute("selected",!0),fe.appendChild(i)}!r&&fe.children.length===1&&fe.children[0].setAttribute("selected",!0)}function Ri(){ve.innerHTML="";for(let e in dt){let t=dt[e],n=t.fields,o=t.nodeclass,r=t.nodetitle;if(Object.keys(n).length===0)continue;let a=document.createElement("sp-menu-item");a.textContent=`${r}(\u7F16\u53F7${e})`,a.setAttribute("data-nodeid",e),a.setAttribute("data-nodetitle",r),a.setAttribute("data-nodeclass",o),ve.appendChild(a)}}var dt=null;function ji(e,t,n,o){dt=e,Ri();let r=null;t&&(r=ve.querySelector(`sp-menu-item[data-nodeid="${t}"]`)),t&&r?(r.setAttribute("selected",!0),qt(t,n)):(ve.querySelectorAll("sp-menu-item").forEach(a=>{a.removeAttribute("selected")}),qt()),ut.addEventListener("click",async function a(){try{let i=ve.querySelector("sp-menu-item[selected]"),s=fe.querySelector("sp-menu-item[selected]");if(!i||!s)return;let l=i.getAttribute("data-nodeid"),c=i.getAttribute("data-nodetitle"),u=i.getAttribute("data-nodeclass"),d=s.getAttribute("data-field"),f=s.getAttribute("data-value");ut.removeEventListener("click",a),Nt.close(),await o(l,c,u,d,f)}catch(i){throw console.error(i),alert(i),i;return}}),Nt.showModal()}Zn.exports={initShow:Fi,show:ji}});var eo=D((Bl,Qn)=>{"use strict";var kl=U();function zi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Hi(e){let t={};for(let n in e){if(!e.hasOwnProperty(n))continue;let o=e[n],r=o.class_type,a=o._meta?o._meta.title:o.class_type;t[n]={nodeclass:r,nodetitle:a,fields:{}};let i=t[n].fields;for(let s in o.inputs){if(!o.inputs.hasOwnProperty(s))continue;let l=o.inputs[s];Array.isArray(l)||(i[s]=l)}}return t}function Wi(e){let t={};for(let n in e){if(!e.hasOwnProperty(n))continue;let o=e[n],r=o.class_type,a=o._meta?o._meta.title:o.class_type;t[n]={nodeclass:r,nodetitle:a,fields:{}};let i=t[n].fields;for(let s in o.inputs)o.inputs.hasOwnProperty(s)&&Array.isArray(o.inputs[s])&&(i[s]="")}return t}function Gi(e){return!e||typeof e!="object"?!1:Object.keys(e).every(n=>/^\d+$/.test(n))}Qn.exports={isWfAPI:Gi,parsenodes:Hi,generateUUID:zi,parsenodeslist:Wi}});var Rt=D((Ul,fo)=>{"use strict";var be=ee(),no=Kn(),oo=Yn(),ro=Jn(),Me=eo(),k=U();function Ki(){let e=null;for(let t in V){let o=V[t].nodeclass;if(o==="SaveImage"){e=t;break}else o==="PreviewImage"&&(e=t)}if(e){let t=V[e],n=t.nodetitle,o=t.nodeclass;E.setAttribute("data-nodeid",e),E.setAttribute("data-field","images"),E.setAttribute("data-kind",k.OUTPUTIMAGE),E.setAttribute("data-lesszoom",k.OUTPUT_LESSZOOM),E.setAttribute("data-morezoom",k.OUTPUT_MOREZOOM),E.setAttribute("data-nodetitle",n),E.setAttribute("data-nodeclass",o),E.textContent=`${n}(${e})`}else E.removeAttribute("data-nodeid"),E.removeAttribute("data-field"),E.removeAttribute("data-kind"),E.removeAttribute("data-lesszoom"),E.removeAttribute("data-morezoom"),E.removeAttribute("data-nodetitle"),E.removeAttribute("data-nodeclass"),E.textContent=""}function Vi(){let e=null,t=null;for(let n in V){let o=V[n];for(let r in o.fields){let a=o.fields[r];if(r==="image"){e=n,t=r;break}}}if(e){let n=V[e],o=n.nodetitle,r=n.nodeclass,a=n.fields[t];ft(null,e,o,r,t,"\u83B7\u53D6\u56FE\u7247",a,k.INPUTIMAGE,"",!1)}else ft(null,null,null,null,"","\u83B7\u53D6\u56FE\u7247","",k.INPUTIMAGE,"",!1)}function Xi(){ft(null,null,null,null,"","","",null,"",!0)}function Yi(e){try{let t=E.getAttribute("data-nodeid"),n=E.getAttribute("data-field"),o=E.getAttribute("data-kind"),r=E.getAttribute("data-lesszoom"),a=E.getAttribute("data-morezoom");no.show(Se,t,n,o,r,a,(i,s,l,c,u,d,f)=>{E.setAttribute("data-nodeid",i),E.setAttribute("data-field",c),E.setAttribute("data-kind",u),E.setAttribute("data-lesszoom",d),E.setAttribute("data-morezoom",f),E.setAttribute("data-nodetitle",s),E.setAttribute("data-nodeclass",l),E.textContent=`${s}(\u7F16\u53F7${i})`})}catch(t){throw console.error(t),alert(t),t;return}}function Zi(e){try{let t=e.currentTarget.getAttribute("data-divid"),n=document.getElementById(t),o=n.querySelector(".wfMgrNode"),r=o.getAttribute("data-nodeid"),a=o.getAttribute("data-field");ro.show(V,r,a,async(i,s,l,c,u)=>{o.setAttribute("data-nodeid",i),o.setAttribute("data-nodetitle",s),o.setAttribute("data-nodeclass",l),o.textContent=`\u8282\u70B9=${s}(${i}),   \u5B57\u6BB5=${c}`,o.setAttribute("data-field",c);let d=n.querySelector(".wfMgrTitle");d.value.trim()||(d.value=c);let h=n.querySelector(".wfMgrValue");h.value||(h.value=String(u));let y=n.querySelector(".wfMgrKind");if(!y.value){let[w,g]=await be.guessFieldKind(l,c),m=n.querySelector(".wfMgrExtra");w&&(y.querySelectorAll("sp-menu-item").forEach(b=>{b.value===w?b.setAttribute("selected",!0):b.removeAttribute("selected")}),w===k.SLIDER&&(m.value=`${g.min},${g.max},${g.step}`))}})}catch(t){throw console.error(t),alert(t),t;return}}function ft(e,t,n,o,r,a,i,s,l,c,u){let d=document.createElement("div");d.id=`wfMgrDiv-${Me.generateUUID()}`,d.innerHTML=io,pe.appendChild(d);let f=d.querySelector(".wfMgrNode");f.setAttribute("data-nodeid",t),f.setAttribute("data-field",r),f.setAttribute("data-nodetitle",n),f.setAttribute("data-nodeclass",o),f.setAttribute("data-divid",d.id),f.addEventListener("click",Zi),t&&(f.textContent=`\u8282\u70B9=${n}(${t}),   \u5B57\u6BB5=${r}`),d.querySelector(".wfMgrTitle").value=a,e&&(e.named&&f.setAttribute("data-named",e.named),e.placed&&f.setAttribute("data-placed",e.placed));let h=d.querySelector(".wfMgrValue");h.value=String(i),h.setAttribute("data-valuefolder",u);let p=d.querySelector(".wfMgrKind");p.setAttribute("data-divid",d.id),p.querySelectorAll("sp-menu-item").forEach(g=>{g.value===s&&g.setAttribute("selected",!0)}),p.addEventListener("change",g=>{let m=g.currentTarget.value,b=g.currentTarget.getAttribute("data-divid"),I=document.getElementById(b),L=I.querySelector(".wfMgrVisible"),T=I.querySelector(".wfMgrExtra"),R=I.querySelector(".wfMgrValue");switch(T.style.display="block",R.style.display="block",T.parentElement.querySelector("[data-label-extra]").style.display="block",R.parentElement.querySelector("[data-label-value]").style.display="block",m){case k.SLIDER:let re=T.value;re||(r==="denoise"?re="0,1,0.01":r==="steps"?re="1,40,1":re="0,100,1",T.value=re);break;case k.SEED:L.checked=!1;break;case k.INPUTIMAGE:case k.INPUTIMAGEMASK:case k.INPUTREGIONMASK:L.checked=!1,T.style.display="none",T.parentElement.querySelector("[data-label-extra]").style.display="none",R.style.display="none",R.parentElement.querySelector("[data-label-value]").style.display="none";break;case k.FIELDENUM:T.style.display="none",T.parentElement.querySelector("[data-label-extra]").style.display="none";break;default:break}});let y=d.querySelector(".wfMgrExtra");y.value=l,d.querySelector(".wfMgrVisible").checked=c;let w=d.querySelector(".wfMgrDel");switch(w.addEventListener("click",Ji),w.setAttribute("data-divid",d.id),s){case k.INPUTIMAGE:case k.INPUTIMAGEMASK:case k.INPUTREGIONMASK:y.style.display="none",y.parentElement.querySelector("[data-label-extra]").style.display="none",h.style.display="none",h.parentElement.querySelector("[data-label-value]").style.display="none";break;case k.FIELDENUM:y.style.display="none",y.parentElement.querySelector("[data-label-extra]").style.display="none";break;default:break}d.addEventListener("contextmenu",g=>{if(g.preventDefault(),Ke>=0){let m=pe.children[Ke],b=g.currentTarget;if(!m||!b)return;Ke=-1,pe.insertBefore(m,b);let I=m.querySelector(".wfMgrNode"),L=b.querySelector(".wfMgrNode");be.save_wf_params_sort(j,I.getAttribute("data-nodeid"),I.getAttribute("data-field"),L.getAttribute("data-nodeid"),L.getAttribute("data-field"))}else Ke=Array.from(pe.children).indexOf(g.currentTarget)})}function Ji(e){let t=e.currentTarget.getAttribute("data-divid"),n=document.getElementById(t);pe.removeChild(n)}async function ao(){try{let e=await be.get_wf_api_run();return e.result?(Y=e,!0):!1}catch(e){throw console.error(e),alert(`\u8BFB\u53D6\u5DE5\u4F5C\u6D41API\u65F6\u51FA\u9519:${e}`),e;return}}async function Qi(){if(await ao())try{V=Me.parsenodes(Y.apidata),Se=Me.parsenodeslist(Y.apidata),me.disabled=!1,Ae.disabled=!1,Ae.value="\u65B0\u589E\u5DE5\u4F5C\u6D41",document.getElementById("tfwfMgrPath").value=Y.lasttime,pe.innerHTML="",Ki(),Vi()}catch(e){throw console.error(e),alert(e),e;return}}async function es(){if(await ao())try{V=Me.parsenodes(Y.apidata),Se=Me.parsenodeslist(Y.apidata),document.getElementById("tfwfMgrPath").value=Y.lasttime}catch(e){throw console.error(e),alert(e),e;return}}function Ve(){try{let e=document.getElementById("wfPromptContainer"),t=document.getElementById("wfManageContainer");t.style.display="none",e.style.display="flex",qe&&document.dispatchEvent(new CustomEvent("wfRefreshWorkflowEvent",{detail:{}}))}catch(e){throw console.error(e),alert(e),e}}async function to(e){try{await oo.show(t=>{localStorage.setItem("lastWorkflow",t),qe=!0,Ve()})}catch(t){throw console.error(t),alert(t),t;return}}var mt=!1,qe=!1,Ae,me,pe,Ne,Ft,E,Ce,Ke=-1,io,j,Y,V,Se;async function so(){mt=!1,qe=!1,j=null,Y=null,V=null,Se=null,Ke=-1,await window.loadHtml("wfManageContainer","html/wfmanage.html"),Ae=document.getElementById("tfwfMgrName"),me=document.getElementById("btnWfManageSave"),pe=document.getElementById("wfManageContainerInner"),Ne=document.getElementById("btnWfManageDel"),Ft=document.getElementById("btnWfManageRecover"),E=document.getElementById("tfwfMgrOutput"),Ce=document.getElementById("wfManageLog"),io=await(await fetch("html/wfparamtempelate.html")).text(),document.getElementById("btnWfManageHelp").addEventListener("click",t=>{document.getElementById("wfManageHelpDialog").showModal()}),document.getElementById("btnWfManageReturn").addEventListener("click",async t=>{(!mt||await window.confirm("\u5DE5\u4F5C\u6D41\u5C1A\u672A\u4FDD\u5B58\uFF0C\u786E\u5B9A\u8981\u8FD4\u56DE\u5417\uFF1F"))&&Ve()}),Ne.addEventListener("click",ts),document.getElementById("tfwfMgrAddParam").addEventListener("click",Xi),E.addEventListener("click",Yi),Ft.addEventListener("click",to),ro.initShow(),no.initShow()}async function ts(){try{if(!j||!await confirm("\u786E\u5B9A\u8981\u5220\u9664\u5DE5\u4F5C\u6D41\u5417\uFF1F"))return;qe=!0,await be.save_wf_del({wfname:j}),Ve()}catch(e){throw console.error(e),alert(e),e}finally{Ne.disabled=!1}}function lo(){let e=E.getAttribute("data-nodeid"),t=E.getAttribute("data-field"),n=E.getAttribute("data-kind"),o=E.getAttribute("data-lesszoom"),r=E.getAttribute("data-morezoom"),a=E.getAttribute("data-nodetitle"),i=E.getAttribute("data-nodeclass"),s=E.getAttribute("data-folderbatch");if(!e||!t){ne("\u8BF7\u5148\u8BBE\u7F6E\u7ED3\u679C\u8282\u70B9\u53CA\u5B57\u6BB5");return}if(!(e in Se)){ne("\u7ED3\u679C\u8282\u70B9\u4E0D\u6B63\u786E");return}if(!(t in Se[e].fields)){ne("\u7ED3\u679C\u8282\u70B9\u5B57\u6BB5\u4E0D\u6B63\u786E");return}let l=[],c=new Set;for(let d=0;d<pe.children.length;d++){let f=pe.children[d],h=f.querySelector(".wfMgrTitle").value.trim(),p=f.querySelector(".wfMgrNode"),y=p.getAttribute("data-nodetitle"),w=p.getAttribute("data-nodeclass"),g=p.getAttribute("data-nodeid"),m=p.getAttribute("data-field"),b=p.getAttribute("data-named"),I=p.getAttribute("data-placed"),L=f.querySelector(".wfMgrValue").value,T=f.querySelector(".wfMgrValue").getAttribute("data-valuefolder"),R=f.querySelector(".wfMgrKind").value,re=f.querySelector(".wfMgrExtra").value,et=f.querySelector(".wfMgrVisible").checked;if(!R){ne(`\u7B2C${d+1}\u4E2A\u6761\u4EF6\uFF0C\u6761\u4EF6\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A`);return}if(!g||!m){ne(`\u7B2C${d+1}\u4E2A\u6761\u4EF6\uFF0C\u8282\u70B9\u53CA\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A`);return}if(!(g in V&&m in V[g].fields)){ne(`\u7B2C${d+1}\u4E2A\u6761\u4EF6\uFF0C\u8282\u70B9\u6216\u5B57\u6BB5\u4E0D\u6B63\u786E`);return}let ae={title:h,kind:R,nodeid:g,nodetitle:y,nodeclass:w,field:m,value:L,extra:re,visible:et,valuefolder:T};b&&(ae.named=b),I&&(ae.placed=I),l.push(ae);let Re=`${ae.nodeid}-${ae.field}`;if(c.has(Re)){ne(`\u627E\u5230\u91CD\u590D: \u8282\u70B9=${ae.nodeid}, \u5B57\u6BB5=${ae.field}`);return}c.add(Re)}return{params:l,output:{nodeid:e,field:t,nodetitle:a,nodeclass:i,folderbatch:s,kind:n,lesszoom:o,morezoom:r}}}function co(e){Ce.textContent=e,Ce.style.color="lightgreen",setTimeout(()=>{Ce.textContent=""},800)}function ne(e){Ce.textContent=e,Ce.style.color="orange",setTimeout(()=>{Ce.textContent=""},2e3)}async function ns(){if(!Y){ne("\u8BF7\u5148\u63D0\u53D6\u5DE5\u4F5C\u6D41API,\u5982\u679C\u63D0\u53D6\u4E0D\u5230\uFF0C\u8BF7\u5728COMFYUI\u4E2D\u6267\u884C\u4E00\u6B21\u540E\u518D\u8BD5\uFF01");return}let e=Ae.value.trim();if(!e){ne("\u5DE5\u4F5C\u6D41\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A");return}let t=lo();t&&(await be.save_wf_new_run({apidata:Y.apidata,wfname:e,params:t}),mt=!1,qe=!0,j=e,localStorage.setItem("lastWorkflow",j),co("\u5DE5\u4F5C\u6D41\u4FDD\u5B58\u6210\u529F"),Ve())}async function uo(){let e=Ae.value.trim();if(!e){ne("\u5DE5\u4F5C\u6D41\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A");return}let t=lo();t&&(await be.save_wf_edit({wfname:j,wfnamenew:e,params:t,apidata:Y?Y.apidata:null}),mt=!1,qe=!0,j!==e&&localStorage.setItem("lastWorkflow",e),j=e,co("\u5DE5\u4F5C\u6D41\u4FDD\u5B58\u6210\u529F"),Ve())}async function os(){await so(),oo.initShow(),document.getElementById("btnWfManageOpenFile").addEventListener("click",Qi),me.disabled=!0,Ae.disabled=!0,Ne.style.display="none",Ft.style.display="block",me.addEventListener("click",async e=>{try{me.disabled=!0,j?await uo():await ns()}catch(t){throw console.error(t),alert(t),t}finally{me.disabled=!1}}),document.getElementById("btnWfManageOpenFile").dispatchEvent(new Event("click"))}async function rs(e){try{await so(),document.getElementById("btnWfManageOpenFile").addEventListener("click",es),Ne.disabled=!0,me.disabled=!0,me.addEventListener("click",async o=>{try{await uo()}catch(r){throw console.error(r),alert(r),r}}),j=e,document.getElementById("tfwfMgrPath").value=`${j}.json`;let t=await be.get_wf_api(j);V=Me.parsenodes(t),Se=Me.parsenodeslist(t);let n=await be.get_wf_params(j);n.output.kind||(n.output.kind=k.PROMPTMODE_COMMON),n.output.lesszoom||(n.output.lesszoom=k.OUTPUT_LESSZOOM),n.output.morezoom||(n.output.morezoom=k.OUTPUT_MOREZOOM),Ae.value=j,E.setAttribute("data-nodeid",n.output.nodeid),E.setAttribute("data-field",n.output.field),E.setAttribute("data-kind",n.output.kind),E.setAttribute("data-lesszoom",n.output.lesszoom),E.setAttribute("data-morezoom",n.output.morezoom),E.setAttribute("data-nodetitle",n.output.nodetitle),E.setAttribute("data-nodeclass",n.output.nodeclass),E.setAttribute("data-folderbatch",n.output.folderbatch),E.textContent=`${n.output.nodetitle}(${n.output.nodeid})`,n.output.kind||(n.output.kind=k.OUTPUTIMAGE);for(let o of n.params)ft(o,o.nodeid,o.nodetitle,o.nodeclass,o.field,o.title,o.value,o.kind,o.extra,o.visible,o.valuefolder)}catch(t){throw console.error(t),alert(t),t}finally{me.disabled=!1,Ne.disabled=!1}}function as(){window.loadCSS("../css/wfmgr.css")}fo.exports={initPanel:as,showNew:os,showEdit:rs}});var yo=D(($l,wo)=>{"use strict";var pt=ie(),zt=ee(),jt=U(),Ht=se(),is=X(),z=document.getElementById("wfParamContainer");function ss(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function mo(e,t=-1){e.innerHTML="";let n=Ht.getDocuments(),o=!1;for(let r=0;r<n.length;r++){let a=document.createElement("sp-menu-item");a.textContent=n[r].name,a.setAttribute("value",n[r].id),(r===0&&t===-1||n[r].id===t)&&(a.setAttribute("selected",!0),o=!0),e.appendChild(a)}!o&&e.children.length>0&&e.children[0].setAttribute("selected",!0)}function _e(e,t){let n=document.createElement("sp-action-button");return n.style.justifyContent="flex-end",n.setAttribute("quiet",!0),n.textContent=e,n.setAttribute("size","s"),n.addEventListener("click",t),n}function ls(e){let t=e.currentTarget.value;try{Ht.activateDocument(t)}catch(n){console.error(n)}}function ge(e){let t=document.createElement("sp-label");return t.setAttribute("data-input-label",!0),t.textContent=`${e}:`,t.style.marginRight="5px",t.style.width="25%",t}function cs(e,t){let n=e.value,o=we();z.appendChild(o);let r=ge(e.title);o.appendChild(r);let a=0,i=100,s=1;e.extra&&([a,i,s]=e.extra.split(","));let l=document.createElement("sp-slider");l.setAttribute("min",a),l.setAttribute("max",i),l.setAttribute("step",s),l.setAttribute("variant","filled"),l.setAttribute("gradient","true"),t&&l.addEventListener("change",t),l.style.padding="0px",l.style.flexGrow="1",l.value=n,o.appendChild(l);let c=document.createElement("sp-label");return c.style.justifyContent="flex-end",Number.isInteger(l.value)?c.textContent=`${l.value}`:c.textContent=`${l.value.toFixed(2)}`,c.style.padding="0px",l.addEventListener("input",u=>{Number.isInteger(l.value)?c.textContent=`${l.value}`:c.textContent=`${l.value.toFixed(2)}`}),o.appendChild(c),l}function we(){let e=document.createElement("div");return e.style.justifyContent="space-between",e.style.display="flex",e.style.width="100%",e}function us(e){let t=e.value,n=ge(e.title),o=we();z.appendChild(o),o.appendChild(n),n.addEventListener("click",s=>{z.querySelectorAll("[data-input-image]").forEach(u=>{u.removeAttribute("data-output-placed");let d=u.getAttribute("data-title"),f=u.parentElement.querySelector("[data-input-label]");f.textContent=`${d}:`});let l=s.currentTarget.parentElement.querySelector("sp-picker"),c=l.getAttribute("data-title");l.setAttribute("data-output-placed",!0),s.currentTarget.textContent=`${c}(*):`});let r=document.createElement("sp-picker");r.setAttribute("data-input-image",!0);let a=document.createElement("sp-menu");a.setAttribute("slot","options"),r.appendChild(a),mo(a,e.docid),r.addEventListener("change",ls),r.style.flexGrow="1",o.appendChild(r),e.placed&&(n.textContent=`${e.title}(*):`,r.setAttribute("data-output-placed",!0));let i=_e("",async s=>{try{let l=await pt.getImageFilePath();if(!l)return;let c=await Ht.openImageFile(l),u=s.target.parentElement.parentElement.parentElement.querySelector('sp-menu[slot="options"]');mo(u,c)}catch(l){console.error(l)}});return i.innerHTML=`
    <div slot="icon" style="fill: currentColor">
    <svg viewBox="0 0 36 36" style="width: 18px; height: 18px;">
      <path d="M6 6h24v24H6V6zm2 2v16l5-5 4 4 7-7 4 4V8H8z" fill="currentColor"/>
    </svg>
  </div>`,i.style.padding="0px",o.appendChild(i),r}function po(e){try{e.focus()}catch{}}function ds(e){let t=e.output.folderbatch,n=ge("\u8F93\u51FA\u76EE\u5F55"),o=we();z.appendChild(o),o.appendChild(n);let r=document.createElement("sp-textfield");r.value=t,r.setAttribute("data-output-batchfolder",!0),r.size="s",r.style.flexGrow="1",o.appendChild(r);let a=_e("",async i=>{let s=await pt.getFolder();if(s){let l=i.target.parentElement.querySelector("sp-textfield");l.value=s.nativePath,po(l)}});return a.innerHTML='<sp-icon name="ui:FolderBreadcrumb" size="s" slot="icon"></sp-icon>',a.style.padding="0px",o.appendChild(a),go(),r}function fs(e){let t=e.valuefolder,n=we();z.appendChild(n);let o=ge(e.title);n.appendChild(o),o.addEventListener("click",i=>{let s=i.currentTarget.parentElement.querySelector("sp-textfield");z.querySelectorAll("[data-input-batchfolder]").forEach(c=>{c.removeAttribute("data-batch-named");let u=c.getAttribute("data-title"),d=c.parentElement.querySelector("[data-input-label]");d.textContent=`${u}:`});let l=s.getAttribute("data-title");s.setAttribute("data-batch-named",!0),i.currentTarget.textContent=`${l}(*):`});let r=document.createElement("sp-textfield");r.setAttribute("data-input-batchfolder",!0),r.value=t,r.style.flexGrow="1",n.appendChild(r),e.batchnamed&&(o.textContent=`${e.title}(*):`,r.setAttribute("data-batch-named",!0));let a=_e("",async i=>{let s=await pt.getFolder();if(s){let l=i.target.parentElement.querySelector("sp-textfield");try{l.value=s.nativePath,po(l);let c=pt.joinPath(s.nativePath,"output"),u=z.querySelector("[data-output-batchfolder]");(!u.value||u.value==="")&&(u.value=c)}catch(c){console.log(c)}}});return a.innerHTML='<sp-icon name="ui:FolderBreadcrumb" size="s" slot="icon"></sp-icon>',a.style.padding="0px",n.appendChild(a),r}function ms(e,t){let n=e.value,o=ge(e.title),r=document.createElement("div");r.style.flexDirection="column",r.style.display="flex",z.appendChild(r);let a=document.createElement("div");a.style.justifyContent="space-between",a.style.display="flex",a.appendChild(o);let i=document.createElement("div");i.style.justifyContent="flex-end",i.style.display="flex",a.appendChild(i);let s=_e("\u4E2D",async d=>{try{let f=d.currentTarget.parentElement.parentElement.parentElement.querySelector("sp-textarea"),h=f.value.trim();if(!h)return;let p=await zt.translateToZH(h);f.value=p}catch(f){throw console.error(f),alert(`\u7FFB\u8BD1\u65F6\u51FA\u9519${f}`),f}});i.appendChild(s),s.style.display=window.config.transEnable?"flex":"none",s.style.padding="0px";let l=_e("\u82F1",async d=>{try{let f=d.currentTarget.parentElement.parentElement.parentElement.querySelector("sp-textarea"),h=f.value.trim();if(!h)return;let p=await zt.translateToEN(h);f.value=p}catch(f){throw console.error(f),alert(`\u7FFB\u8BD1\u65F6\u51FA\u9519${f}`),f}});l.style.display=window.config.transEnable?"flex":"none",l.style.padding="0px",i.appendChild(l);let c=_e("\u6587",async d=>{try{let f=d.currentTarget.parentElement.parentElement.parentElement.querySelector("sp-textarea");document.dispatchEvent(new CustomEvent("wfReverseEvent",{detail:{textarea_id:f.id}}))}catch(f){throw console.error(f),alert(`\u7FFB\u8BD1\u65F6\u51FA\u9519${f}`),f}});c.style.padding="0px",i.appendChild(c),r.appendChild(a);let u=document.createElement("sp-textarea");return u.style.height=100,u.style.overflow="auto",u.setAttribute("grows",!0),u.setAttribute("maxlength","1500"),u.id=`wfInputText-${ss()}`,u.value=n,r.appendChild(u),u.style.width="100%",t&&u.addEventListener("change",t),u}async function ps(e,t){e.innerHTML="";let n=!1,o=await zt.get_wf_nodefield_enum(t.nodeclass,t.field);for(let r=0;r<o.length;r++){let a=document.createElement("sp-menu-item");a.textContent=o[r],o[r]===t.value&&(a.setAttribute("selected",!0),n=!0),e.appendChild(a)}!n&&o.length>0&&e.children[0].setAttribute("selected",!0)}function gs(e,t){let n=e.value,o=ge(e.title),r=we();z.appendChild(r),r.appendChild(o);let a=document.createElement("sp-picker"),i=document.createElement("sp-menu");return i.setAttribute("slot","options"),a.appendChild(i),ps(i,e),a.style.flexGrow="1",t&&a.addEventListener("change",t),r.appendChild(a),a}function ws(e,t){let n=we();z.appendChild(n);let o=e.value,r=ge(e.title);n.appendChild(r);let a=document.createElement("sp-textfield");return a.value=o,a.style.flexGrow="1",a.setAttribute("maxlength","100"),t&&a.addEventListener("change",t),n.appendChild(a),a}function ys(){switch(window.config.promptMode){case jt.PROMPTMODE_COMMON:return"\u751F\u6210";case jt.PROMPTMODE_BATCH:return"\u6279\u91CF\u751F\u6210";case jt.PROMPTMODE_LIVE:return"\u5B9E\u65F6\u7ED8\u753B"}}function go(){let e=document.createElement("sp-divider");e.style.marginTop="2px",e.style.marginBottom="2px",e.size="s",z.appendChild(e)}function hs(e){let t=we();z.appendChild(t);let n=ge("\u654F\u9510\u5EA6(\u79D2)");t.appendChild(n);let o=window.config.livePromptSensitivity,r=0,a=5,i=.1,s=document.createElement("sp-slider");s.setAttribute("min",r),s.setAttribute("max",a),s.setAttribute("step",i),s.setAttribute("variant","filled"),s.setAttribute("gradient","true"),s.style.flexGrow="1",s.style.padding="0px",s.value=o,s.addEventListener("change",e),t.appendChild(s);let l=document.createElement("sp-label");return l.style.justifyContent="flex-end",Number.isInteger(s.value)?l.textContent=`${s.value}`:l.textContent=`${s.value.toFixed(2)}`,l.style.padding="0px",s.addEventListener("input",c=>{Number.isInteger(s.value)?l.textContent=`${s.value}`:l.textContent=`${s.value.toFixed(2)}`}),t.appendChild(l),s}function Es(){let e=we();z.appendChild(e);let t=ge("\u751F\u56FE\u6682\u505C(\u79D2):");t.setAttribute("data-keep-enabled",!0),e.appendChild(t);let n=window.config.batchPromptPause,o=0,r=60,a=1,i=document.createElement("sp-slider");i.setAttribute("data-keep-enabled",!0),i.setAttribute("min",o),i.setAttribute("max",r),i.setAttribute("step",a),i.setAttribute("variant","filled"),i.setAttribute("gradient","true"),i.style.flexGrow="1",i.style.padding="0px",i.value=n,e.appendChild(i),i.style.width="60%",i.addEventListener("input",c=>{try{Number.isInteger(i.value)?s.textContent=`${i.value}`:s.textContent=`${i.value.toFixed(2)}`;let u=c.currentTarget.value;window.config.batchPromptPause=u,window.saveConfig()}catch(u){console.error(u)}});let s=document.createElement("sp-label");s.setAttribute("data-keep-enabled",!0),s.style.justifyContent="flex-end",Number.isInteger(i.value)?s.textContent=`${i.value}`:s.textContent=`${i.value.toFixed(2)}`,s.style.padding="0px";let l=_e("",c=>{});return l.textContent=window.config.batchPromptPreview?"\u{1F50D}":"---",l.setAttribute("quiet",!0),l.setAttribute("variant","secondary"),l.setAttribute("variant","overBackground"),l.style.padding="0px",l.setAttribute("data-keep-enabled",!0),l.addEventListener("click",()=>{window.config.batchPromptPreview=!window.config.batchPromptPreview,l.textContent=window.config.batchPromptPreview?"\u{1F50D}":"---",window.saveConfig(),is.log(window.config.batchPromptPreview?"\u5F00\u542F\u9884\u89C8":"\u5173\u95ED\u9884\u89C8")}),e.appendChild(l),i}function vs(e){let t=we();z.appendChild(t);let n=document.createElement("sp-body");n.style.width="100%",n.style.textAlign="center",n.textContent=e,t.appendChild(n);let o=_e("",r=>{document.dispatchEvent(new CustomEvent("wfEditWorkflowEvent",{detail:{}}))});o.className="btnWfEdit",o.innerHTML=`
    <div slot="icon" style="fill: currentColor">
        <svg viewBox="0 0 36 36" style="width: 14px; height: 14px;">
        <g transform="scale(0.85) translate(8, 0)">
            <path d="M32 9l-6-6-21 21-3 9 9-3L32 9z" />
        </g>
        </svg>
    </div>
    `,o.style.padding="0px",o.title="\u4FEE\u6539\u5DE5\u4F5C\u6D41",t.appendChild(o)}function bs(e){let t=z.querySelector(`[data-nodeid="${e.nodeid}"][data-field="${e.field}"]`);return t||null}wo.exports={createParamPromptText:ms,createParamSlider:cs,createParamImage:us,createParamImageBatch:fs,createParamOutputBatch:ds,createParamFIELDENUM:gs,createParamDefault:ws,getPromptModeLabel:ys,createParamDivider:go,createParamLiveSensitivity:hs,createParamBatchPause:Es,createWfTitle:vs,getUIParamsInput:bs}});var Bo=D((Nl,ko)=>{"use strict";var{app:Wt}=B("photoshop"),_s=ie(),Z=ee(),Xe=at(),Ye=Un(),Fe=Hn(),ho=Rt(),Xt=X(),F=yo(),Mo=Le(),v=U(),Ao=document.getElementById("btnPrompt"),ye=document.getElementById("wfButtonContainer"),Je=document.getElementById("wfParamContainer"),Eo=document.getElementById("lSimpleLog"),xs=document.getElementById("buttonContainer"),So=document.getElementById("wfMainToolbar"),Is=document.getElementById("btnInterrupt"),vo=document.getElementById("wfPromptContainer"),bo=document.getElementById("wfManageContainer"),Kt=document.getElementById("btnAddWorkflow"),Vt=document.getElementById("btnWfRefresh");function Ze(e){xs.querySelectorAll("*").forEach(t=>{t.disabled=e}),So.querySelectorAll("*").forEach(t=>{t.disabled=e}),Je.querySelectorAll("*").forEach(t=>{t.hasAttribute("data-keep-enabled")||(t.disabled=e)}),ye.style.display!=="none"&&Array.from(ye.children).forEach(t=>{t.disabled=e})}function wt(){So.querySelectorAll("*").forEach(n=>{n.disabled=!1}),Array.from(ye.children).forEach(n=>{n.disabled=!1});let t=Je.querySelector(".btnWfEdit");t&&(t.disabled=!1)}async function Ts(e){try{let t=e.currentTarget,n=t.getAttribute("data-wfname");if(n===G)return;Array.from(ye.children).forEach(o=>{o.setAttribute("quiet",!0),o.setAttribute("variant","secondary")}),t.removeAttribute("quiet"),t.setAttribute("variant","overBackground"),await Po(n)}catch(t){throw console.error(t),alert(`\u52A0\u8F7D\u5DE5\u4F5C\u6D41\u65F6\u51FA\u9519:${t}`),t}}function Gt(e,t){let n=null;switch(e.kind){case v.PROMPTTEXT:n=F.createParamPromptText(e,t);break;case v.SLIDER:n=F.createParamSlider(e,t);break;case v.INPUTIMAGE:switch(window.config.promptMode){case v.PROMPTMODE_BATCH:n=F.createParamImageBatch(e);break;default:n=F.createParamImage(e)}break;case v.INPUTIMAGEMASK:n=F.createParamImage(e);break;case v.INPUTREGIONMASK:n=F.createParamImage(e);break;case v.FIELDENUM:n=F.createParamFIELDENUM(e,t);break;default:n=F.createParamDefault(e,t)}n.setAttribute("data-kind",e.kind),n.setAttribute("data-nodeid",e.nodeid),n.setAttribute("data-field",e.field),n.setAttribute("data-title",e.title),n.size="s",F.createParamDivider()}async function _o(e){try{Je.innerHTML="",Eo.textContent="",Eo.style.display="none",F.createWfTitle(e.newwfname),await Oo(e.newwfname),A.params.forEach(t=>{t.visible?window.config.promptMode===v.PROMPTMODE_LIVE?Gt(t,Ye.paramChanged):Gt(t):window.config.promptMode===v.PROMPTMODE_BATCH&&t.kind===v.INPUTIMAGE&&Gt(t)}),window.config.promptMode===v.PROMPTMODE_BATCH?(F.createParamOutputBatch(A),F.createParamBatchPause()):window.config.promptMode===v.PROMPTMODE_LIVE&&F.createParamLiveSensitivity(Ye.sensitivityChanged),localStorage.setItem("lastWorkflow",G),Xt.clearLog(),window.showSingle(document.getElementById("logContainer")),Ze(!1)}catch(t){throw Ze(!0),wt(),t}}function Lo(e){Co=e,Co==="ADMIN"?(Kt.style.display="flex",Vt.style.display="flex"):(Kt.style.display="none",Vt.style.display="none")}async function Po(e){if(!e)return;let[t,n]=await Z.test_comfyui_jinn(window.config.comfyuiURL);if(t===!0){Lo(n),await _o({newwfname:e});return}Ze(!0);let o=new CustomEvent("comfyuiConnectEvent",{detail:{data:{newwfname:e},callback:_o}});document.dispatchEvent(o)}async function xo(){A.output.docid=-1;for(let e of A.params){let t=null,n=F.getUIParamsInput(e);switch(n&&(t=n.value),e.kind){case v.SEED:t=t??Mo.randInt(1,1e6),e.value=t;break;case v.PROMPTTEXT:t=t??e.value,e.value=t;let o=t;window.config.transEnable&&t&&(o=await Z.translateToEN(t)),e.valueen=o;break;case v.INPUTIMAGE:if(window.config.promptMode===v.PROMPTMODE_COMMON){if(!Wt.activeDocument)throw new Error("\u8BF7\u5148\u6253\u5F00\u56FE\u7247");if(t=t??-1,n&&t===-1)throw new Error(`${e.title}:\u6CA1\u6709\u9009\u5B9A\u56FE\u7247`);e.docid=t,n&&n.hasAttribute("data-output-placed")?(e.placed=!0,A.output.docid=e.docid):e.placed=!1}else window.config.promptMode===v.PROMPTMODE_LIVE&&(t=t??-1,e.docid=t);break;case v.INPUTIMAGEMASK:if(window.config.promptMode===v.PROMPTMODE_LIVE)throw new Error(`"${e.title}":\u5B9E\u65F6\u751F\u56FE\u4E0D\u652F\u6301\u56FE\u7247\u8499\u677F\u6761\u4EF6\u3002`);if(window.config.promptMode===v.PROMPTMODE_COMMON){if(!Wt.activeDocument)throw new Error("\u8BF7\u5148\u6253\u5F00\u56FE\u7247");if(t=t??-1,n&&t===-1)throw new Error(`${e.title}:\u6CA1\u6709\u9009\u5B9A\u56FE\u7247`);e.docid=t,n&&n.hasAttribute("data-output-placed")?(e.placed=!0,A.output.docid=e.docid):e.placed=!1}break;case v.INPUTREGIONMASK:if(window.config.promptMode===v.PROMPTMODE_LIVE)throw new Error(`"${e.title}":\u6279\u91CF\u751F\u56FE\u4E0D\u652F\u6301\u9009\u533A\u8499\u677F`);if(window.config.promptMode===v.PROMPTMODE_COMMON){if(!Wt.activeDocument)throw new Error("\u8BF7\u5148\u6253\u5F00\u56FE\u7247");if(t=t??-1,n&&t===-1)throw new Error(`${e.title}:\u6CA1\u6709\u9009\u5B9A\u56FE\u7247`);e.docid=t,n&&n.hasAttribute("data-output-placed")?(e.placed=!0,A.output.docid=e.docid):e.placed=!1}break;default:t=t??e.value,e.value=t}}}async function Cs(){let e=[],t=new Set;for(let r of A.params){let a=null,i=F.getUIParamsInput(r);switch(i&&(a=i.value),r.kind){case v.SEED:a=a??Mo.randInt(1,1e6),r.value=a;break;case v.PROMPTTEXT:a=a??r.value,r.value=a;let s=a;window.config.transEnable&&a&&(s=await Z.translateToEN(a)),r.valueen=s;break;case v.INPUTIMAGE:if(!a||a.trim()==="")throw new Error(`${r.title}:\u6CA1\u6709\u6307\u5B9A\u76EE\u5F55`);if(t.has(a))throw new Error(`"${r.title}":\u5176\u5B83\u6761\u4EF6\u5DF2\u7ECF\u6307\u5B9A\u4E86\u8BE5\u76EE\u5F55`);t.add(a),r.valuefolder=a,i&&i.hasAttribute("data-batch-named")?r.batchnamed=!0:r.batchnamed=!1,e.push(r);break;case v.INPUTIMAGEMASK:throw new Error(`"${r.title}":\u6279\u91CF\u751F\u56FE\u4E0D\u652F\u6301\u56FE\u7247\u8499\u677F\u6761\u4EF6\u3002`);case v.INPUTREGIONMASK:throw new Error(`"${r.title}":\u6279\u91CF\u751F\u56FE\u4E0D\u652F\u6301\u9009\u533A\u8499\u677F`);default:a=a??r.value,r.value=a}}if(e.length===0)throw new Error("\u6CA1\u6709\u627E\u5230\u201C\u83B7\u53D6\u56FE\u7247\u201D\u6761\u4EF6");if(e.length>3)throw new Error("\u6682\u4E0D\u652F\u63013\u4E2A\u4EE5\u4E0A\u7684\u201C\u83B7\u53D6\u56FE\u7247\u201D\u6761\u4EF6");let o=Je.querySelector("[data-output-batchfolder]").value;if(!o)throw new Error("\u6CA1\u6709\u6307\u5B9A\u8F93\u51FA\u56FE\u50CF\u7684\u76EE\u5F55");if(t.has(o))throw new Error('"\u8F93\u51FA\u56FE\u50CF":\u5176\u5B83\u6761\u4EF6\u5DF2\u7ECF\u6307\u5B9A\u4E86\u8BE5\u76EE\u5F55');return t.add(o),A.output.folderbatch=o,e}async function Ms(){try{if(!G){alert("\u8BF7\u9009\u62E9\u4E00\u4E2A\u5DE5\u4F5C\u6D41");return}if(!A){alert("\u672A\u6B63\u786E\u52A0\u8F7D\u5DE5\u4F5C\u6D41");return}if(window.config.promptMode===v.PROMPTMODE_BATCH){let e=await Cs(),t;try{t=await _s.getFolderWithCreate(A.output.folderbatch)}catch(n){throw new Error(`"\u8F93\u51FA\u56FE\u50CF":${n.message}`)}if(await Fe.hasBatchTask(A.output.folderbatch)){if(await Fe.checkBatchTask(G,A,xe,e),!await confirm('"\u8F93\u51FA\u56FE\u50CF":\u8BE5\u76EE\u5F55\u5DF2\u5B58\u5728\u6279\u91CF\u4EFB\u52A1\uFF0C\u5C06\u81EA\u52A8\u8DF3\u8FC7\u5DF2\u5904\u7406\u7684\u56FE\u7247\uFF0C\u8981\u7EE7\u7EED\u751F\u56FE\u5417\uFF1F'))return}else await Fe.createBatchTask(G,A,xe,e);Fe.promptBatch(G,A,xe,e)}else if(window.config.promptMode===v.PROMPTMODE_LIVE){if(A.output.kind!==v.OUTPUTIMAGE){alert("\u5B9E\u65F6\u751F\u56FE\u65F6\uFF0C\u8F93\u51FA\u7C7B\u578B\u53EA\u80FD\u662F\u56FE\u50CF");return}await xo(),Ye.promptLive(G,A,xe)}else await xo(),A.output.kind===v.OUTPUTIMAGE?Xe.prompt(G,A,xe):Xe.promptOutputText(G,A,xe)}catch(e){throw Xt.error(e),e}}var gt=-1;async function Io(){try{Xt.clearLog(),window.showSingle(document.getElementById("logContainer"));let e=localStorage.getItem("lastWorkflow"),t=-1,n=await Z.get_workflows();for(let o=0;o<n.length;o++)if(n[o].wfname===e){t=o;break}t<0&&n.length>0&&(t=0),ye.innerHTML="",Je.innerHTML="";for(let o=0;o<n.length;o++){let r=n[o],a=document.createElement("sp-action-button");a.setAttribute("data-wfname",r.wfname),a.setAttribute("quiet",!0),a.setAttribute("variant","secondary"),a.size="s",a.style.border="0px solid #0056b3",a.textContent=r.wfname.slice(0,window.config.wfNameLength),t>=0&&r.wfname===n[t].wfname&&(a.setAttribute("variant","overBackground"),a.removeAttribute("quiet")),a.addEventListener("click",Ts),a.addEventListener("contextmenu",i=>{if(i.preventDefault(),gt>=0){let s=ye.children[gt],l=i.currentTarget;if(!s||!l)return;gt=-1,ye.insertBefore(s,l),Z.workflows_sort(s.getAttribute("data-wfname"),l.getAttribute("data-wfname"))}else gt=Array.from(ye.children).indexOf(i.currentTarget)}),a.className="dynamic-button",ye.appendChild(a)}t>=0?(await Po(n[t].wfname),n[t].selected=!0):wt(),Ao.textContent=F.getPromptModeLabel(),document.getElementById("btnWfBatchPromptHelp").style.display=window.config.promptMode===v.PROMPTMODE_BATCH||window.config.promptMode===v.PROMPTMODE_LIVE?"flex":"none"}catch(e){throw Ze(!0),wt(),e}}async function As(){try{Ze(!0),await Oo(null);let[e,t]=await Z.test_comfyui_jinn(window.config.comfyuiURL);if(e===!0){document.dispatchEvent(new CustomEvent("setReverseRefreshEvent",{detail:{}})),Lo(t),await Io();return}let n=new CustomEvent("comfyuiConnectEvent",{detail:{data:{},callback:Io}});document.dispatchEvent(n)}catch(e){throw wt(),console.error(e),alert(`\u52A0\u8F7D\u5DE5\u4F5C\u6D41\u5217\u8868\u65F6\u51FA\u9519:${e}`),e}}async function To(){try{let e=document.getElementById("userInfoDialog"),n=document.getElementById("tfUserInfoPhone").value.trim();if(n.length<7||!/^\d+$/.test(n)){alert("\u8F93\u5165\u4E0D\u6B63\u786E");return}await Z.registry_user(n),e.close()}catch(e){alert(e)}}function Ss(){let e=document.getElementById("userInfoDialog");if(e)return;e=document.createElement("dialog"),e.id="userInfoDialog",e.style.cssText="width:300px; padding:20px; display:flex; flex-direction:column; align-items:center; text-align:center;";let t=document.createElement("sp-body");t.id="tfUserInfoMessage",t.textContent="\u8BF7\u8F93\u5165\u4F60\u7684\u624B\u673A\u53F7\u7801\uFF1A",t.style.marginBottom="15px";let n=document.createElement("sp-textfield");n.id="tfUserInfoPhone",n.setAttribute("maxlength","20"),n.setAttribute("placeholder","\u8BF7\u8F93\u5165\u624B\u673A\u53F7"),n.style.width="100%",n.style.margin="0 auto";let o=document.createElement("sp-action-button");o.id="btnUserInfoSubmit",o.textContent="\u63D0\u4EA4",o.style.marginTop="15px",e.appendChild(t),e.appendChild(n),e.appendChild(o),document.body.appendChild(e)}function Ls(e){try{let{error:t}=e.detail;if(t.needinfo){Ss();let n=document.getElementById("userInfoDialog"),o=document.getElementById("btnUserInfoSubmit"),r=document.getElementById("tfUserInfoMessage");r.textContent=t.message,n.showModal(),o.removeEventListener("click",To),o.addEventListener("click",To,{once:!0})}else alert(t.message)}catch(t){alert(t)}}async function Ps(e){try{let{textarea_id:t}=e.detail;if(!window.config.reverseWfName){alert("\u8BF7\u5728\u53C2\u6570\u8BBE\u7F6E\u4E2D\u6307\u5B9A\u53CD\u63A8\u5DE5\u4F5C\u6D41");return}let n=await Z.get_wf_params(window.config.reverseWfName),o=await Z.get_wf_api(window.config.reverseWfName);Xe.promptOutputText(window.config.reverseWfName,n,o,async r=>{let a=document.getElementById(t);if(window.config.transEnable){let i=await Z.translateToZH(r);a.value=i}else a.value=r})}catch(t){alert(t)}}function Ds(){Kt.addEventListener("click",t=>{try{bo.style.display="flex",vo.style.display="none",ho.showNew()}catch(n){throw console.error(n),alert(n),n}}),document.addEventListener("wfEditWorkflowEvent",t=>{try{let n=Do();if(!n)return;bo.style.display="flex",vo.style.display="none",ho.showEdit(n)}catch(n){throw console.error(n),alert(n),n}}),Ao.addEventListener("click",Ms),Is.addEventListener("click",async()=>{window.config.promptMode===v.PROMPTMODE_LIVE?Ye.interruptPrompt():window.config.promptMode===v.PROMPTMODE_BATCH?Fe.interruptPrompt():Xe.interruptPrompt()}),document.getElementById("btnWfBatchPromptHelp").addEventListener("click",async()=>{window.config.promptMode===v.PROMPTMODE_LIVE?Ye.showHelp():Fe.showHelp()}),document.addEventListener("wfRefreshWorkflowEvent",As),document.addEventListener("verifyUserEvent",Ls),document.addEventListener("wfReverseEvent",Ps),Vt.addEventListener("click",async()=>{document.dispatchEvent(new CustomEvent("wfRefreshWorkflowEvent",{detail:{}}))}),document.dispatchEvent(new CustomEvent("wfRefreshWorkflowEvent",{detail:{}})),document.addEventListener("wfLoadTempImageEvent",async t=>{try{Xe.loadTempImage(t.detail)}catch(n){console.error(n)}})}function Do(){return G}var G,A,xe,Co="";async function Oo(e){G=e,G!==null?(A=await Z.get_wf_params(G),A.output.kind||(A.output.kind=v.OUTPUTIMAGE),A.output.field||(A.output.field="images"),xe=await Z.get_wf_api(G)):(A=null,xe=null)}ko.exports={initPanel:Ds,getWfname:Do}});var qo=D((ql,No)=>{"use strict";var Os=ee(),Uo=ie(),ht=U(),S={comfyuiURL:"http://127.0.0.1:8188",setAILayer:ht.SETAILAYERCLOSE,wfDisplayType:"button",wfNameLength:10,pszoomMinsize:"512",pszoomMaxsize:"1024",showDetailLog:!1,outputPreview:!1,transEnable:!1,transBaiduAppID:"",transBaiduAppKey:"",promptMode:ht.PROMPTMODE_COMMON,livePromptSensitivity:2,batchPromptPause:2,batchPromptPreview:!0,reverseWfName:"",loadTempImage:!1};window.config=S;var $o="pluginConfig.json";async function ks(){try{let n=await(await(await Uo.getDataFolder()).getEntry($o)).read(),o=JSON.parse(n);Object.assign(S,o)}catch{console.log("\u4F7F\u7528\u9ED8\u8BA4\u53C2\u6570")}}async function oe(){try{await(await(await Uo.getDataFolder()).createEntry($o,{overwrite:!0})).write(JSON.stringify(S,null,2))}catch(e){console.error("Error saving config:",e)}}window.saveConfig=oe;function yt(e,t){e.forEach(n=>{n.getAttribute("data-value")===t?n.removeAttribute("quiet"):n.setAttribute("quiet","")})}async function Bs(){let e=document.getElementById("btnSetDisplayTypePicker"),t=document.getElementById("btnSetDisplayTypeButton"),n=document.getElementById("btnSetAILayerClose"),o=document.getElementById("btnSetAILayerDel"),r=document.getElementById("btnSetAILayerOmit");document.getElementById("btnSetComfyuiURL").addEventListener("click",g=>{let m=I=>{window.showSingle(document.getElementById("settingsContainer"))},b=new CustomEvent("comfyuiConnectEvent",{detail:{data:{},callback:m}});document.dispatchEvent(b)});let a=[n,o,r];a.forEach(g=>{g.addEventListener("click",m=>{let b=m.currentTarget.getAttribute("data-value");b!==S.setAILayer&&(S.setAILayer=b,oe(),yt([n,o,r],S.setAILayer),S.setAILayer===ht.SETAILAYERDEL&&alert("\u542F\u7528\u8BE5\u53C2\u6570\u65F6\uFF0CAI\u751F\u56FE\u540E\u4F1A\u5220\u9664\u5176\u5B83\u7531AI\u751F\u6210\u7684\u56FE\u5C42\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"))})}),yt(a,S.setAILayer);let i=document.getElementById("spSetMaxSize"),s=document.getElementById("spSetMinSize");i.querySelectorAll("sp-menu-item").forEach(g=>{g.value===S.pszoomMaxsize&&g.setAttribute("selected",!0)}),s.querySelectorAll("sp-menu-item").forEach(g=>{g.value===S.pszoomMinsize&&g.setAttribute("selected",!0)}),i.addEventListener("change",g=>{let m=g.currentTarget.value;S.pszoomMaxsize=m,oe()}),s.addEventListener("change",g=>{let m=g.currentTarget.value;S.pszoomMinsize=m,oe()});let l=document.getElementById("cbSetLoadTempImage");l.checked=S.loadTempImage,l.addEventListener("change",async g=>{try{let m=document.getElementById("cbSetLoadTempImage").checked;S.loadTempImage=m,oe()}catch(m){throw console.error(m),alert(m),m}});let c=document.getElementById("cbSetTransEnable");c.checked=S.transEnable,c.addEventListener("change",async g=>{try{let m=document.getElementById("cbSetTransEnable").checked;S.transEnable=m,oe()}catch(m){throw console.error(m),alert(m),m}});let u=document.getElementById("cbSetTransBaiduAppID");u.value=S.transBaiduAppID,u.addEventListener("change",async g=>{try{let m=document.getElementById("cbSetTransBaiduAppID").value;S.transBaiduAppID=m,oe()}catch(m){throw console.error(m),alert(m),m}});let d=document.getElementById("cbSetTransBaiduAppKey");d.value=S.transBaiduAppKey,d.addEventListener("change",async g=>{try{let m=document.getElementById("cbSetTransBaiduAppKey").value;S.transBaiduAppKey=m,oe()}catch(m){throw console.error(m),alert(m),m}}),document.getElementById("btnSetTransBaiduHelp").addEventListener("click",g=>{document.getElementById("cbSetTransHelpBaiduDialog").showModal()}),document.getElementById("spSetReverse").addEventListener("change",g=>{let m=g.currentTarget.value;S.reverseWfName=m,oe()}),document.addEventListener("setReverseRefreshEvent",async g=>{try{if(document.getElementById("settingsContainer").children.length===0)return;let b=document.getElementById("spSetReverse"),I=await Os.get_workflows(),L=b.querySelector('sp-menu[slot="options"]');L.innerHTML="";for(let T=0;T<I.length;T++){if(I[T].output_kind!==ht.OUTPUTTEXT)continue;let R=document.createElement("sp-menu-item");R.textContent=I[T].wfname,I[T].wfname===S.reverseWfName&&R.setAttribute("selected",!0),L.appendChild(R)}}catch(m){console.error(m)}}),document.dispatchEvent(new CustomEvent("setReverseRefreshEvent",{detail:{}}));let h=document.getElementById("btnSetPromptCommon"),p=document.getElementById("btnSetPromptBatch"),y=document.getElementById("btnSetPromptLive"),w=[h,p,y];w.forEach(g=>{g.addEventListener("click",m=>{let b=m.currentTarget.getAttribute("data-value");b!==S.promptMode&&(S.promptMode=b,oe(),yt(w,S.promptMode),document.dispatchEvent(new CustomEvent("wfRefreshWorkflowEvent",{detail:{}})))})}),yt(w,S.promptMode)}No.exports={loadConfig:ks,initPanel:Bs}});var Ho=D((Fl,zo)=>{"use strict";var Fo=ee(),Us=U();function Qe(e,t=!0){let n=document.getElementById("divTestInfo");n.innerHTML=`${e}`,t?n.style.color="#ff5555":n.style.color="lightgreen"}async function $s(e,t){let n=document.getElementById("btnConnect"),o=document.getElementById("tfComfyuiURL"),r=o.value.trim();try{r=r.match(/^https?:\/\//)?r:`http://${r}`,r=r.replace(/\/+$/,""),new URL(r)}catch(s){Qe(`URL\u4E0D\u5408\u6CD5:${r}`),console.log(s);return}Qe(`\u5C1D\u8BD5\u8FDE\u63A5\u5230:${r}`),n.disabled=!0;try{await Fo.test_comfyui(r)}catch(s){Qe("\u8FDE\u63A5COMFYUI\u5931\u8D25<br>\u8BF7\u590D\u5236\u4E0A\u9762\u7684\u5730\u5740\u5230\u6D4F\u89C8\u5668\uFF0C\u4EE5\u68C0\u67E5COMFYUI\u662F\u5426\u542F\u52A8"),console.log(s),n.disabled=!1;return}let[a,i]=await Fo.test_comfyui_jinn(r);if(a!==!0){Qe("COMFYUI\u5DF2\u8FDE\u63A5,\u4F46\u662F\u6CA1\u6709\u5B89\u88C5comfyui_jinn\u63D2\u4EF6<br>\u8BF7\u5C06\u5B89\u88C5\u5305\u4E2D\u7684comfyui_jinn_ps\u76EE\u5F55\u590D\u5236\u5230COMFYUI\u4E0B\u7684custom_nodes\u76EE\u5F55\uFF0C\u91CD\u542FCOMFYUI\u670D\u52A1\u518D\u8BD5"),n.disabled=!1;return}window.config.comfyuiURL=r,window.saveConfig(),o.value=window.config.comfyuiURL,Qe("\u8FDE\u63A5COMFYUI\u6210\u529F!",!1),n.disabled=!1;try{await e(t)}catch(s){throw console.error(s),alert(s),s}}var Ro=null,jo=null;function Ns(e,t){let n=document.getElementById("connContainer");window.showSingle(n);let o=document.getElementById("divTestInfo");o.innerHTML="";let r=document.getElementById("tfComfyuiURL");r.value=config.comfyuiURL,Ro=e,jo=t}document.addEventListener("comfyuiConnectEvent",e=>{let{data:t,callback:n}=e.detail;Ns(n,t)});async function qs(){document.getElementById("connContainer").innerHTML.trim()===""&&await window.loadHtml("connContainer","html/connect.html");let t=document.getElementById("btnResetComfyuiURL"),n=document.getElementById("btnConnect");t.addEventListener("click",()=>{tfComfyuiURL.value=Us.DEFAULT_COMFYUI_URL}),n.addEventListener("click",async o=>{await $s(Ro,jo)})}zo.exports={initPanel:qs}});var Go=D(()=>{var{entrypoints:Fs}=B("uxp");typeof window.alert!="function"&&(window.alert=async function(e=""){let t=document.getElementById("alertDialog");t||(t=document.createElement("dialog"),t.innerHTML=`
      <sp-body>${e}</sp-body>
      <div style="width:100%;display: flex; justify-content:center;">
        <sp-action-button id="alertDialogOK" >\u786E\u5B9A</sp-action-button>
      </div>
      `,document.body.appendChild(t),t.querySelector("#alertDialogOK").addEventListener("click",()=>{t.close(),resolve(!0)})),t.querySelector("sp-body").textContent=e,t.style.width="350px",t.id="alertDialog",t.showModal()});typeof window.confirm!="function"&&(window.confirm=async function(e="\u786E\u5B9A\u8981\u7EE7\u7EED\u5417\uFF1F"){let t=document.getElementById("confirmDialog");return t||(t=document.createElement("dialog"),t.innerHTML=`
          <sp-body  style="width=100%;">${e}</sp-body>
          <div style="width:100%;display: flex; justify-content:center;">
            <sp-action-button id="confirmDialogCancel">\u53D6\u6D88</sp-action-button>
            <sp-action-button id="confirmDialogOK" >\u786E\u5B9A</sp-action-button>
          </div>
      `,t.id="confirmDialog",t.style.width="350px",document.body.appendChild(t)),t.querySelector("sp-body").textContent=e,new Promise(n=>{t.querySelector("#confirmDialogOK").addEventListener("click",()=>{t.close(),n(!0)}),t.querySelector("#confirmDialogCancel").addEventListener("click",()=>{t.close(),n(!1)}),t.showModal()})});Fs.setup({panels:{"jinn_ps_ai.panel_main":{show(e){},create(){},hide(){},destroy(){},menuItems:[],invokeMenu(e){}}}});window.loadHtml=async function(t,n){try{let r=await(await fetch(n)).text();document.getElementById(t).innerHTML=r}catch(o){throw console.log(`\u52A0\u8F7D${n}\u5931\u8D25`,o),o}};window.loadCSS=function(t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,document.head.appendChild(n)};window.showSingle=function(e){Array.from(Gs.children).forEach(t=>{t===e?t.style.display="flex":t.style.display="none"})};async function Rs(){Yt.children.length===0&&(await window.loadHtml("settingsContainer","html/settings.html"),await Wo.initPanel()),Yt.style.display!=="none"?window.showSingle(Ks):window.showSingle(Yt)}document.body.innerHTML=`
  <div id="wfPromptContainer">
    <div id="wfMainToolbar" style="display: flex; align-items: center;  justify-content:flex-end; ">
      <div style="display: flex; align-items: center;  justify-content: flex-end;">
        <sp-action-button id="btnWfBatchPromptHelp" title="\u5E2E\u52A9" style="display: none;" quiet><sp-icon name="ui:HelpSmall" size="s" slot="icon"></sp-icon></sp-action-button>

        <sp-action-button id="btnAddWorkflow" title="\u6DFB\u52A0\u5DE5\u4F5C\u6D41" size="s" style="display: none;" quiet>
          <div slot="icon" style="fill: currentColor"><svg viewBox="0 0 36 36" style="width: 18px; height: 18px;"><path d="M16 2v14H2v4h14v14h4V20h14v-4H20V2h-4z" fill="currentColor" /></svg></div>
        </sp-action-button>
        <sp-action-button id="btnWfRefresh" title="\u5237\u65B0" size="s" style="display: none;" quiet>
          <div slot="icon" style="fill: currentColor">
            <svg viewBox="0 0 36 36" style="width: 18px; height: 18px;"><path d="M18 4a14 14 0 1 0 13.86 16h-3.02a11 11 0 1 1-2.68-9.29l-3.46 3.47H32V4l-3.92 3.92A13.95 13.95 0 0 0 18 4z" fill="currentColor"/></svg>
          </div>
        </sp-action-button>
      </div>
    </div>
    
    <sp-divider size="medium" style="margin-top: 0px; margin-top: 5px;"></sp-divider>
    <div id="wfButtonContainer" style="display: flex;flex-wrap: wrap; overflow-y: auto;"></div>
    <sp-divider size="medium" style="margin-top: 2px; margin-bottom: 0px;"></sp-divider>

    <div id="wfParamContainer" class="wfParamContainer">
    </div>
    
    <div id="buttonContainer" style="display: flex;flex-direction: row;  justify-content: space-between; align-items: center; width: 100%;margin-top: 5px;">
      <div style="width: 30%; display: flex; justify-content:flex-start;">
        <sp-action-button id="btnInterrupt" title="\u4E2D\u65AD"  size="xxs" style="display: none; justify-content: flex-end;margin-right: 0px;" variant="warning" quiet>\u2715</sp-action-button>
      </div>
      
      <sp-button id="btnPrompt" style="width: 30%;  position: absolute;left: 50%;transform: translateX(-50%);">\u751F\u6210</sp-button>
      

      <div style="width: 30%;height:100%; display: flex; justify-content:flex-end;">
        <sp-label id="lSimpleLog" style="display: none; justify-content: flex-end;text-align: right;"></sp-label>
        <sp-action-button id="btnSettings" title="\u8BBE\u7F6E" style=" justify-content: flex-end; margin-top: auto" quiet>
          <div slot="icon" style="fill: currentColor">
            <svg viewBox="8 8 16 16" style="width: 18px; height: 18px;"><path fill-rule="evenodd" clip-rule="evenodd" d="M21.6809 16.2095C21.6809 16.5068 21.8334 16.772 22.0878 16.9206C23.1918 17.5625 23.5706 18.9877 22.9343 20.0987C22.6239 20.6386 22.1235 21.0244 21.5246 21.1855C20.9294 21.3427 20.307 21.2618 19.7725 20.9513C19.5197 20.8036 19.2186 20.8036 18.9657 20.9497C18.709 21.0968 18.5558 21.3637 18.5558 21.6616C18.5558 22.9446 17.5179 23.9894 16.242 23.9894C14.9653 23.9894 13.9275 22.9446 13.9275 21.6616C13.9275 21.3628 13.7742 21.0968 13.5176 20.949C13.2647 20.8036 12.9636 20.8036 12.7123 20.9513C12.1771 21.2618 11.5539 21.3442 10.9572 21.1847C10.3589 21.0237 9.85945 20.6379 9.54981 20.0987C8.91342 18.9877 9.29308 17.5617 10.3963 16.9199C10.6507 16.7728 10.8024 16.5068 10.8024 16.2095C10.8024 15.9123 10.6507 15.6463 10.3963 15.4985C9.29308 14.8582 8.91342 13.4329 9.54981 12.3212C9.85945 11.7812 10.3589 11.3954 10.958 11.2343C11.5554 11.074 12.1771 11.1581 12.7123 11.4685C12.9643 11.6163 13.2655 11.6148 13.5176 11.4701C13.7742 11.3222 13.9275 11.0561 13.9275 10.7574C13.9275 9.47452 14.9653 8.42969 16.242 8.42969C17.5179 8.42969 18.5558 9.47452 18.5558 10.7574C18.5558 11.0554 18.709 11.3222 18.9657 11.4692C19.2193 11.6163 19.5205 11.6163 19.7725 11.4685C20.3063 11.1581 20.9285 11.0756 21.5246 11.2335C22.1235 11.3946 22.6239 11.7805 22.9343 12.3204C23.5706 13.4321 23.1918 14.8574 22.0885 15.4992C21.8334 15.647 21.6809 15.9123 21.6809 16.2095ZM16.2419 18.5434C14.955 18.5434 13.9079 17.4962 13.9079 16.2094C13.9079 14.9226 14.955 13.8755 16.2419 13.8755C17.5287 13.8755 18.5758 14.9226 18.5758 16.2094C18.5758 17.4962 17.5287 18.5434 16.2419 18.5434Z"fill="#7D7D7D"></path> </svg>
          </div>
        </sp-action-button>
      </div>
      

    </div>

    <div id='singleContainer' style="margin-top: 15px;">
      <div id="logContainer" style="display: flex;flex-direction: column;width: 100%;"></div>
      <div id="settingsContainer" style="display: none;flex-direction: column; overflow-y: auto;"></div>
      <div id="connContainer" style="display: none;"></div>
    </div>
    <div style="display: none; flex-direction: column; height: 200px; overflow: hidden;">
      <img id="wfPreviewImage" src="" alt="Preview" style="width: auto; height: auto; max-width: 100%; max-height: 100%; object-fit: contain;" >
    </div>
  </div>
  
  
  <div id="wfManageContainer" style="display: none;"></div>

`;var js=Bo(),zs=Rt(),Hs=X(),Wo=qo(),Ws=Ho(),Gs=document.getElementById("singleContainer"),Ks=document.getElementById("logContainer"),Yt=document.getElementById("settingsContainer");document.getElementById("btnSettings").addEventListener("click",Rs);document.addEventListener("DOMContentLoaded",async()=>{try{await Wo.loadConfig(),await window.loadHtml("logContainer","html/logger.html"),Hs.initPanel(),Ws.initPanel(),js.initPanel(),zs.initPanel()}catch(e){throw console.log(e),e}})});Go();})();
